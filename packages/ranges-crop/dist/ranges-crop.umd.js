/**
 * ranges-crop
 * Crop array of ranges when they go beyond the reference string's length
 * Version: 3.0.2
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/ranges-crop/
 */

!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).rangesCrop={})}(this,(function(r){"use strict";function e(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function n(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.push.apply(n,t)}return n}function t(r){for(var t=1;arguments.length>t;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(n){e(r,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}))}return r}var o={strictlyTwoElementsInRangeArrays:!1,progressFn:null};function s(r,e){if(!Array.isArray(r)||!r.length)return r;var n,s,i=t(t({},o),e);if(i.strictlyTwoElementsInRangeArrays&&!r.filter((function(r){return r})).every((function(r,e){return 2===r.length||(n=e,s=r.length,!1)})))throw new TypeError("ranges-sort: [THROW_ID_03] The first argument should be an array and must consist of arrays which are natural number indexes representing TWO string index ranges. However, "+n+"th range ("+JSON.stringify(r[n],null,4)+") has not two but "+s+" elements!");if(!r.filter((function(r){return r})).every((function(r,e){return!(!Number.isInteger(r[0])||0>r[0]||!Number.isInteger(r[1])||0>r[1])||(n=e,!1)})))throw new TypeError("ranges-sort: [THROW_ID_04] The first argument should be an array and must consist of arrays which are natural number indexes representing string index ranges. However, "+n+"th range ("+JSON.stringify(r[n],null,4)+") does not consist of only natural numbers!");var u=Math.pow(r.filter((function(r){return r})).length,2),a=0;return Array.from(r).filter((function(r){return r})).sort((function(r,e){return i.progressFn&&i.progressFn(Math.floor(100*(a+=1)/u)),r[0]===e[0]?e[1]>r[1]?-1:r[1]>e[1]?1:0:e[0]>r[0]?-1:1}))}var i={mergeType:1,progressFn:null,joinRangesThatTouchEdges:!0};r.rCrop=function(r,e){if(null===r)return null;if(!Array.isArray(r))throw new TypeError("ranges-crop: [THROW_ID_01] The first input's argument must be an array, consisting of range arrays! Currently its type is: "+typeof r+", equal to: "+JSON.stringify(r,null,4));if(!Number.isInteger(e))throw new TypeError("ranges-crop: [THROW_ID_02] The second input's argument must be a natural number or zero (coming from String.length)! Currently its type is: "+typeof e+", equal to: "+JSON.stringify(e,null,4));if(!r.filter((function(r){return r})).length)return r.filter((function(r){return r}));var n=0;if(!r.filter((function(r){return r})).every((function(r,e){return!(!Number.isInteger(r[0])||!Number.isInteger(r[1]))||(n=e,!1)}))){if(Array.isArray(r)&&"number"==typeof r[0]&&"number"==typeof r[1])throw new TypeError("ranges-crop: [THROW_ID_03] The first argument should be AN ARRAY OF RANGES, not a single range! Currently arrOfRanges = "+JSON.stringify(r,null,0)+"!");throw new TypeError("ranges-crop: [THROW_ID_04] The first argument should be AN ARRAY OF ARRAYS! Each sub-array means string slice indexes. In our case, here "+n+"th range ("+JSON.stringify(r[n],null,0)+") does not consist of only natural numbers!")}if(!r.filter((function(r){return r})).every((function(r,e){return null==r[2]||"string"==typeof r[2]||(n=e,!1)})))throw new TypeError("ranges-crop: [THROW_ID_05] The third argument, if present at all, should be of a string-type or null. Currently the "+n+"th range "+JSON.stringify(r[n],null,0)+" has a argument in the range of a type "+typeof r[n][2]);var o=(function(r,e){function n(r){return r&&"object"==typeof r&&!Array.isArray(r)}if(!Array.isArray(r)||!r.length)return null;var o;if(e){if(!n(e))throw Error("emlint: [THROW_ID_03] the second input argument must be a plain object. It was given as:\n"+JSON.stringify(e,null,4)+" (type "+typeof e+")");if((o=t(t({},i),e)).progressFn&&n(o.progressFn)&&!Object.keys(o.progressFn).length)o.progressFn=null;else if(o.progressFn&&"function"!=typeof o.progressFn)throw Error('ranges-merge: [THROW_ID_01] opts.progressFn must be a function! It was given of a type: "'+typeof o.progressFn+'", equal to '+JSON.stringify(o.progressFn,null,4));if(o.mergeType&&1!=+o.mergeType&&2!=+o.mergeType)throw Error('ranges-merge: [THROW_ID_02] opts.mergeType was customised to a wrong thing! It was given of a type: "'+typeof o.mergeType+'", equal to '+JSON.stringify(o.mergeType,null,4));if("boolean"!=typeof o.joinRangesThatTouchEdges)throw Error('ranges-merge: [THROW_ID_04] opts.joinRangesThatTouchEdges was customised to a wrong thing! It was given of a type: "'+typeof o.joinRangesThatTouchEdges+'", equal to '+JSON.stringify(o.joinRangesThatTouchEdges,null,4))}else o=t({},i);for(var u,a,l,g=r.filter((function(r){return r})).map((function(r){return[].concat(r)})).filter((function(r){return void 0!==r[2]||r[0]!==r[1]})),f=(u=o.progressFn?s(g,{progressFn:function(r){(l=Math.floor(r/5))!==a&&(a=l,o.progressFn(l))}}):s(g)).length-1,p=f;p>0;p--)o.progressFn&&(l=Math.floor(78*(1-p/f))+21)!==a&&l>a&&(a=l,o.progressFn(l)),(u[p-1][0]>=u[p][0]||!o.joinRangesThatTouchEdges&&u[p-1][1]>u[p][0]||o.joinRangesThatTouchEdges&&u[p-1][1]>=u[p][0])&&(u[p-1][0]=Math.min(u[p][0],u[p-1][0]),u[p-1][1]=Math.max(u[p][1],u[p-1][1]),void 0===u[p][2]||u[p][0]>u[p-1][0]&&u[p-1][1]>u[p][1]||null!==u[p-1][2]&&(null===u[p][2]&&null!==u[p-1][2]?u[p-1][2]=null:null!=u[p-1][2]?2==+o.mergeType&&u[p-1][0]===u[p][0]?u[p-1][2]=u[p][2]:u[p-1][2]+=u[p][2]:u[p-1][2]=u[p][2]),u.splice(p,1),p=u.length);return u.length?u:null}(r)||[]).filter((function(r){return e>=r[0]&&(null!=r[2]||e>r[0])})).map((function(r){return r[1]>e?null!=r[2]?[r[0],e,r[2]]:[r[0],e]:r}));return o===[]?null:o},r.version="3.0.2",Object.defineProperty(r,"__esModule",{value:!0})}));
