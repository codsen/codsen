/**
 * codsen-tokenizer
 * Tokenizer for mixed inputs aiming at broken code, especially HTML & CSS
 * Version: 2.6.0
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://gitlab.com/codsen/codsen/tree/master/packages/codsen-tokenizer
 */

!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t=t||self).codsenTokenizer=o()}(this,(function(){"use strict";function t(o){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(o)}var o=["abbr","accept","accept-charset","accesskey","action","align","alink","allow","alt","archive","async","autocapitalize","autocomplete","autofocus","autoplay","axis","background","background-attachment","background-color","background-image","background-position","background-position-x","background-position-y","background-repeat","bgcolor","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","buffered","capture","cellpadding","cellspacing","challenge","char","charoff","charset","checked","cite","class","classid","clear","clip","code","codebase","codetype","color","cols","colspan","column-span","compact","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","cursor","data","data-*","datetime","declare","decoding","default","defer","dir","direction","dirname","disabled","display","download","draggable","dropzone","enctype","enterkeyhint","face","filter","float","font","font-color","font-emphasize","font-emphasize-position","font-emphasize-style","font-family","font-size","font-style","font-variant","font-weight","for","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","frontuid","headers","height","hidden","high","horiz-align","href","hreflang","hspace","http-equiv","icon","id","importance","inputmode","integrity","intrinsicsize","ismap","itemprop","keytype","kind","label","lang","language","layout-flow","layout-grid","layout-grid-char","layout-grid-line","layout-grid-mode","layout-grid-type","left","letter-spacing","line-break","line-height","link","list","list-image-1","list-image-2","list-image-3","list-style","list-style-image","list-style-position","list-style-type","loading","longdesc","loop","low","manifest","margin","margin-bottom","margin-left","margin-right","margin-top","marginheight","marginwidth","max","maxlength","media","method","min","minlength","mso-ansi-font-size","mso-ansi-font-style","mso-ansi-font-weight","mso-ansi-language","mso-ascii-font-family","mso-background","mso-background-source","mso-baseline-position","mso-bidi-flag","mso-bidi-font-family","mso-bidi-font-size","mso-bidi-font-style","mso-bidi-font-weight","mso-bidi-language","mso-bookmark","mso-border-alt","mso-border-between","mso-border-between-color","mso-border-between-style","mso-border-between-width","mso-border-bottom-alt","mso-border-bottom-color-alt","mso-border-bottom-source","mso-border-bottom-style-alt","mso-border-bottom-width-alt","mso-border-color-alt","mso-border-effect","mso-border-left-alt","mso-border-left-color-alt","mso-border-left-source","mso-border-left-style-alt","mso-border-left-width-alt","mso-border-right-alt","mso-border-right-color-alt","mso-border-right-source","mso-border-right-style-alt","mso-border-right-width-alt","mso-border-shadow","mso-border-source","mso-border-style-alt","mso-border-top-alt","mso-border-top-color-alt","mso-border-top-source","mso-border-top-style-alt","mso-border-top-width-alt","mso-border-width-alt","mso-break-type","mso-build","mso-build-after-action","mso-build-after-color","mso-build-auto-secs","mso-build-avi","mso-build-dual-id","mso-build-order","mso-build-sound-name","mso-bullet-image","mso-cell-special","mso-cellspacing","mso-char-indent","mso-char-indent-count","mso-char-indent-size","mso-char-type","mso-char-wrap","mso-color-alt","mso-color-index","mso-color-source","mso-column-break-before","mso-column-separator","mso-columns","mso-comment-author","mso-comment-continuation","mso-comment-id","mso-comment-reference","mso-data-placement","mso-default-height","mso-default-width","mso-diagonal-down","mso-diagonal-down-color","mso-diagonal-down-source","mso-diagonal-down-style","mso-diagonal-down-width","mso-diagonal-up","mso-diagonal-up-color","mso-diagonal-up-source","mso-diagonal-up-style","mso-diagonal-up-width","mso-displayed-decimal-separator","mso-displayed-thousand-separator","mso-element","mso-element-anchor-horizontal","mso-element-anchor-lock","mso-element-anchor-vertical","mso-element-frame-height","mso-element-frame-hspace","mso-element-frame-vspace","mso-element-frame-width","mso-element-left","mso-element-linespan","mso-element-top","mso-element-wrap","mso-endnote-continuation-notice","mso-endnote-continuation-notice-id","mso-endnote-continuation-notice-src","mso-endnote-continuation-separator","mso-endnote-continuation-separator-id","mso-endnote-continuation-separator-src","mso-endnote-display","mso-endnote-id","mso-endnote-numbering","mso-endnote-numbering-restart","mso-endnote-numbering-start","mso-endnote-numbering-style","mso-endnote-position","mso-endnote-separator","mso-endnote-separator-id","mso-endnote-separator-src","mso-even-footer","mso-even-footer-id","mso-even-footer-src","mso-even-header","mso-even-header-id","mso-even-header-src","mso-facing-pages","mso-fareast-font-family","mso-fareast-hint","mso-fareast-language","mso-field-change","mso-field-change-author","mso-field-change-time","mso-field-change-value","mso-field-code","mso-field-lock","mso-fills-color","mso-first-footer","mso-first-footer-id","mso-first-footer-src","mso-first-header","mso-first-header-id","mso-first-header-src","mso-font-alt","mso-font-charset","mso-font-format","mso-font-info","mso-font-info-charset","mso-font-info-type","mso-font-kerning","mso-font-pitch","mso-font-signature","mso-font-signature-csb-one","mso-font-signature-csb-two","mso-font-signature-usb-four","mso-font-signature-usb-one","mso-font-signature-usb-three","mso-font-signature-usb-two","mso-font-src","mso-font-width","mso-footer","mso-footer-data","mso-footer-id","mso-footer-margin","mso-footer-src","mso-footnote-continuation-notice","mso-footnote-continuation-notice-id","mso-footnote-continuation-notice-src","mso-footnote-continuation-separator","mso-footnote-continuation-separator-id","mso-footnote-continuation-separator-src","mso-footnote-id","mso-footnote-numbering","mso-footnote-numbering-restart","mso-footnote-numbering-start","mso-footnote-numbering-style","mso-footnote-position","mso-footnote-separator","mso-footnote-separator-id","mso-footnote-separator-src","mso-foreground","mso-forms-protection","mso-generic-font-family","mso-grid-bottom","mso-grid-bottom-count","mso-grid-left","mso-grid-left-count","mso-grid-right","mso-grid-right-count","mso-grid-top","mso-grid-top-count","mso-gutter-direction","mso-gutter-margin","mso-gutter-position","mso-hansi-font-family","mso-header","mso-header-data","mso-header-id","mso-header-margin","mso-header-src","mso-height-alt","mso-height-rule","mso-height-source","mso-hide","mso-highlight","mso-horizontal-page-align","mso-hyphenate","mso-ignore","mso-kinsoku-overflow","mso-layout-grid-align","mso-layout-grid-char-alt","mso-layout-grid-origin","mso-level-inherit","mso-level-legacy","mso-level-legacy-indent","mso-level-legacy-space","mso-level-legal-format","mso-level-number-format","mso-level-number-position","mso-level-numbering","mso-level-reset-level","mso-level-start-at","mso-level-style-link","mso-level-suffix","mso-level-tab-stop","mso-level-text","mso-line-break-override","mso-line-grid","mso-line-height-alt","mso-line-height-rule","mso-line-numbers-count-by","mso-line-numbers-distance","mso-line-numbers-restart","mso-line-numbers-start","mso-line-spacing","mso-linked-frame","mso-list","mso-list-change","mso-list-change-author","mso-list-change-time","mso-list-change-values","mso-list-id","mso-list-ins","mso-list-ins-author","mso-list-ins-time","mso-list-name","mso-list-template-ids","mso-list-type","mso-margin-bottom-alt","mso-margin-left-alt","mso-margin-top-alt","mso-mirror-margins","mso-negative-indent-tab","mso-number-format","mso-outline-level","mso-outline-parent","mso-outline-parent-col","mso-outline-parent-row","mso-outline-parent-visibility","mso-outline-style","mso-padding-alt","mso-padding-between","mso-padding-bottom-alt","mso-padding-left-alt","mso-padding-right-alt","mso-padding-top-alt","mso-page-border-aligned","mso-page-border-art","mso-page-border-bottom-art","mso-page-border-display","mso-page-border-left-art","mso-page-border-offset-from","mso-page-border-right-art","mso-page-border-surround-footer","mso-page-border-surround-header","mso-page-border-top-art","mso-page-border-z-order","mso-page-numbers","mso-page-numbers-chapter-separator","mso-page-numbers-chapter-style","mso-page-numbers-start","mso-page-numbers-style","mso-page-orientation","mso-page-scale","mso-pagination","mso-panose-arm-style","mso-panose-contrast","mso-panose-family-type","mso-panose-letterform","mso-panose-midline","mso-panose-proportion","mso-panose-serif-style","mso-panose-stroke-variation","mso-panose-weight","mso-panose-x-height","mso-paper-source","mso-paper-source-first-page","mso-paper-source-other-pages","mso-pattern","mso-pattern-color","mso-pattern-style","mso-print-area","mso-print-color","mso-print-gridlines","mso-print-headings","mso-print-resolution","mso-print-sheet-order","mso-print-title-column","mso-print-title-row","mso-prop-change","mso-prop-change-author","mso-prop-change-time","mso-protection","mso-rotate","mso-row-margin-left","mso-row-margin-right","mso-ruby-merge","mso-ruby-visibility","mso-scheme-fill-color","mso-scheme-shadow-color","mso-shading","mso-shadow-color","mso-space-above","mso-space-below","mso-spacerun","mso-special-character","mso-special-format","mso-style-id","mso-style-name","mso-style-next","mso-style-parent","mso-style-type","mso-style-update","mso-subdocument","mso-symbol-font-family","mso-tab-count","mso-table-anchor-horizontal","mso-table-anchor-vertical","mso-table-bspace","mso-table-del-author","mso-table-del-time","mso-table-deleted","mso-table-dir","mso-table-ins-author","mso-table-ins-time","mso-table-inserted","mso-table-layout-alt","mso-table-left","mso-table-lspace","mso-table-overlap","mso-table-prop-author","mso-table-prop-change","mso-table-prop-time","mso-table-rspace","mso-table-top","mso-table-tspace","mso-table-wrap","mso-text-animation","mso-text-combine-brackets","mso-text-combine-id","mso-text-control","mso-text-fit-id","mso-text-indent-alt","mso-text-orientation","mso-text-raise","mso-title-page","mso-tny-compress","mso-unsynced","mso-vertical-align-alt","mso-vertical-align-special","mso-vertical-page-align","mso-width-alt","mso-width-source","mso-word-wrap","mso-xlrowspan","mso-zero-height","multiple","muted","name","nav-banner-image","navbutton_background_color","navbutton_home_hovered","navbutton_home_normal","navbutton_home_pushed","navbutton_horiz_hovered","navbutton_horiz_normal","navbutton_horiz_pushed","navbutton_next_hovered","navbutton_next_normal","navbutton_next_pushed","navbutton_prev_hovered","navbutton_prev_normal","navbutton_prev_pushed","navbutton_up_hovered","navbutton_up_normal","navbutton_up_pushed","navbutton_vert_hovered","navbutton_vert_normal","navbutton_vert_pushed","nohref","noresize","noshade","novalidate","nowrap","object","onblur","onchange","onclick","ondblclick","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload","open","optimum","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","panose-1","pattern","ping","placeholder","position","poster","preload","profile","prompt","punctuation-trim","punctuation-wrap","radiogroup","readonly","referrerpolicy","rel","required","rev","reversed","right","row-span","rows","rowspan","ruby-align","ruby-overhang","ruby-position","rules","sandbox","scheme","scope","scoped","scrolling","selected","separator-image","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","standby","start","step","style","summary","tab-interval","tab-stops","tabindex","table-border-color-dark","table-border-color-light","table-layout","target","text","text-align","text-autospace","text-combine","text-decoration","text-effect","text-fit","text-indent","text-justify","text-justify-trim","text-kashida","text-line-through","text-shadow","text-transform","text-underline","text-underline-color","text-underline-style","title","top","top-bar-button","translate","type","unicode-bidi","urlId","usemap","valign","value","valuetype","version","vert-align","vertical-align","visibility","vlink","vnd.ms-excel.numberformat","vspace","white-space","width","word-break","word-spacing","wrap","xmlns","z-index"];function e(t){if("string"==typeof t)return 0!==t.length&&(t.charCodeAt(0)>=55296&&t.charCodeAt(0)<=56319);if(void 0===t)return!1;throw new TypeError(`string-character-is-astral-surrogate/isHighSurrogate(): the input is not string but ${typeof t}`)}function n(t){if("string"==typeof t)return 0!==t.length&&(t.charCodeAt(0)>=56320&&t.charCodeAt(0)<=57343);if(void 0===t)return!1;throw new TypeError(`string-character-is-astral-surrogate/isLowSurrogate(): the input is not string but ${typeof t}`)}function r(t){return null!=t}function a(t){return"string"==typeof t&&(t.charCodeAt(0)>=55296&&t.charCodeAt(0)<=57343)}function c(t,o,a,c,s){const i="function"==typeof a?a():a;if(o>=t.length&&s&&"EOL"===i)return i;if(!(o<=t.length)){if(c.relaxedApi)return!1;throw new Error(`string-match-left-right/marchForward(): [THROW_ID_102] second argument, fromIndexInclusive is ${o} beyond the input string length, ${t.length}.`)}{let l=s?1:a.length;for(let s=o,i=t.length;s<i;s++){let o=t[s];if(e(t[s])&&n(t[s+1])&&(o=t[s]+t[s+1]),n(t[s])&&e(t[s-1])&&(o=t[s-1]+t[s]),c.trimBeforeMatching&&""===t[s].trim())continue;if(!c.i&&c.trimCharsBeforeMatching.includes(o)||c.i&&c.trimCharsBeforeMatching.map(t=>t.toLowerCase()).includes(o.toLowerCase())){2===o.length&&(s+=1);continue}let i=a[a.length-l];if(e(i)&&r(a[a.length-l+1])&&n(a[a.length-l+1])&&(i=a[a.length-l]+a[a.length-l+1]),!(!c.i&&o===i||c.i&&o.toLowerCase()===i.toLowerCase()))return!1;if(l-=o.length,l<1){let c=s-a.length+o.length;return c>=0&&n(t[c])&&r(t[c-1])&&e(t[c-1])&&(c-=1),c>=0?c:0}2===o.length&&e(t[s])&&(s+=1)}if(l>0)return!(!s||"EOL"!==i)}}function s(t,o,r,a,c){const s="function"==typeof r?r():r;if(o<0&&c&&"EOL"===s)return s;if(o>=t.length){if(a.relaxedApi)return!1;throw new Error(`string-match-left-right/marchBackward(): [THROW_ID_203] second argument, starting index, should not be beyond the last character of the input string! Currently the first argument's last character's index is ${t.length} but the second argument is beyond it:\n${JSON.stringify(o,null,4)}`)}let i=c?1:r.length;for(let s=o+1;s--;){if(a.trimBeforeMatching&&""===t[s].trim()){if(0===s&&c&&"EOL"===r)return!0;continue}let o=t[s];if(n(t[s])&&e(t[s-1])?o=t[s-1]+t[s]:e(t[s])&&n(t[s+1])&&(o=t[s]+t[s+1]),!a.i&&a.trimCharsBeforeMatching.includes(o)||a.i&&a.trimCharsBeforeMatching.map(t=>t.toLowerCase()).includes(o.toLowerCase())){if(2===o.length&&(s-=1),c&&"EOL"===r&&0===s)return!0;continue}let l=r[i-1];if(n(l)&&(l=`${r[i-2]}${r[i-1]}`,i-=1,s-=1),!(!a.i&&o===l||a.i&&o.toLowerCase()===l.toLowerCase()))return!1;if(i-=1,i<1)return s>=0?s:0}return i>0?!(!c||"EOL"!==s):void 0}function i(t,o,i,l){return function(t,o,i,l,m){if("object"==typeof m&&null!==m&&Object.prototype.hasOwnProperty.call(m,"trimBeforeMatching")&&"boolean"!=typeof m.trimBeforeMatching)throw new Error(`string-match-left-right/${t}(): [THROW_ID_09] opts.trimBeforeMatching should be boolean!${Array.isArray(m.trimBeforeMatching)?" Did you mean to use opts.trimCharsBeforeMatching?":""}`);const u=Object.assign({},{i:!1,trimBeforeMatching:!1,trimCharsBeforeMatching:[],relaxedApi:!1},m);var g;let d,f,h,p;if(u.trimCharsBeforeMatching="string"==typeof(g=u.trimCharsBeforeMatching)?g.length>0?[g]:[]:g,u.trimCharsBeforeMatching=u.trimCharsBeforeMatching.map(t=>"string"==typeof t?t:String(t)),u.trimCharsBeforeMatching.some((t,o)=>t.length>1&&!a(t)&&(d=o,f=t,!0)))throw new Error(`string-match-left-right/${t}(): [THROW_ID_07] the fourth argument, options object contains trimCharsBeforeMatching. It was meant to list the single characters but one of the entries at index ${d} is longer than 1 character, ${f.length} (equals to ${f}). Please split it into separate characters and put into array as separate elements.`);if("string"!=typeof o){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_01] the first argument should be a string. Currently it's of a type: ${typeof o}, equal to:\n${JSON.stringify(o,null,4)}`)}if(0===o.length){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_02] the first argument should be a non-empty string. Currently it's empty!`)}if(!(Number.isInteger(i)&&i>=0)){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_03] the second argument should be a natural number. Currently it's of a type: ${typeof i}, equal to:\n${JSON.stringify(i,null,4)}`)}if("string"==typeof l)h=[l];else if(Array.isArray(l))h=l;else if(r(l)){if("function"!=typeof l)throw new Error(`string-match-left-right/${t}(): [THROW_ID_05] the third argument, whatToMatch, is neither string nor array of strings! It's ${typeof l}, equal to:\n${JSON.stringify(l,null,4)}`);h=[],h.push(l)}else h=l;if(r(m)&&"object"!=typeof m)throw new Error(`string-match-left-right/${t}(): [THROW_ID_06] the fourth argument, options object, should be a plain object. Currently it's of a type "${typeof m}", and equal to:\n${JSON.stringify(m,null,4)}`);if(!r(h)||!Array.isArray(h)||Array.isArray(h)&&!h.length||Array.isArray(h)&&1===h.length&&"string"==typeof h[0]&&0===h[0].trim().length){if("function"==typeof u.cb){let r,a=i;if("matchRight"===t&&e(o[i])&&n(o[i+1])&&(a+=1),"matchLeftIncl"!==t&&"matchRight"!==t||(a+=1),t.startsWith("matchLeft"))for(let t=a;t--;){if(n(o[t])&&e(o[t-1]))continue;let a=o[t];if(e(o[t])&&n(o[t+1])&&(a=o[t]+o[t+1]),(!u.trimBeforeMatching||u.trimBeforeMatching&&void 0!==a&&""!==a.trim())&&(0===u.trimCharsBeforeMatching.length||void 0!==a&&!u.trimCharsBeforeMatching.includes(a))){r=t;break}n(o[t-1])&&e(o[t-2])&&(t-=1)}else if(t.startsWith("matchRight"))for(let t=a;t<o.length;t++){let a=o[t];if(e(o[t])&&n(o[t+1])&&(a=o[t]+o[t+1]),(!u.trimBeforeMatching||u.trimBeforeMatching&&""!==a.trim())&&(0===u.trimCharsBeforeMatching.length||!u.trimCharsBeforeMatching.includes(a))){r=t;break}e(o[t])&&n(o[t+1])&&(t+=1)}if(void 0===r)return!1;let c=o[r];e(o[r])&&n(o[r+1])&&(c=o[r]+o[r+1]),n(o[r])&&e(o[r-1])&&(c=o[r-1]+o[r],r-=1);let s,l=r+1;return e(o[r])&&n(o[r+1])&&(l+=1),l&&l>0&&(s=o.slice(0,l)),t.startsWith("matchLeft")?u.cb(c,s,r):(r&&r>0&&(s=o.slice(r)),u.cb(c,s,r))}let a="";throw r(m)||(a=" More so, the whole options object, the fourth input argument, is missing!"),new Error(`string-match-left-right/${t}(): [THROW_ID_08] the third argument, "whatToMatch", was given as an empty string. This means, you intend to match purely by a callback. The callback was not set though, the opts key "cb" is not set!${a}`)}if(t.startsWith("matchLeft")){for(let c=0,l=h.length;c<l;c++){p="function"==typeof h[c];const l=h[c];let m,g,d="",f=i;"matchLeft"===t&&(a(o[c-1])&&a(o[c-2])?f-=2:f-=1);const b=s(o,f,l,u,p);if(b&&p&&"function"==typeof l&&"EOL"===l())return!(!l()||u.cb&&!u.cb(m,d,g))&&l();if(r(b)&&b>0&&(g=b-1,m=o[g],d=o.slice(0,b)),n(o[g])&&r(o[g-1])&&e(o[g-1])&&(g-=1,m=o[g-1]+o[g]),e(o[g])&&r(o[g+1])&&n(o[g+1])&&(m=o[g]+o[g+1],d=o.slice(0,g+2)),!1!==b&&(!u.cb||u.cb(m,d,g)))return l}return!1}for(let a=0,s=h.length;a<s;a++){p="function"==typeof h[a];const s=h[a];let l=i+("matchRight"===t?1:0);"matchRight"===t&&e(o[l-1])&&n(o[l])&&(l+=1);const m=c(o,l,s,u,p);if(m&&p&&"function"==typeof s&&"EOL"===s()){let t,o,e;return!(!s()||u.cb&&!u.cb(t,o,e))&&s()}let g,d,f;if(r(m)&&r(o[m+s.length-1])&&(g=m+s.length,d=o[g],e(o[g])&&n(o[g+1])&&(d=o[g]+o[g+1])),r(g)&&g>=0&&(f=o.slice(g)),!1!==m&&(!u.cb||u.cb(d,f,g)))return s}return!1}("matchRight",t,o,i,l)}Function.prototype.toString.call(Object);var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var m=function(t,o){return t(o={exports:{}},o.exports),o.exports}((function(t,o){var e="[object Arguments]",n="[object Function]",r="[object GeneratorFunction]",a="[object Map]",c="[object Set]",s=/\w*$/,i=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,u={};u[e]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object DataView]"]=u["[object Boolean]"]=u["[object Date]"]=u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u[a]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u[c]=u["[object String]"]=u["[object Symbol]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Error]"]=u[n]=u["[object WeakMap]"]=!1;var g="object"==typeof l&&l&&l.Object===Object&&l,d="object"==typeof self&&self&&self.Object===Object&&self,f=g||d||Function("return this")(),h=o&&!o.nodeType&&o,p=h&&t&&!t.nodeType&&t,b=p&&p.exports===h;function y(t,o){return t.set(o[0],o[1]),t}function v(t,o){return t.add(o),t}function w(t,o,e,n){var r=-1,a=t?t.length:0;for(n&&a&&(e=t[++r]);++r<a;)e=o(e,t[r],r,t);return e}function S(t){var o=!1;if(null!=t&&"function"!=typeof t.toString)try{o=!!(t+"")}catch(t){}return o}function k(t){var o=-1,e=Array(t.size);return t.forEach((function(t,n){e[++o]=[n,t]})),e}function E(t,o){return function(e){return t(o(e))}}function _(t){var o=-1,e=Array(t.size);return t.forEach((function(t){e[++o]=t})),e}var A,O=Array.prototype,T=Function.prototype,N=Object.prototype,C=f["__core-js_shared__"],j=(A=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"",x=T.toString,I=N.hasOwnProperty,L=N.toString,R=RegExp("^"+x.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=b?f.Buffer:void 0,P=f.Symbol,B=f.Uint8Array,J=E(Object.getPrototypeOf,Object),V=Object.create,$=N.propertyIsEnumerable,F=O.splice,W=Object.getOwnPropertySymbols,z=M?M.isBuffer:void 0,D=E(Object.keys,Object),H=pt(f,"DataView"),q=pt(f,"Map"),U=pt(f,"Promise"),Q=pt(f,"Set"),G=pt(f,"WeakMap"),Y=pt(Object,"create"),K=St(H),X=St(q),Z=St(U),tt=St(Q),ot=St(G),et=P?P.prototype:void 0,nt=et?et.valueOf:void 0;function rt(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function at(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function ct(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function st(t){this.__data__=new at(t)}function it(t,o){var n=Et(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&_t(t)}(t)&&I.call(t,"callee")&&(!$.call(t,"callee")||L.call(t)==e)}(t)?function(t,o){for(var e=-1,n=Array(t);++e<t;)n[e]=o(e);return n}(t.length,String):[],r=n.length,a=!!r;for(var c in t)!o&&!I.call(t,c)||a&&("length"==c||vt(c,r))||n.push(c);return n}function lt(t,o,e){var n=t[o];I.call(t,o)&&kt(n,e)&&(void 0!==e||o in t)||(t[o]=e)}function mt(t,o){for(var e=t.length;e--;)if(kt(t[e][0],o))return e;return-1}function ut(t,o,i,l,m,g,d){var f;if(l&&(f=g?l(t,m,g,d):l(t)),void 0!==f)return f;if(!Tt(t))return t;var h=Et(t);if(h){if(f=function(t){var o=t.length,e=t.constructor(o);o&&"string"==typeof t[0]&&I.call(t,"index")&&(e.index=t.index,e.input=t.input);return e}(t),!o)return function(t,o){var e=-1,n=t.length;o||(o=Array(n));for(;++e<n;)o[e]=t[e];return o}(t,f)}else{var p=yt(t),b=p==n||p==r;if(At(t))return function(t,o){if(o)return t.slice();var e=new t.constructor(t.length);return t.copy(e),e}(t,o);if("[object Object]"==p||p==e||b&&!g){if(S(t))return g?t:{};if(f=function(t){return"function"!=typeof t.constructor||wt(t)?{}:(o=J(t),Tt(o)?V(o):{});var o}(b?{}:t),!o)return function(t,o){return ft(t,bt(t),o)}(t,function(t,o){return t&&ft(o,Nt(o),t)}(f,t))}else{if(!u[p])return g?t:{};f=function(t,o,e,n){var r=t.constructor;switch(o){case"[object ArrayBuffer]":return dt(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return function(t,o){var e=o?dt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,o){var e=o?dt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}(t,n);case a:return function(t,o,e){return w(o?e(k(t),!0):k(t),y,new t.constructor)}(t,n,e);case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return function(t){var o=new t.constructor(t.source,s.exec(t));return o.lastIndex=t.lastIndex,o}(t);case c:return function(t,o,e){return w(o?e(_(t),!0):_(t),v,new t.constructor)}(t,n,e);case"[object Symbol]":return i=t,nt?Object(nt.call(i)):{}}var i}(t,p,ut,o)}}d||(d=new st);var E=d.get(t);if(E)return E;if(d.set(t,f),!h)var A=i?function(t){return function(t,o,e){var n=o(t);return Et(t)?n:function(t,o){for(var e=-1,n=o.length,r=t.length;++e<n;)t[r+e]=o[e];return t}(n,e(t))}(t,Nt,bt)}(t):Nt(t);return function(t,o){for(var e=-1,n=t?t.length:0;++e<n&&!1!==o(t[e],e,t););}(A||t,(function(e,n){A&&(e=t[n=e]),lt(f,n,ut(e,o,i,l,n,t,d))})),f}function gt(t){return!(!Tt(t)||(o=t,j&&j in o))&&(Ot(t)||S(t)?R:i).test(St(t));var o}function dt(t){var o=new t.constructor(t.byteLength);return new B(o).set(new B(t)),o}function ft(t,o,e,n){e||(e={});for(var r=-1,a=o.length;++r<a;){var c=o[r],s=n?n(e[c],t[c],c,e,t):void 0;lt(e,c,void 0===s?t[c]:s)}return e}function ht(t,o){var e,n,r=t.__data__;return("string"==(n=typeof(e=o))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?r["string"==typeof o?"string":"hash"]:r.map}function pt(t,o){var e=function(t,o){return null==t?void 0:t[o]}(t,o);return gt(e)?e:void 0}rt.prototype.clear=function(){this.__data__=Y?Y(null):{}},rt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},rt.prototype.get=function(t){var o=this.__data__;if(Y){var e=o[t];return"__lodash_hash_undefined__"===e?void 0:e}return I.call(o,t)?o[t]:void 0},rt.prototype.has=function(t){var o=this.__data__;return Y?void 0!==o[t]:I.call(o,t)},rt.prototype.set=function(t,o){return this.__data__[t]=Y&&void 0===o?"__lodash_hash_undefined__":o,this},at.prototype.clear=function(){this.__data__=[]},at.prototype.delete=function(t){var o=this.__data__,e=mt(o,t);return!(e<0)&&(e==o.length-1?o.pop():F.call(o,e,1),!0)},at.prototype.get=function(t){var o=this.__data__,e=mt(o,t);return e<0?void 0:o[e][1]},at.prototype.has=function(t){return mt(this.__data__,t)>-1},at.prototype.set=function(t,o){var e=this.__data__,n=mt(e,t);return n<0?e.push([t,o]):e[n][1]=o,this},ct.prototype.clear=function(){this.__data__={hash:new rt,map:new(q||at),string:new rt}},ct.prototype.delete=function(t){return ht(this,t).delete(t)},ct.prototype.get=function(t){return ht(this,t).get(t)},ct.prototype.has=function(t){return ht(this,t).has(t)},ct.prototype.set=function(t,o){return ht(this,t).set(t,o),this},st.prototype.clear=function(){this.__data__=new at},st.prototype.delete=function(t){return this.__data__.delete(t)},st.prototype.get=function(t){return this.__data__.get(t)},st.prototype.has=function(t){return this.__data__.has(t)},st.prototype.set=function(t,o){var e=this.__data__;if(e instanceof at){var n=e.__data__;if(!q||n.length<199)return n.push([t,o]),this;e=this.__data__=new ct(n)}return e.set(t,o),this};var bt=W?E(W,Object):function(){return[]},yt=function(t){return L.call(t)};function vt(t,o){return!!(o=null==o?9007199254740991:o)&&("number"==typeof t||m.test(t))&&t>-1&&t%1==0&&t<o}function wt(t){var o=t&&t.constructor;return t===("function"==typeof o&&o.prototype||N)}function St(t){if(null!=t){try{return x.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function kt(t,o){return t===o||t!=t&&o!=o}(H&&"[object DataView]"!=yt(new H(new ArrayBuffer(1)))||q&&yt(new q)!=a||U&&"[object Promise]"!=yt(U.resolve())||Q&&yt(new Q)!=c||G&&"[object WeakMap]"!=yt(new G))&&(yt=function(t){var o=L.call(t),e="[object Object]"==o?t.constructor:void 0,n=e?St(e):void 0;if(n)switch(n){case K:return"[object DataView]";case X:return a;case Z:return"[object Promise]";case tt:return c;case ot:return"[object WeakMap]"}return o});var Et=Array.isArray;function _t(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!Ot(t)}var At=z||function(){return!1};function Ot(t){var o=Tt(t)?L.call(t):"";return o==n||o==r}function Tt(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function Nt(t){return _t(t)?it(t):function(t){if(!wt(t))return D(t);var o=[];for(var e in Object(t))I.call(t,e)&&"constructor"!=e&&o.push(e);return o}(t)}t.exports=function(t){return ut(t,!0,!0)}}));function u(t,o){return function(t,o,e){if("string"!=typeof t||!t.length)return null;if(o&&"number"==typeof o||(o=0),!t[o+1])return null;if(t[o+1]&&(!e&&t[o+1].trim().length||e&&(t[o+1].trim().length||"\n\r".includes(t[o+1]))))return o+1;if(t[o+2]&&(!e&&t[o+2].trim().length||e&&(t[o+2].trim().length||"\n\r".includes(t[o+2]))))return o+2;for(let n=o+1,r=t.length;n<r;n++)if(t[n]&&(!e&&t[n].trim().length||e&&(t[n].trim().length||"\n\r".includes(t[n]))))return n;return null}(t,o,!1)}function g(t,o){return function(t,o,e){if("string"!=typeof t||!t.length)return null;if(o&&"number"==typeof o||(o=0),o<1)return null;if(t[o-1]&&(!e&&t[o-1].trim().length||e&&(t[o-1].trim().length||"\n\r".includes(t[o-1]))))return o-1;if(t[o-2]&&(!e&&t[o-2].trim().length||e&&(t[o-2].trim().length||"\n\r".includes(t[o-2]))))return o-2;for(let n=o;n--;)if(t[n]&&(!e&&t[n].trim().length||e&&(t[n].trim().length||"\n\r".includes(t[n]))))return n;return null}(t,o,!1)}const d="\\",f=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h1 - h6","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xml"];function h(t){return void 0===t||t.toUpperCase()===t.toLowerCase()&&!"0123456789".includes(t)}function p(t,o=0){const e=o?t.slice(o):t;let n=!1;return/^<[\\ \t\r\n/]*\w+[\\ \t\r\n/]*>/g.test(e)?n=!0:/^<\s*\w+\s+\w+(?:-\w+)?\s*=\s*['"\w]/g.test(e)?n=!0:/^<\s*\/?\s*\w+\s*\/?\s*>/g.test(e)?n=!0:/^<[\\ \t\r\n/]*\w+(?:\s*\w+)*\s*\w+=['"]/g.test(e)?n=!0:"<"===t[o]&&t[o+1]&&(["/",d].includes(t[o+1])&&i(t,o+1,f,{cb:h,i:!0})||!h(t[o+1])&&i(t,o,f,{cb:h,i:!0,trimCharsBeforeMatching:["/",d,"!"," ","\t","\n","\r"]})||h(t[o+1])&&i(t,o,f,{cb:(o,e,n)=>(void 0===o||o.toUpperCase()===o.toLowerCase()&&!"0123456789".includes(o))&&("/"===t[u(t,n-1)]||">"===t[u(t,n-1)]),i:!0,trimCharsBeforeMatching:["/",d,"!"," ","\t","\n","\r"]}))&&(n=!0),"string"==typeof t&&o<t.length&&n}var b=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"];function y(t){return"string"==typeof t}function v(t){return"string"==typeof t&&t.charCodeAt(0)>=48&&t.charCodeAt(0)<=57||Number.isInteger(t)}function w(t){return y(t)&&1===t.length&&(t.charCodeAt(0)>64&&t.charCodeAt(0)<91||t.charCodeAt(0)>96&&t.charCodeAt(0)<123)}function S(t){return w(t)||t.charCodeAt(0)>=48&&t.charCodeAt(0)<=57||[":","-"].includes(t)}function k(t){for(var o="",e=0,n=t.length;e<n;e++)o="{"===t[e]?"}".concat(o):"("===t[e]?")".concat(o):"".concat(t[e]).concat(o);return o}function E(o){return o&&"object"===t(o)&&!Array.isArray(o)}var _=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],A="{}%-$_()*|",O=[")|(","|(",")(","()","%)","*)","**"];return function(e,n){if(!y(e))throw void 0===e?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "'.concat(t(e),'", equal to:\n').concat(JSON.stringify(e,null,4)));if(n&&!E(n))throw new Error("codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type ".concat(t(n),", equal to ").concat(JSON.stringify(n,null,4)));if(E(n)&&n.tagCb&&"function"!=typeof n.tagCb)throw new Error("codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type ".concat(t(n.tagCb),", equal to ").concat(JSON.stringify(n.tagCb,null,4)));if(E(n)&&n.charCb&&"function"!=typeof n.charCb)throw new Error("codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type ".concat(t(n.charCb),", equal to ").concat(JSON.stringify(n.charCb,null,4)));if(E(n)&&n.reportProgressFunc&&"function"!=typeof n.reportProgressFunc)throw new Error("codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type ".concat(t(n.reportProgressFunc),", equal to ").concat(JSON.stringify(n.reportProgressFunc,null,4)));var r,a,c=Object.assign({},{reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,tagCb:null,charCb:null},n),s=0,l=e.length,d=Math.floor(l/2),f=!1,h={},T={type:null,start:null,end:null,tail:null,kind:null,attribs:[]};function N(){return console.log("175 ".concat("[".concat(36,"m","â–ˆâ–ˆ tokenReset():","[",39,"m")," tokenReset() called")),h=m(T),x(),h}var C={},j={attribName:null,attribNameRecognised:null,attribNameStartAt:null,attribNameEndAt:null,attribOpeningQuoteAt:null,attribClosingQuoteAt:null,attribValue:null,attribValueStartAt:null,attribValueEndAt:null,attribStart:null,attribEnd:null};function x(){C=m(j)}N(),x();var I,L=[];function R(o,e,n){if(!L.length)return!1;var r=n?L[0]:L[L.length-1];if("simple"===r.type)return o[e]===k(r.value);if("esp"===r.type){var a=function(){if(!A.includes(o[e]))return{v:!1};for(var n="",a=o.length,c=e;c<a&&A.includes(o[c]);c++)n+=o[c];if(console.log("270 ".concat("[".concat(33,"m","wholeEspTagLump","[",39,"m")," = ",JSON.stringify(n,null,4))),console.log("277 ".concat("[".concat(33,"m","whichLayerToMatch.openingLump","[",39,"m")," = ",JSON.stringify(r.openingLump,null,4))),n&&r.openingLump&&n.length>r.guessedClosingLump.length){if(n.endsWith(r.openingLump))return console.log("299 RETURN ".concat(n.length-r.openingLump.length)),{v:n.length-r.openingLump.length};var s=r.guessedClosingLump.split("").reduce((function(t,o){return t.includes(o)?t:t.concat([o])}),[]);console.log("322 ".concat("[".concat(33,"m","uniqueCharsListFromGuessedClosingLumpArr","[",39,"m")," = ",JSON.stringify(s,null,0)));for(var i=0,l=function(t,o){if(console.log("331 char = ".concat(n[o])),!s.includes(n[o])&&i>1)return console.log("339 RETURN ".concat(o)),{v:{v:o}};s.includes(n[o])&&(i++,s=s.filter((function(t){return t!==n[o]})),console.log("353 SET found = ".concat(i,"; uniqueCharsListFromGuessedClosingLumpArr = ").concat(JSON.stringify(s,null,0))))},m=0,u=n.length;m<u;m++){var g=l(0,m);if("object"===t(g))return g.v}}else if(r.guessedClosingLump.split("").every((function(t){return n.includes(t)})))return console.log("368 RETURN ".concat(n.length)),{v:n.length}}();if("object"===t(a))return a.v}}function M(t,o){return R(t,o,!0)}function P(t){c.tagCb&&(console.log("388 ".concat("[".concat(32,"m","PING","[",39,"m")," tagCb() with ",JSON.stringify(t,null,4))),c.tagCb(m(t)))}function B(t,o){if(console.log("401 ".concat("[".concat(35,"m","dumpCurrentToken()","[",39,"m"),"; incoming token=",JSON.stringify(t,null,0),"; i = ","[".concat(33,"m",o,"[",39,"m"))),!["text","esp"].includes(t.type)&&null!==t.start&&t.start<o&&(e[o-1]&&!e[o-1].trim().length||"<"===e[o])){if(console.log("418 ".concat("<"===e[o]?"this token was an unclosed tag":"this token indeed had trailing whitespace")),t.end=g(e,o)+1,console.log("432 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",t.end," (last two characters ending at token.end: ").concat(JSON.stringify(e[t.end-1],null,4)," + ").concat(JSON.stringify(e[t.end],null,4),")")),"html"===t.type&&">"!==e[t.end-1]){console.log("442 ".concat("[".concat(35,"m","â–ˆâ–ˆ UNCLOSED TAG CASES","[",39,"m")));var n=t.tagNameEndAt;if(Array.isArray(t.attribs)&&t.attribs.length){console.log("461 ".concat("[".concat(32,"m","â–ˆâ–ˆ validate all attributes","[",39,"m"))),console.log("464 SET cutOffIndex = ".concat(n));for(var r=0,a=t.attribs.length;r<a;r++){if(console.log("468 ".concat("[".concat(36,"m","token.attribs[".concat(r,"]"),"[",39,"m")," = ",JSON.stringify(t.attribs[r],null,4))),!t.attribs[r].attribNameRecognised){console.log("500 ".concat("[".concat(31,"m","BREAK","[",39,"m"))),t.attribs=0===r?[]:t.attribs.splice(0,r),console.log("513 ".concat("[".concat(32,"m","CALCULATED","[",39,"m")," ","[".concat(33,"m","token.attribs","[",39,"m")," = ",JSON.stringify(t.attribs,null,4)));break}n=t.attribs[r].attribEnd,console.log("477 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","cutOffIndex","[",39,"m")," = ",n)),e[n+1]&&!e[n].trim().length&&e[n+1].trim().length&&(n++,console.log("496 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","cutOffIndex","[",39,"m")," = ",n)))}}t.end=n,console.log("527 ".concat("[".concat(32,"m","PING","[",39,"m"))),P(t),console.log("529 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),(t=N()).start=n,t.type="text"}else console.log("534 ".concat("[".concat(35,"m","â–ˆâ–ˆ HEALTHY TAG","[",39,"m"))),console.log("535 ".concat("[".concat(32,"m","PING","[",39,"m"))),P(t),console.log("537 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),t=N(),e[o-1].trim().length||(console.log("541 indeed there was whitespace after token's end"),t.start=g(e,o)+1,t.type="text",console.log("545 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",t.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(t.type)));console.log("553 FINALLY, ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(t,null,4)))}null!==t.start&&(null===t.end&&t.start!==o&&(t.end=o,console.log("567 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",t.end))),console.log("572 ".concat("[".concat(32,"m","PING","[",39,"m"))),P(t),console.log("575 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),t=N())}for(var J=0;J<=l;J++){if(console.log("[".concat(36,"m","===============================","[",39,"m [",35,"m","str[ ".concat(J," ] = ").concat(e[J]&&e[J].trim().length?e[J]:JSON.stringify(e[J],null,4)),"[",39,"m [",36,"m","===============================","[",39,"m\n")),e[J]&&c.reportProgressFunc&&(l>1e3&&l<2e3?J===d&&c.reportProgressFunc(Math.floor((c.reportProgressFuncTo-c.reportProgressFuncFrom)/2)):l>=2e3&&(r=c.reportProgressFuncFrom+Math.floor(J/l*(c.reportProgressFuncTo-c.reportProgressFuncFrom)))!==s&&(s=r,c.reportProgressFunc(r),console.log("656 DONE ".concat(r,"%")))),f&&"css"!==h.type&&(f=!1,console.log("667 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","styleStarts","[",39,"m")," = false"))),Number.isInteger(a)&&J>=a&&(a=!1,console.log("674 TURN OFF doNothing")),h.end&&h.end===J&&(console.log("679 call dumpCurrentToken()"),"style"===h.kind&&(f=!0,console.log("683 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","styleStarts","[",39,"m")," = true"))),B(h,J),console.log("689 ".concat("[".concat(31,"m","WIPE","[",39,"m")," layers")),L=[]),!a&&["html","esp","css"].includes(h.type)&&(console.log("707 inside layers clauses"),!['"',"'","(",")"].includes(e[J])||['"',"'"].includes(e[g(e,J)])&&e[g(e,J)]===e[u(e,J)]||(R(e,J)?(L.pop(),console.log("724 ".concat("[".concat(32,"m","POP","[",39,"m")," layers"))):(L.push({type:"simple",value:e[J],position:J}),console.log("733 ".concat("[".concat(32,"m","PUSH","[",39,"m")," ",JSON.stringify({type:"simple",value:e[J]},null,4))))),console.log("746 now ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(L,null,4)))),!a)if("<"===e[J]&&("text"===h.type&&p(e,J)||!L.length)&&(p(e,J)||e.startsWith("!--",J+1)||i(e,J,["doctype","xml","cdata"],{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]}))&&("esp"!==h.type||h.tail.includes(e[J])))console.log("773 html tag opening"),h.type&&Number.isInteger(h.start)&&h.start!==J?(console.log("776 call dumpCurrentToken()"),B(h,J)):console.log("779 didn't call dumpCurrentToken()"),console.log("782 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N(),h.start=J,h.type="html",console.log("788 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(h.type)),f&&(f=!1,console.log("796 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","styleStarts","[",39,"m")," = false"))),h=Object.assign({tagNameStartAt:null,tagNameEndAt:null,tagName:null,recognised:null,closing:!1,void:!1,pureHTML:!0,esp:[]},h),i(e,J,"!--")?(h.kind="comment",console.log("806 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",h.kind))):i(e,J,"doctype",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(h.kind="doctype",console.log("818 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",h.kind))):i(e,J,"cdata",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(h.kind="cdata",console.log("830 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",h.kind))):i(e,J,"xml",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(h.kind="xml",console.log("842 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",h.kind))):i(e,J,"style",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-","/","\\"]})&&(h.kind="style",console.log("854 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",h.kind)));else if(A.includes(e[J])&&e[J+1]&&A.includes(e[J+1])&&("-"!==e[J]||"-"!==e[J+1])&&(!"0123456789".includes(e[g(e,J)])||e[J+2]&&!['"',"'",";"].includes(e[J+2])&&e[J+2].trim().length)){console.log("874 ESP tag detected");for(var V="",$=J;$<l&&A.includes(e[$]);$++)V+=e[$];if(console.log("889 ".concat("[".concat(32,"m","SET","[",39,"m")," wholeEspTagLump = ",V)),console.log("892 FIY, ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(L,null,4))),console.log("899 FIY, ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(h,null,4))),!(O.includes(V)||Array.isArray(L)&&L.length&&"simple"===L[L.length-1].type&&L[L.length-1].value===e[J+V.length])){var F=void 0;L.length&&R(e,J)?(console.log("921 closing part of a set ".concat("[".concat(32,"m","MATCHED","[",39,"m")," against the last layer")),F=R(e,J),console.log("925 ".concat("[".concat(33,"m","lengthOfClosingEspChunk","[",39,"m")," = ",JSON.stringify(F,null,4))),"esp"===h.type&&(null===h.end&&(h.end=J+F,console.log("938 SET ".concat("[".concat(32,"m","token.end","[",39,"m")," = ",h.end))),console.log("944 ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(h,null,4)," before pinging")),B(h,J),console.log("953 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N()),L.pop(),console.log("961 ".concat("[".concat(32,"m","POP","[",39,"m")," layers"))):L.length&&M(e,J)?(console.log("964 closing part of a set ".concat("[".concat(32,"m","MATCHED","[",39,"m")," against first layer")),console.log("967 wipe all layers, there were strange unclosed characters"),F=M(e,J),console.log("971 ".concat("[".concat(33,"m","lengthOfClosingEspChunk","[",39,"m")," = ",JSON.stringify(F,null,4))),"esp"===h.type&&(null===h.end&&(h.end=J+F,console.log("984 ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(h,null,4)," before pinging"))),B(h,J),console.log("994 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N()),L=[],console.log("1002 ".concat("[".concat(32,"m","WIPE","[",39,"m")," layers"))):(console.log("1005 closing part of a set ".concat("[".concat(31,"m","NOT MATCHED","[",39,"m")," - means it's a new opening")),console.log("1007 push new layer"),L.push({type:"esp",openingLump:V,guessedClosingLump:k(V),position:J}),console.log("1015 ".concat("[".concat(32,"m","PUSH","[",39,"m")," ",JSON.stringify({type:"esp",openingLump:V,guessedClosingLump:k(V),position:J},null,4))),console.log("1027 ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(L,null,4))),"html"===h.type&&("comment"===h.kind||v(C.attribStart)&&null===C.attribEnd)||(console.log("1046 ".concat("[".concat(36,"m","â–ˆâ–ˆ","[",39,"m")," standalone ESP tag")),B(h,J),N(),h.start=J,h.type="esp",console.log("1054 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(h.type)),h.tail=k(V),console.log("1062 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tail","[",39,"m")," = ",h.tail)),h.head=V)),a=J+(F||V.length),console.log("1077 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a))}}else null!==h.start&&h.end!==J||(f?(console.log("1084"),e[J]&&!e[J].trim().length?(console.log("1087 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N(),h.start=J,h.type="text",h.end=u(e,J)||e.length,console.log("1093 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start,"; ","[".concat(33,"m","token.end","[",39,"m")," = ").concat(h.end,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(h.type)),P(h),u(e,J)&&(console.log("1105 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N(),h.start=u(e,J),h.type="css",console.log("1112 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(h.type)),a=u(e,J),console.log("1121 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a)))):(console.log("1126 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),N(),h.start=J,h.type="css",console.log("1132 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(h.type)))):e[J]&&(console.log("1139 ".concat("[".concat(31,"m","reset","[",39,"m")," token")),(h=N()).start=J,console.log("1146 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",h.start)),h.type="text",x(),console.log("1154 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.type","[",39,"m")," = ",h.type,"; ","[".concat(33,"m","token.attribs","[",39,"m")," = ").concat(h.attribs)),console.log("1161 ".concat("[".concat(31,"m","WIPE","[",39,"m")," layers")),L=[]));if(!a)if("html"!==h.type||L.length||">"!==e[J]){if("esp"===h.type&&null===h.end&&y(h.tail)&&h.tail.includes(e[J])){console.log("1186 POSSIBLE ESP TAILS");for(var W="",z=J;z<l&&A.includes(e[z]);z++)W+=e[z];if(console.log("1197 wholeEspTagClosing = ".concat(W)),W.length>h.head.length){console.log("1207 wholeEspTagClosing.length = ".concat("[".concat(33,"m",W.length,"[",39,"m")," > token.head.length = ","[".concat(33,"m",h.head.length,"[",39,"m")));var D=h.head[0];W.endsWith(h.head)?(console.log("1235 - chunk ends with the same heads"),h.end=J+W.length-h.head.length,console.log("1257 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),a=h.end,console.log("1263 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a))):W.startsWith(h.tail)?(h.end=J+h.tail.length,console.log("1268 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),a=h.end,console.log("1274 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a))):!h.tail.includes(D)&&W.includes(D)||W.endsWith(h.head)||W.startsWith(h.tail)?function(){console.log("1282");var t=W.slice(0,W.indexOf(D)),o=W.slice(W.indexOf(D));console.log("".concat("[".concat(33,"m","firstPartOfWholeEspTagClosing","[",39,"m")," = ",JSON.stringify(t,null,4))),console.log("".concat("[".concat(33,"m","secondPartOfWholeEspTagClosing","[",39,"m")," = ",JSON.stringify(o,null,4))),t.length&&o.length&&h.tail.split("").every((function(o){return t.includes(o)}))&&(console.log("1317 definitely tails + new heads"),h.end=J+t.length,console.log("1320 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),a=h.end,console.log("1326 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a)))}():(console.log("CASE #2."),h.end=J+W.length,console.log("1341 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),a=h.end,console.log("1347 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a))),console.log("1350")}else h.end=J+W.length,console.log("1355 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),a=h.end,console.log("1361 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",a))}}else h.end=J+1,console.log("1175 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end));if(a||"html"!==h.type||!v(h.tagNameStartAt)||v(h.tagNameEndAt)||(console.log("1377 catch the end of a tag name clauses"),w(e[J])||v(e[J])||(h.tagNameEndAt=J,console.log("1383 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagNameEndAt","[",39,"m")," = ",h.tagNameEndAt)),h.tagName=e.slice(h.tagNameStartAt,J).toLowerCase(),console.log("1390 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagName","[",39,"m")," = ",h.tagName)),_.includes(h.tagName)&&(h.void=!0,console.log("1401 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.void","[",39,"m")," = ",h.void))),h.recognised=b.includes(h.tagName.toLowerCase())||["doctype","cdata","xml"].includes(h.tagName.toLowerCase()),console.log("1411 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.recognised","[",39,"m")," = ",h.recognised)))),!a&&"html"===h.type&&!v(h.tagNameStartAt)&&v(h.start)&&h.start<J&&("/"===e[J]?(h.closing=!0,console.log("1434 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.closing","[",39,"m")," = ",h.closing))):w(e[J])&&(h.tagNameStartAt=J,console.log("1441 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagNameStartAt","[",39,"m")," = ",h.tagNameStartAt)),h.closing||(h.closing=!1,console.log("1450 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.closing","[",39,"m")," = ",h.closing))))),!a&&"html"===h.type&&v(C.attribNameStartAt)&&J>C.attribNameStartAt&&null===C.attribNameEndAt&&!S(e[J])&&(console.log("1471 inside catch the tag attribute name end clauses"),C.attribNameEndAt=J,C.attribName=e.slice(C.attribNameStartAt,J),C.attribNameRecognised=o.includes(C.attribName),console.log("1476 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribNameEndAt","[",39,"m")," = ",C.attribNameEndAt,"; ","[".concat(33,"m","attrib.attribName","[",39,"m")," = ").concat(JSON.stringify(C.attribName,null,0))),e[J]&&!e[J].trim().length&&"="===e[u(e,J)]?console.log("1487 equal on the right"):(e[J]&&!e[J].trim().length||">"===e[J]||"/"===e[J]&&">"===e[u(e,J)])&&(C.attribEnd=J,console.log("1496 SET ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribNameEndAt","[",39,"m")," = ",C.attribEnd)),h.attribs.push(m(C)),x())),!a&&"html"===h.type&&v(h.tagNameEndAt)&&J>h.tagNameEndAt&&null===C.attribStart&&S(e[J])&&(console.log("1517 inside catch the tag attribute name start clauses"),C.attribStart=J,C.attribNameStartAt=J,console.log("1521 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribStart","[",39,"m")," = ",C.attribStart,"; ","[".concat(33,"m","attrib.attribNameStartAt","[",39,"m")," = ").concat(C.attribNameStartAt))),!a&&"html"===h.type&&v(C.attribValueStartAt)&&J>=C.attribValueStartAt&&null===C.attribValueEndAt&&(console.log("1539 inside catching end of a tag attr clauses"),"'\"".includes(e[J])?e[C.attribOpeningQuoteAt]!==e[J]||L.some((function(t){return"esp"===t.type}))||(console.log("1546 opening and closing quotes matched!"),C.attribClosingQuoteAt=J,C.attribValueEndAt=J,C.attribValue=e.slice(C.attribValueStartAt,J),C.attribEnd=J+1,console.log("1552 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribClosingQuoteAt","[",39,"m")," = ",C.attribClosingQuoteAt,"; ","[".concat(33,"m","attrib.attribValueEndAt","[",39,"m")," = ").concat(C.attribValueEndAt,"; ","[".concat(33,"m","attrib.attribValue","[",39,"m")," = ").concat(C.attribValue,"; ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ").concat(C.attribEnd)),h.attribs.push(m(C)),x()):null===C.attribOpeningQuoteAt&&(!e[J].trim().length||["/",">"].includes(e[J])||A.includes(e[J])&&A.includes(e[J+1]))&&(console.log("1575 opening quote was missing, terminate attr val here"),C.attribValueEndAt=J,C.attribValue=e.slice(C.attribValueStartAt,J),C.attribEnd=J,console.log("1581 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribValueEndAt","[",39,"m")," = ",C.attribValueEndAt,"; ","[".concat(33,"m","attrib.attribValue","[",39,"m")," = ").concat(C.attribValue,"; ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ").concat(C.attribEnd)),h.attribs.push(m(C)),x())),!a&&"html"===h.type&&!v(C.attribValueStartAt)&&v(C.attribNameEndAt)&&C.attribNameEndAt<=J&&e[J].trim().length&&(console.log("1607 inside catching attr value start clauses"),"="!==e[J]||"'\"=".includes(e[u(e,J)])||A.includes(e[u(e,J)])?"'\"".includes(e[J])&&(C.attribOpeningQuoteAt=J,e[J+1]&&(C.attribValueStartAt=J+1),console.log("1625 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribOpeningQuoteAt","[",39,"m")," = ",C.attribOpeningQuoteAt,"; ","[".concat(33,"m","attrib.attribValueStartAt","[",39,"m")," = ").concat(C.attribValueStartAt))):(C.attribValueStartAt=u(e,J),console.log("1615 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribValueStartAt","[",39,"m")," = ",C.attribValueStartAt)))),">"===e[J]&&"html"===h.type&&null!==C.attribStart&&null===C.attribEnd){console.log("1656 ".concat("[".concat(31,"m","â–ˆâ–ˆ","[",39,"m")," bracket within attribute's value"));var H=!1;if(e[J+1])for(var q=J+1;q<l;q++){if(console.log("1675 ".concat("[".concat(36,"m","str[".concat(q,"] = ").concat(JSON.stringify(e[q],null,0)),"[",39,"m"))),null!==C.attribOpeningQuoteAt&&e[q]===e[C.attribOpeningQuoteAt]){console.log("1688 closing quote (".concat(e[C.attribOpeningQuoteAt],") found, ","[".concat(31,"m","BREAK","[",39,"m"))),q!==J+1&&"="!==e[q-1]&&(H=!0,console.log("1695 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",H)));break}if(">"===e[q])break;if("<"===e[q]){H=!0,console.log("1706 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",H)),L.pop(),console.log("1713 ".concat("[".concat(31,"m","POP","[",39,"m")," ","[".concat(33,"m","layers","[",39,"m"),", now:\n",JSON.stringify(L,null,4))),console.log("1720 break");break}if(!e[q+1]){H=!0,console.log("1726 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",H)),console.log("1729 break");break}}else console.log("1734 string ends so this was the bracket"),H=!0;H&&(h.end=J+1,console.log("1750 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",h.end)),Number.isInteger(C.attribValueStartAt)&&C.attribValueStartAt<J&&e.slice(C.attribValueStartAt,J).trim().length?(C.attribValueEndAt=J,C.attribValue=e.slice(C.attribValueStartAt,J)):C.attribValueStartAt=null,C.attribEnd=J,console.log("1772 ".concat("[".concat(32,"m","SET","[",39,"m"),"  ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ",C.attribEnd)),console.log("1779 ".concat("[".concat(32,"m","attrib wipe, push and reset","[",39,"m"))),h.attribs.push(m(C)),x())}e[J]&&c.charCb&&(console.log("1808 ".concat("[".concat(32,"m","PING","[",39,"m")," ",JSON.stringify({type:h.type,chr:e[J],i:J},null,4))),I={type:h.type,chr:e[J],i:J},c.charCb&&c.charCb(I)),e[J]||null===h.start||(h.end=J,console.log("1838 ".concat("[".concat(32,"m","PING","[",39,"m"))),P(h)),console.log("".concat("[".concat(90,"m","==========================================\nâ–ˆâ–ˆ token: ".concat(JSON.stringify(h,null,4)).concat(null!==C.attribStart?"\nâ–ˆâ–ˆ attrib: ".concat(JSON.stringify(C,null,4)):"").concat(L.length?"\nâ–ˆâ–ˆ layers: ".concat(JSON.stringify(L,null,4)):""),"[",39,"m"),a?"\n".concat("[".concat(31,"m","DO NOTHING UNTIL ".concat(a),"[",39,"m")):"")),console.log("".concat("[".concat(90,"m","styleStarts = ".concat(f),"[",39,"m")))}}}));
