/**
 * codsen-parser
 * Parser aiming at broken or mixed code, especially HTML & CSS
 * Version: 0.10.3
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/codsen-parser/
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).codsenParser={})}(this,(function(t){"use strict";function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function o(t){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?n(Object(r),!0).forEach((function(n){e(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){return t.includes(".")&&/^\d*$/.test(t.slice(t.lastIndexOf(".")+1))?""+t.slice(0,t.lastIndexOf(".")+1)+(+t.slice(t.lastIndexOf(".")+1)+1):/^\d*$/.test(t)?""+(+t+1):t}function l(t){if(t.includes(".")&&t.slice(t.indexOf(".")+1).includes("."))for(var e=0,n=t.length;n--;)if("."===t[n]&&(e+=1),2===e)return t.slice(0,n);return"0"}Function.prototype.toString.call(Object);var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t){var e={exports:{}};return t(e,e.exports),e.exports}var a=s((function(t,e){var n="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",l="[object Boolean]",s="[object Date]",a="[object Function]",m="[object GeneratorFunction]",u="[object Map]",c="[object Number]",g="[object Object]",p="[object Promise]",d="[object RegExp]",f="[object Set]",h="[object String]",b="[object Symbol]",y="[object WeakMap]",S="[object ArrayBuffer]",v="[object DataView]",E="[object Float32Array]",O="[object Float64Array]",k="[object Int8Array]",A="[object Int16Array]",N="[object Int32Array]",T="[object Uint8Array]",w="[object Uint8ClampedArray]",C="[object Uint16Array]",V="[object Uint32Array]",x=/\w*$/,_=/^\[object .+?Constructor\]$/,J=/^(?:0|[1-9]\d*)$/,P={};P[r]=P["[object Array]"]=P[S]=P[v]=P[l]=P[s]=P[E]=P[O]=P[k]=P[A]=P[N]=P[u]=P[c]=P[g]=P[d]=P[f]=P[h]=P[b]=P[T]=P[w]=P[C]=P[V]=!0,P["[object Error]"]=P[a]=P[y]=!1;var I="object"==typeof self&&self&&self.Object===Object&&self,L="object"==typeof i&&i&&i.Object===Object&&i||I||Function("return this")(),R=e&&!e.nodeType&&e,M=R&&t&&!t.nodeType&&t,j=M&&M.exports===R;function F(t,e){return t.set(e[0],e[1]),t}function B(t,e){return t.add(e),t}function W(t,e,n,o){var r=-1,l=t?t.length:0;for(o&&l&&(n=t[++r]);++r<l;)n=e(n,t[r],r,t);return n}function H(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function D(t){var e=-1,n=Array(t.size);return t.forEach((function(t,o){n[++e]=[o,t]})),n}function q(t,e){return function(n){return t(e(n))}}function U(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Q,z=Array.prototype,G=Function.prototype,Y=Object.prototype,$=L["__core-js_shared__"],K=(Q=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"",Z=G.toString,X=Y.hasOwnProperty,tt=Y.toString,et=RegExp("^"+Z.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=j?L.Buffer:void 0,ot=L.Symbol,rt=L.Uint8Array,lt=q(Object.getPrototypeOf,Object),it=Object.create,st=Y.propertyIsEnumerable,at=z.splice,mt=Object.getOwnPropertySymbols,ut=nt?nt.isBuffer:void 0,ct=q(Object.keys,Object),gt=Mt(L,"DataView"),pt=Mt(L,"Map"),dt=Mt(L,"Promise"),ft=Mt(L,"Set"),ht=Mt(L,"WeakMap"),bt=Mt(Object,"create"),yt=Ht(gt),St=Ht(pt),vt=Ht(dt),Et=Ht(ft),Ot=Ht(ht),kt=ot?ot.prototype:void 0,At=kt?kt.valueOf:void 0;function Nt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Tt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function wt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function Ct(t){this.__data__=new Tt(t)}function Vt(t,e){var n=qt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Ut(t)}(t)&&X.call(t,"callee")&&(!st.call(t,"callee")||tt.call(t)==r)}(t)?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],o=n.length,l=!!o;for(var i in t)!e&&!X.call(t,i)||l&&("length"==i||Bt(i,o))||n.push(i);return n}function xt(t,e,n){var o=t[e];X.call(t,e)&&Dt(o,n)&&(void 0!==n||e in t)||(t[e]=n)}function _t(t,e){for(var n=t.length;n--;)if(Dt(t[n][0],e))return n;return-1}function Jt(t,e,n,o,i,p,y){var _;if(o&&(_=p?o(t,i,p,y):o(t)),void 0!==_)return _;if(!Gt(t))return t;var J=qt(t);if(J){if(_=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&X.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!e)return function(t,e){var n=-1,o=t.length;e||(e=Array(o));for(;++n<o;)e[n]=t[n];return e}(t,_)}else{var I=Ft(t),L=I==a||I==m;if(Qt(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(I==g||I==r||L&&!p){if(H(t))return p?t:{};if(_=function(t){return"function"!=typeof t.constructor||Wt(t)?{}:(e=lt(t),Gt(e)?it(e):{});var e}(L?{}:t),!e)return function(t,e){return Lt(t,jt(t),e)}(t,function(t,e){return t&&Lt(e,Yt(e),t)}(_,t))}else{if(!P[I])return p?t:{};_=function(t,e,n,o){var r=t.constructor;switch(e){case S:return It(t);case l:case s:return new r(+t);case v:return function(t,e){var n=e?It(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,o);case E:case O:case k:case A:case N:case T:case w:case C:case V:return function(t,e){var n=e?It(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,o);case u:return function(t,e,n){return W(e?n(D(t),!0):D(t),F,new t.constructor)}(t,o,n);case c:case h:return new r(t);case d:return function(t){var e=new t.constructor(t.source,x.exec(t));return e.lastIndex=t.lastIndex,e}(t);case f:return function(t,e,n){return W(e?n(U(t),!0):U(t),B,new t.constructor)}(t,o,n);case b:return i=t,At?Object(At.call(i)):{}}var i}(t,I,Jt,e)}}y||(y=new Ct);var R=y.get(t);if(R)return R;if(y.set(t,_),!J)var M=n?function(t){return function(t,e,n){var o=e(t);return qt(t)?o:function(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}(o,n(t))}(t,Yt,jt)}(t):Yt(t);return function(t,e){for(var n=-1,o=t?t.length:0;++n<o&&!1!==e(t[n],n,t););}(M||t,(function(r,l){M&&(r=t[l=r]),xt(_,l,Jt(r,e,n,o,l,t,y))})),_}function Pt(t){return!(!Gt(t)||(e=t,K&&K in e))&&(zt(t)||H(t)?et:_).test(Ht(t));var e}function It(t){var e=new t.constructor(t.byteLength);return new rt(e).set(new rt(t)),e}function Lt(t,e,n,o){n||(n={});for(var r=-1,l=e.length;++r<l;){var i=e[r],s=o?o(n[i],t[i],i,n,t):void 0;xt(n,i,void 0===s?t[i]:s)}return n}function Rt(t,e){var n,o,r=t.__data__;return("string"==(o=typeof(n=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Mt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(n)?n:void 0}Nt.prototype.clear=function(){this.__data__=bt?bt(null):{}},Nt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Nt.prototype.get=function(t){var e=this.__data__;if(bt){var o=e[t];return o===n?void 0:o}return X.call(e,t)?e[t]:void 0},Nt.prototype.has=function(t){var e=this.__data__;return bt?void 0!==e[t]:X.call(e,t)},Nt.prototype.set=function(t,e){return this.__data__[t]=bt&&void 0===e?n:e,this},Tt.prototype.clear=function(){this.__data__=[]},Tt.prototype.delete=function(t){var e=this.__data__,n=_t(e,t);return!(n<0)&&(n==e.length-1?e.pop():at.call(e,n,1),!0)},Tt.prototype.get=function(t){var e=this.__data__,n=_t(e,t);return n<0?void 0:e[n][1]},Tt.prototype.has=function(t){return _t(this.__data__,t)>-1},Tt.prototype.set=function(t,e){var n=this.__data__,o=_t(n,t);return o<0?n.push([t,e]):n[o][1]=e,this},wt.prototype.clear=function(){this.__data__={hash:new Nt,map:new(pt||Tt),string:new Nt}},wt.prototype.delete=function(t){return Rt(this,t).delete(t)},wt.prototype.get=function(t){return Rt(this,t).get(t)},wt.prototype.has=function(t){return Rt(this,t).has(t)},wt.prototype.set=function(t,e){return Rt(this,t).set(t,e),this},Ct.prototype.clear=function(){this.__data__=new Tt},Ct.prototype.delete=function(t){return this.__data__.delete(t)},Ct.prototype.get=function(t){return this.__data__.get(t)},Ct.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Tt){var o=n.__data__;if(!pt||o.length<199)return o.push([t,e]),this;n=this.__data__=new wt(o)}return n.set(t,e),this};var jt=mt?q(mt,Object):function(){return[]},Ft=function(t){return tt.call(t)};function Bt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||J.test(t))&&t>-1&&t%1==0&&t<e}function Wt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Y)}function Ht(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Dt(t,e){return t===e||t!=t&&e!=e}(gt&&Ft(new gt(new ArrayBuffer(1)))!=v||pt&&Ft(new pt)!=u||dt&&Ft(dt.resolve())!=p||ft&&Ft(new ft)!=f||ht&&Ft(new ht)!=y)&&(Ft=function(t){var e=tt.call(t),n=e==g?t.constructor:void 0,o=n?Ht(n):void 0;if(o)switch(o){case yt:return v;case St:return u;case vt:return p;case Et:return f;case Ot:return y}return e});var qt=Array.isArray;function Ut(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}(t.length)&&!zt(t)}var Qt=ut||function(){return!1};function zt(t){var e=Gt(t)?tt.call(t):"";return e==a||e==m}function Gt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Yt(t){return Ut(t)?Vt(t):function(t){if(!Wt(t))return ct(t);var e=[];for(var n in Object(t))X.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return Jt(t,!0,!0)}})),m="Â ";function u(t,e){return void 0===e&&(e=0),function(t){var e=t.str,n=t.idx,o=void 0===n?0:n,r=t.stopAtNewlines,l=void 0!==r&&r,i=t.stopAtRawNbsp,s=void 0!==i&&i;if("string"!=typeof e||!e.length)return null;if(o&&"number"==typeof o||(o=0),!e[o+1])return null;if(e[o+1]&&(e[o+1].trim()||l&&"\n\r".includes(e[o+1])||s&&e[o+1]===m))return o+1;if(e[o+2]&&(e[o+2].trim()||l&&"\n\r".includes(e[o+2])||s&&e[o+2]===m))return o+2;for(var a=o+1,u=e.length;a<u;a++)if(e[a].trim()||l&&"\n\r".includes(e[a])||s&&e[a]===m)return a;return null}({str:t,idx:e,stopAtNewlines:!1,stopAtRawNbsp:!1})}function c(t,e){return void 0===e&&(e=0),function(t){var e=t.str,n=t.idx,o=t.stopAtNewlines,r=t.stopAtRawNbsp;if("string"!=typeof e||!e.length)return null;if(n&&"number"==typeof n||(n=0),n<1)return null;if(e[~-n]&&(e[~-n].trim()||o&&"\n\r".includes(e[~-n])||r&&e[~-n]===m))return~-n;if(e[n-2]&&(e[n-2].trim()||o&&"\n\r".includes(e[n-2])||r&&e[n-2]===m))return n-2;for(var l=n;l--;)if(e[l]&&(e[l].trim()||o&&"\n\r".includes(e[l])||r&&e[l]===m))return l;return null}({str:t,idx:e,stopAtNewlines:!1,stopAtRawNbsp:!1})}function g(t){return"string"==typeof t}var p={stringOffset:0,maxDistance:1,ignoreWhitespace:!0};function d(t,e,n,r){if(!g(t))throw new TypeError("string-find-malformed: [THROW_ID_01] the first input argument, string where to look for, must be a string! Currently it's equal to: "+t+" (type: "+typeof t+")");if(t.length){if(!g(e))throw new TypeError("string-find-malformed: [THROW_ID_02] the second input argument, string we should find, must be a string! Currently it's equal to: "+e+" (type: "+typeof e+")");if(e.length){if("function"!=typeof n)throw new TypeError("string-find-malformed: [THROW_ID_03] the third input argument, a callback function, must be a function! Currently it's equal to: "+n+" (type: "+typeof n+")");if(r&&(!(l=r)||"object"!=typeof l||Array.isArray(l)))throw new TypeError("string-find-malformed: [THROW_ID_04] the fourth input argument, an Optional Options Object, must be a plain object! Currently it's equal to: "+r+" (type: "+typeof r+")");var l,i=o(o({},p),r);if("string"==typeof i.stringOffset&&/^\d*$/.test(i.stringOffset))i.stringOffset=Number(i.stringOffset);else if(!Number.isInteger(i.stringOffset)||i.stringOffset<0)throw new TypeError("[THROW_ID_05] opts.stringOffset must be a natural number or zero! Currently it's: "+i.stringOffset);for(var s,a=t.length,m=Math.min(e.length,(i.maxDistance||0)+1),c=[],d=i.maxDistance||1,f=0;f<a;f++)if(!i.ignoreWhitespace||t[f].trim()){for(var h=0,b=c.length;h<b;h++)s=!1,Array.isArray(c[h].pendingToCheck)&&c[h].pendingToCheck.length&&t[f]===c[h].pendingToCheck[0]?(s=!0,c[h].pendingToCheck.shift()):Array.isArray(c[h].pendingToCheck)&&c[h].pendingToCheck.length&&t[f]===c[h].pendingToCheck[1]?(s=!0,c[h].pendingToCheck.shift(),c[h].pendingToCheck.shift(),c[h].patienceLeft-=1):(c[h].patienceLeft-=1,t[u(t,f)]!==c[h].pendingToCheck[0]&&(c[h].pendingToCheck.shift(),t[f]===c[h].pendingToCheck[0]&&c[h].pendingToCheck.shift()));var y=(c=c.filter((function(t){return t.patienceLeft>=0}))).filter((function(t){return 0===t.pendingToCheck.length})).map((function(t){return t.startsAt}));if(Array.isArray(y)&&y.length){var S=Math.min.apply(Math,y),v=f+(s?1:0);t.slice(S,v)!==e&&n({idxFrom:S+(i.stringOffset||0),idxTo:v+(i.stringOffset||0)}),c=c.filter((function(t){return t.pendingToCheck.length}))}for(var E=0;E<m;E++)if(t[f]===e[E]){var O={startsAt:f,patienceLeft:d-E,pendingToCheck:Array.from(e.slice(E+1))};c.push(O);break}}}}}function f(t){return t&&"object"==typeof t&&!Array.isArray(t)}function h(t){return"string"==typeof t}var b={cb:void 0,i:!1,trimBeforeMatching:!1,trimCharsBeforeMatching:[],maxMismatches:0,firstMustMatch:!1,lastMustMatch:!1,hungry:!1},y=function(t){return t+1};function S(t,e,n,r,l,i){void 0===l&&(l=!1),void 0===i&&(i=y);var s="function"==typeof n?n():n;if(+e<0&&l&&"EOL"===s)return s;var a=o(o({},b),r);if(e>=t.length&&!l)return!1;var m=l?1:n.length,u=0,c=!1,g=!1,p=!1,d=a.maxMismatches,f=e,h=!1,S=!1,v=!1;function E(){return 1===u&&d<a.maxMismatches-1}for(;t[f];){var O=i(f);if(a.trimBeforeMatching&&""===t[f].trim()){if(!t[O]&&l&&"EOL"===n)return!0;f=i(f)}else if(a&&!a.i&&a.trimCharsBeforeMatching&&a.trimCharsBeforeMatching.includes(t[f])||a&&a.i&&a.trimCharsBeforeMatching&&a.trimCharsBeforeMatching.map((function(t){return t.toLowerCase()})).includes(t[f].toLowerCase())){if(l&&"EOL"===n&&!t[O])return!0;f=i(f)}else{var k=O>f?n[n.length-m]:n[m-1];if(!a.i&&t[f]===k||a.i&&t[f].toLowerCase()===k.toLowerCase()){if(h||(h=!0),p||(p=!0),m===n.length){if(S=!0,d!==a.maxMismatches)return!1}else 1===m&&(v=!0);if(m-=1,u++,E())return!1;if(!m)return(u!==n.length||d===a.maxMismatches||!c)&&f}else{if(c||u||(c=!0),!(a.maxMismatches&&d&&f))return!(0!==f||1!==m||a.lastMustMatch||!p)&&0;d-=1;for(var A=0;A<=d;A++){var N=O>f?n[n.length-m+1+A]:n[m-2-A],T=t[i(f)];if(N&&(!a.i&&t[f]===N||a.i&&t[f].toLowerCase()===N.toLowerCase())&&(!a.firstMustMatch||m!==n.length)){if(u++,E())return!1;m-=2,h=!0;break}if(T&&N&&(!a.i&&T===N||a.i&&T.toLowerCase()===N.toLowerCase())&&(!a.firstMustMatch||m!==n.length)){if(!u&&!a.hungry)return!1;m-=1,h=!0;break}if(void 0===N&&d>=0&&h&&(!a.firstMustMatch||S)&&(!a.lastMustMatch||v))return f}h||(g=f)}if(!1!==g&&g!==f&&(g=!1),m<1)return f;f=i(f)}}return m>0?!(!l||"EOL"!==s)||!!(a&&a.maxMismatches>=m&&p)&&(g||0):void 0}function v(t,e,n,r,l){if(f(l)&&Object.prototype.hasOwnProperty.call(l,"trimBeforeMatching")&&"boolean"!=typeof l.trimBeforeMatching)throw new Error("string-match-left-right/"+t+"(): [THROW_ID_09] opts.trimBeforeMatching should be boolean!"+(Array.isArray(l.trimBeforeMatching)?" Did you mean to use opts.trimCharsBeforeMatching?":""));var i,s,a,m=o(o({},b),l);if("string"==typeof m.trimCharsBeforeMatching&&(m.trimCharsBeforeMatching="string"==typeof(i=m.trimCharsBeforeMatching)?i.length?[i]:[]:i),m.trimCharsBeforeMatching=m.trimCharsBeforeMatching.map((function(t){return h(t)?t:String(t)})),!h(e))return!1;if(!e.length)return!1;if(!Number.isInteger(n)||n<0)throw new Error("string-match-left-right/"+t+"(): [THROW_ID_03] the second argument should be a natural number. Currently it's of a type: "+typeof n+", equal to:\n"+JSON.stringify(n,null,4));if(h(r))s=[r];else if(Array.isArray(r))s=r;else if(r){if("function"!=typeof r)throw new Error("string-match-left-right/"+t+"(): [THROW_ID_05] the third argument, whatToMatch, is neither string nor array of strings! It's "+typeof r+", equal to:\n"+JSON.stringify(r,null,4));(s=[]).push(r)}else s=r;if(l&&!f(l))throw new Error("string-match-left-right/"+t+"(): [THROW_ID_06] the fourth argument, options object, should be a plain object. Currently it's of a type \""+typeof l+'", and equal to:\n'+JSON.stringify(l,null,4));var u=0,c="";if(m&&m.trimCharsBeforeMatching&&m.trimCharsBeforeMatching.some((function(t,e){return t.length>1&&(u=e,c=t,!0)})))throw new Error("string-match-left-right/"+t+"(): [THROW_ID_07] the fourth argument, options object contains trimCharsBeforeMatching. It was meant to list the single characters but one of the entries at index "+u+" is longer than 1 character, "+c.length+" (equals to "+c+"). Please split it into separate characters and put into array as separate elements.");if(!s||!Array.isArray(s)||Array.isArray(s)&&!s.length||Array.isArray(s)&&1===s.length&&h(s[0])&&!s[0].trim()){if("function"==typeof m.cb){var g,p=n;if("matchLeftIncl"!==t&&"matchRight"!==t||(p+=1),"L"===t[5])for(var d=p;d--;){var y=e[d];if((!m.trimBeforeMatching||m.trimBeforeMatching&&void 0!==y&&y.trim())&&(!m.trimCharsBeforeMatching||!m.trimCharsBeforeMatching.length||void 0!==y&&!m.trimCharsBeforeMatching.includes(y))){g=d;break}}else if(t.startsWith("matchRight"))for(var v=p;v<e.length;v++){var E=e[v];if((!m.trimBeforeMatching||m.trimBeforeMatching&&E.trim())&&(!m.trimCharsBeforeMatching||!m.trimCharsBeforeMatching.length||!m.trimCharsBeforeMatching.includes(E))){g=v;break}}if(void 0===g)return!1;var O=e[g],k=g+1,A="";return k&&k>0&&(A=e.slice(0,k)),"L"===t[5]?m.cb(O,A,g):(g&&g>0&&(A=e.slice(g)),m.cb(O,A,g))}var N="";throw l||(N=" More so, the whole options object, the fourth input argument, is missing!"),new Error("string-match-left-right/"+t+'(): [THROW_ID_08] the third argument, "whatToMatch", was given as an empty string. This means, you intend to match purely by a callback. The callback was not set though, the opts key "cb" is not set!'+N)}for(var T=0,w=s.length;T<w;T++){var C=s[T],V=void 0,x=void 0,_="",J=n;"matchRight"===t?J+=1:"matchLeft"===t&&(J-=1);var P=S(e,J,C,m,a="function"==typeof s[T],(function(e){return"L"===t[5]?e-1:e+1}));if(P&&a&&"function"==typeof C&&"EOL"===C())return!(!C()||m.cb&&!m.cb(V,_,x))&&C();if(Number.isInteger(P)&&(x=t.startsWith("matchLeft")?P-1:P+1,_="L"===t[5]?e.slice(0,P):e.slice(x)),x<0&&(x=void 0),e[x]&&(V=e[x]),Number.isInteger(P)&&(!m.cb||m.cb(V,_,x)))return C}return!1}function E(t,e,n,o){return v("matchLeft",t,e,n,o)}function O(t,e,n,o){return v("matchRightIncl",t,e,n,o)}function k(t,e,n,o){return v("matchRight",t,e,n,o)}var A=new Set(["abbr","accept","accept-charset","accesskey","action","align","alink","allow","alt","archive","async","autocapitalize","autocomplete","autofocus","autoplay","axis","background","background-attachment","background-color","background-image","background-position","background-position-x","background-position-y","background-repeat","bgcolor","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","buffered","capture","cellpadding","cellspacing","challenge","char","charoff","charset","checked","cite","class","classid","clear","clip","code","codebase","codetype","color","cols","colspan","column-span","compact","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","cursor","data","data-*","datetime","declare","decoding","default","defer","dir","direction","dirname","disabled","display","download","draggable","dropzone","enctype","enterkeyhint","face","filter","float","font","font-color","font-emphasize","font-emphasize-position","font-emphasize-style","font-family","font-size","font-style","font-variant","font-weight","for","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","frontuid","headers","height","hidden","high","horiz-align","href","hreflang","hspace","http-equiv","icon","id","importance","inputmode","integrity","intrinsicsize","ismap","itemprop","keytype","kind","label","lang","language","layout-flow","layout-grid","layout-grid-char","layout-grid-line","layout-grid-mode","layout-grid-type","left","letter-spacing","line-break","line-height","link","list","list-image-1","list-image-2","list-image-3","list-style","list-style-image","list-style-position","list-style-type","loading","longdesc","loop","low","manifest","margin","margin-bottom","margin-left","margin-right","margin-top","marginheight","marginwidth","max","maxlength","media","method","min","minlength","mso-ansi-font-size","mso-ansi-font-style","mso-ansi-font-weight","mso-ansi-language","mso-ascii-font-family","mso-background","mso-background-source","mso-baseline-position","mso-bidi-flag","mso-bidi-font-family","mso-bidi-font-size","mso-bidi-font-style","mso-bidi-font-weight","mso-bidi-language","mso-bookmark","mso-border-alt","mso-border-between","mso-border-between-color","mso-border-between-style","mso-border-between-width","mso-border-bottom-alt","mso-border-bottom-color-alt","mso-border-bottom-source","mso-border-bottom-style-alt","mso-border-bottom-width-alt","mso-border-color-alt","mso-border-effect","mso-border-left-alt","mso-border-left-color-alt","mso-border-left-source","mso-border-left-style-alt","mso-border-left-width-alt","mso-border-right-alt","mso-border-right-color-alt","mso-border-right-source","mso-border-right-style-alt","mso-border-right-width-alt","mso-border-shadow","mso-border-source","mso-border-style-alt","mso-border-top-alt","mso-border-top-color-alt","mso-border-top-source","mso-border-top-style-alt","mso-border-top-width-alt","mso-border-width-alt","mso-break-type","mso-build","mso-build-after-action","mso-build-after-color","mso-build-auto-secs","mso-build-avi","mso-build-dual-id","mso-build-order","mso-build-sound-name","mso-bullet-image","mso-cell-special","mso-cellspacing","mso-char-indent","mso-char-indent-count","mso-char-indent-size","mso-char-type","mso-char-wrap","mso-color-alt","mso-color-index","mso-color-source","mso-column-break-before","mso-column-separator","mso-columns","mso-comment-author","mso-comment-continuation","mso-comment-id","mso-comment-reference","mso-data-placement","mso-default-height","mso-default-width","mso-diagonal-down","mso-diagonal-down-color","mso-diagonal-down-source","mso-diagonal-down-style","mso-diagonal-down-width","mso-diagonal-up","mso-diagonal-up-color","mso-diagonal-up-source","mso-diagonal-up-style","mso-diagonal-up-width","mso-displayed-decimal-separator","mso-displayed-thousand-separator","mso-element","mso-element-anchor-horizontal","mso-element-anchor-lock","mso-element-anchor-vertical","mso-element-frame-height","mso-element-frame-hspace","mso-element-frame-vspace","mso-element-frame-width","mso-element-left","mso-element-linespan","mso-element-top","mso-element-wrap","mso-endnote-continuation-notice","mso-endnote-continuation-notice-id","mso-endnote-continuation-notice-src","mso-endnote-continuation-separator","mso-endnote-continuation-separator-id","mso-endnote-continuation-separator-src","mso-endnote-display","mso-endnote-id","mso-endnote-numbering","mso-endnote-numbering-restart","mso-endnote-numbering-start","mso-endnote-numbering-style","mso-endnote-position","mso-endnote-separator","mso-endnote-separator-id","mso-endnote-separator-src","mso-even-footer","mso-even-footer-id","mso-even-footer-src","mso-even-header","mso-even-header-id","mso-even-header-src","mso-facing-pages","mso-fareast-font-family","mso-fareast-hint","mso-fareast-language","mso-field-change","mso-field-change-author","mso-field-change-time","mso-field-change-value","mso-field-code","mso-field-lock","mso-fills-color","mso-first-footer","mso-first-footer-id","mso-first-footer-src","mso-first-header","mso-first-header-id","mso-first-header-src","mso-font-alt","mso-font-charset","mso-font-format","mso-font-info","mso-font-info-charset","mso-font-info-type","mso-font-kerning","mso-font-pitch","mso-font-signature","mso-font-signature-csb-one","mso-font-signature-csb-two","mso-font-signature-usb-four","mso-font-signature-usb-one","mso-font-signature-usb-three","mso-font-signature-usb-two","mso-font-src","mso-font-width","mso-footer","mso-footer-data","mso-footer-id","mso-footer-margin","mso-footer-src","mso-footnote-continuation-notice","mso-footnote-continuation-notice-id","mso-footnote-continuation-notice-src","mso-footnote-continuation-separator","mso-footnote-continuation-separator-id","mso-footnote-continuation-separator-src","mso-footnote-id","mso-footnote-numbering","mso-footnote-numbering-restart","mso-footnote-numbering-start","mso-footnote-numbering-style","mso-footnote-position","mso-footnote-separator","mso-footnote-separator-id","mso-footnote-separator-src","mso-foreground","mso-forms-protection","mso-generic-font-family","mso-grid-bottom","mso-grid-bottom-count","mso-grid-left","mso-grid-left-count","mso-grid-right","mso-grid-right-count","mso-grid-top","mso-grid-top-count","mso-gutter-direction","mso-gutter-margin","mso-gutter-position","mso-hansi-font-family","mso-header","mso-header-data","mso-header-id","mso-header-margin","mso-header-src","mso-height-alt","mso-height-rule","mso-height-source","mso-hide","mso-highlight","mso-horizontal-page-align","mso-hyphenate","mso-ignore","mso-kinsoku-overflow","mso-layout-grid-align","mso-layout-grid-char-alt","mso-layout-grid-origin","mso-level-inherit","mso-level-legacy","mso-level-legacy-indent","mso-level-legacy-space","mso-level-legal-format","mso-level-number-format","mso-level-number-position","mso-level-numbering","mso-level-reset-level","mso-level-start-at","mso-level-style-link","mso-level-suffix","mso-level-tab-stop","mso-level-text","mso-line-break-override","mso-line-grid","mso-line-height-alt","mso-line-height-rule","mso-line-numbers-count-by","mso-line-numbers-distance","mso-line-numbers-restart","mso-line-numbers-start","mso-line-spacing","mso-linked-frame","mso-list","mso-list-change","mso-list-change-author","mso-list-change-time","mso-list-change-values","mso-list-id","mso-list-ins","mso-list-ins-author","mso-list-ins-time","mso-list-name","mso-list-template-ids","mso-list-type","mso-margin-bottom-alt","mso-margin-left-alt","mso-margin-top-alt","mso-mirror-margins","mso-negative-indent-tab","mso-number-format","mso-outline-level","mso-outline-parent","mso-outline-parent-col","mso-outline-parent-row","mso-outline-parent-visibility","mso-outline-style","mso-padding-alt","mso-padding-between","mso-padding-bottom-alt","mso-padding-left-alt","mso-padding-right-alt","mso-padding-top-alt","mso-page-border-aligned","mso-page-border-art","mso-page-border-bottom-art","mso-page-border-display","mso-page-border-left-art","mso-page-border-offset-from","mso-page-border-right-art","mso-page-border-surround-footer","mso-page-border-surround-header","mso-page-border-top-art","mso-page-border-z-order","mso-page-numbers","mso-page-numbers-chapter-separator","mso-page-numbers-chapter-style","mso-page-numbers-start","mso-page-numbers-style","mso-page-orientation","mso-page-scale","mso-pagination","mso-panose-arm-style","mso-panose-contrast","mso-panose-family-type","mso-panose-letterform","mso-panose-midline","mso-panose-proportion","mso-panose-serif-style","mso-panose-stroke-variation","mso-panose-weight","mso-panose-x-height","mso-paper-source","mso-paper-source-first-page","mso-paper-source-other-pages","mso-pattern","mso-pattern-color","mso-pattern-style","mso-print-area","mso-print-color","mso-print-gridlines","mso-print-headings","mso-print-resolution","mso-print-sheet-order","mso-print-title-column","mso-print-title-row","mso-prop-change","mso-prop-change-author","mso-prop-change-time","mso-protection","mso-rotate","mso-row-margin-left","mso-row-margin-right","mso-ruby-merge","mso-ruby-visibility","mso-scheme-fill-color","mso-scheme-shadow-color","mso-shading","mso-shadow-color","mso-space-above","mso-space-below","mso-spacerun","mso-special-character","mso-special-format","mso-style-id","mso-style-name","mso-style-next","mso-style-parent","mso-style-type","mso-style-update","mso-subdocument","mso-symbol-font-family","mso-tab-count","mso-table-anchor-horizontal","mso-table-anchor-vertical","mso-table-bspace","mso-table-del-author","mso-table-del-time","mso-table-deleted","mso-table-dir","mso-table-ins-author","mso-table-ins-time","mso-table-inserted","mso-table-layout-alt","mso-table-left","mso-table-lspace","mso-table-overlap","mso-table-prop-author","mso-table-prop-change","mso-table-prop-time","mso-table-rspace","mso-table-top","mso-table-tspace","mso-table-wrap","mso-text-animation","mso-text-combine-brackets","mso-text-combine-id","mso-text-control","mso-text-fit-id","mso-text-indent-alt","mso-text-orientation","mso-text-raise","mso-title-page","mso-tny-compress","mso-unsynced","mso-vertical-align-alt","mso-vertical-align-special","mso-vertical-page-align","mso-width-alt","mso-width-source","mso-word-wrap","mso-xlrowspan","mso-zero-height","multiple","muted","name","nav-banner-image","navbutton_background_color","navbutton_home_hovered","navbutton_home_normal","navbutton_home_pushed","navbutton_horiz_hovered","navbutton_horiz_normal","navbutton_horiz_pushed","navbutton_next_hovered","navbutton_next_normal","navbutton_next_pushed","navbutton_prev_hovered","navbutton_prev_normal","navbutton_prev_pushed","navbutton_up_hovered","navbutton_up_normal","navbutton_up_pushed","navbutton_vert_hovered","navbutton_vert_normal","navbutton_vert_pushed","nohref","noresize","noshade","novalidate","nowrap","object","onblur","onchange","onclick","ondblclick","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload","open","optimum","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","panose-1","pattern","ping","placeholder","position","poster","preload","profile","prompt","punctuation-trim","punctuation-wrap","radiogroup","readonly","referrerpolicy","rel","required","rev","reversed","right","row-span","rows","rowspan","ruby-align","ruby-overhang","ruby-position","rules","sandbox","scheme","scope","scoped","scrolling","selected","separator-image","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","standby","start","step","style","summary","tab-interval","tab-stops","tabindex","table-border-color-dark","table-border-color-light","table-layout","target","text","text-align","text-autospace","text-combine","text-decoration","text-effect","text-fit","text-indent","text-justify","text-justify-trim","text-kashida","text-line-through","text-shadow","text-transform","text-underline","text-underline-color","text-underline-style","title","top","top-bar-button","translate","type","unicode-bidi","urlId","usemap","valign","value","valuetype","version","vert-align","vertical-align","visibility","vlink","vnd.ms-excel.numberformat","vspace","white-space","width","word-break","word-spacing","wrap","xmlns","z-index"]);function N(t){return"string"==typeof t&&(t.charCodeAt(0)>96&&t.charCodeAt(0)<123||t.charCodeAt(0)>64&&t.charCodeAt(0)<91||t.charCodeAt(0)>47&&t.charCodeAt(0)<58||":"===t||"-"===t)}function T(t){return"'"===t?'"':"'"}function w(t,e,n,o){void 0===o&&(o=[]);for(var r=function(e,r){return o.some((function(n){return t.startsWith(n,e)}))?{v:!0}:t[e]===n?{v:!1}:void 0},l=e,i=t.length;l<i;l++){var s=r(l);if("object"==typeof s)return s.v}return!0}function C(t,e,n,o){for(var r=e,l=t.length;r<l;r++){if(t.startsWith(n,r))return!0;if(t.startsWith(o,r))return!1}return!1}function V(t,e){if(!N(t[e])||!e)return!1;return/^[a-zA-Z0-9:-]*(\s*[=]?\s*((?:'[^']*')|(?:"[^"]*")))|( [^/>'"=]*['"])/.test(t.slice(e))}function x(t,e){if(!e||!N(t[e]))return!1;return/^[a-zA-Z0-9:-]*=(((?:'[^']*')|(?:"[^"]*"))|((?:['"][^'"]*['"]\s*\/?>)))/.test(t.slice(e))}function _(t,e){if(N(t[c(t,e)]))for(var n=e;n--;)if(t[n].trim().length&&!N(t[n]))return t.slice(n+1,e)}function J(t,e,n){if("string"!=typeof t||!t.trim()||!Number.isInteger(e)||!Number.isInteger(n)||!t[e]||!t[n]||e>=n)return!1;var o,r="'\"".includes(t[e])?t[e]:null,l=null;r&&(l=T(r));for(var i,s,a,m,g=(new Map).set("'",0).set('"',0).set("matchedPairs",0),p=null,d=0,f=!1,h=!1,b=!1,y=!1,S=e,v=t.length;S<v;S++){if("'\"".includes(t[S])&&f&&i===e&&void 0!==s&&s<S&&S>=n){var E=S!==n||x(t,u(t,n))||"/>".includes(t[u(t,S)]),O=!(S>n&&t[e]===t[n]&&t[e]===t[S]&&V(t,S+1)),J=S===n&&V(t,n+1),P=o&&o<S&&A.has(t.slice(o,S).trim());o&&t.slice(o,S).trim();var I=o&&o<S&&t[o-1]&&!t[o-1].trim()&&Array.from(t.slice(o,S).trim()).every((function(t){return N(t)}))&&t[e]===t[n]&&!"/>".includes(t[u(t,S)])&&w(t,S+1,"=",["'",'"']),L=void 0;S===n&&(L=_(t,S));var R=S===n&&(!N(t[c(t,S)])||L&&!A.has(L))&&"="!==t[c(t,S)],M="/>".includes(t[u(t,S)])&&S===n,j=N(t[u(t,S)]),F=f&&S!==n,B=!(S>=n&&":"===t[c(t,n)]);return!!(E&&O&&(J||P||I||R)&&(M||j||F)&&B)}if("'\"".includes(t[S])){if("'"===t[S]&&'"'===t[S-1]&&'"'===t[S+1]||'"'===t[S]&&"'"===t[S-1]&&"'"===t[S+1])continue;p&&t[S]===t[p]?(g.set("matchedPairs",g.get("matchedPairs")+1),i=p,s=S,p=null,f=!0):f=!1,g.set(t[S],g.get(t[S])+1),d=g.get('"')+g.get("'")}if(">"===t[S]&&!b&&(b=!0,d&&g.get("matchedPairs")&&d===2*g.get("matchedPairs")&&S<n))return!1;if("<"===t[S]&&"%"!==t[u(t,S)]&&b&&!y)return y=!0,!1;if(t[S].trim()&&!o)N(t[S])&&(o=S);else if(o&&!N(t[S])){if(m=a,a=t.slice(o,S),h=o>=n,"'\"".includes(t[S])&&0===g.get("matchedPairs")&&3===d&&t[e]===t[S]&&A.has(a)&&!"'\"".includes(t[u(t,S)])){var W=S>n,H=!p,D=p+1>=S,q=t.slice(p+1,S).trim().split(/\s+/).every((function(t){return A.has(t)})),U=!a||!m||!m.endsWith(":"),Q=S===n,z=d<3,G=!!f,Y=!p,$=p+1>=S,K=!t.slice(p+1,S).trim().split(/\s+/).every((function(t){return A.has(t)}));return W&&(H||D||q)&&U||Q&&(z||G||Y||$||K)}if(a&&A.has(a)&&i===e&&s===n)return!0}if("'\"".includes(t[S])&&(!(g.get('"')%2)||!(g.get("'")%2))&&(g.get('"')+g.get("'"))%2&&(a&&A.has(a)||S>n+1&&A.has(t.slice(n+1,S).trim()))&&(t[S+1]!==t[S]||t[S]!==t[e])&&!(S>n+1&&":"===t[c(t,n)])&&!(a&&m&&m.trim().endsWith(":"))){var Z=S>n,X=!!r,tt=t[e]!==t[n],et=A.has(t.slice(e+1,n).trim()),nt=!C(t,S+1,t[n],T(t[n]));return Z&&!(X&&tt&&et&&nt)}if(("="===t[S]||!t[S].length&&"="===t[u(t,S)])&&a&&A.has(a)){var ot=S>n,rt=!(!(f&&i===e&&s===n||x(t,o))&&f&&void 0!==i&&i<=n);return ot&&rt}if(S>n){if(r&&t[S]===r){var lt=!!p,it=p===n,st=p+1<S&&t.slice(p+1,S).trim(),at=t.slice(p+1,S).trim().split(/\s+/).every((function(t){return A.has(t)})),mt=S>=n,ut=!t[u(t,S)]||!"'\"".includes(t[u(t,S)]);return!!(lt&&it&&st&&at&&mt&&ut)}if(r&&t[n]===l&&t[S]===l)return!1;if("/"===t[S]||">"===t[S]||"<"===t[S]){var ct=t[e]===t[n]&&p===n&&!t.slice(e+1,n).includes(t[e]),gt=g.get("matchedPairs")<2,pt=_(t,S),dt=(!pt||!A.has(pt))&&(!(S>n&&g.get("'")&&g.get('"')&&g.get("matchedPairs")>1)||"/>".includes(t[u(t,S)])),ft=d<3||g.get('"')+g.get("'")-2*g.get("matchedPairs")!=2,ht=!f||f&&!(void 0!==i&&Array.from(t.slice(e+1,i).trim()).every((function(t){return N(t)}))&&A.has(t.slice(e+1,i).trim())),bt=!u(t,S)&&d%2==0,yt=t[e-2]&&"="===t[e-1]&&N(t[e-2]),St=!w(t,S+1,"<",["='",'="']);return ct||(gt||dt)&&ft&&(ht||bt||yt||St)}if("="===t[S]&&k(t,S,["'",'"'],{trimBeforeMatching:!0,trimCharsBeforeMatching:["="]}))return!0}else{var vt=void 0;if(t[S-1]&&t[S-1].trim()&&"="!==t[S-1])vt=S-1;else for(var Et=S;Et--;)if(t[Et].trim()&&"="!==t[Et]){vt=Et;break}if("="===t[S]&&k(t,S,["'",'"'],{cb:function(t){return!"/>".includes(t)},trimBeforeMatching:!0,trimCharsBeforeMatching:["="]})&&N(t[vt])&&!t.slice(e+1).startsWith("http")&&!t.slice(e+1,S).includes("/")&&!t.endsWith("src=",e)&&!t.endsWith("href=",e))return!1;if(S===n&&x(t,S+1))return!0;if(S<n&&"'\"".includes(t[S])&&a&&t[c(t,e)]&&"="!==t[c(t,e)]&&i===e&&A.has(a))return!1;if(S===n&&"'\"".includes(t[S])&&a&&m&&d%2==0&&m.endsWith(":"))return!0}if("'\"".includes(t[S])&&S>n)return!!(h&&a&&A.has(a));"'\"".includes(t[S])&&(p=S),o&&!N(t[S])&&(o=null)}return!1}var P={allowCustomTagNames:!1,skipOpeningBracket:!1},I=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h1 - h6","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xml"];function L(t){return void 0===t||t.toUpperCase()===t.toLowerCase()&&!/\d/.test(t)&&"="!==t}function R(t,e){return"<"===t[e]||"<"===t[c(t,e)]}function M(t,e,n){if(void 0===e&&(e=0),"string"!=typeof t)throw new Error('is-html-tag-opening: [THROW_ID_01] the first input argument should have been a string but it was given as "'+typeof t+'", value being '+JSON.stringify(t,null,4));if(!Number.isInteger(e)||e<0)throw new Error('is-html-tag-opening: [THROW_ID_02] the second input argument should have been a natural number string index but it was given as "'+typeof e+'", value being '+JSON.stringify(e,null,4));var r=o(o({},P),n),l="._a-z0-9Â·Ã€-Ã–Ã˜-Ã¶Ã¸-Í½Í¿-á¿¿â€Œ-â€â€¿-â€â°-ï¿¿",i=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"[\\\\ \\t\\r\\n/]*\\w+"+"[\\\\ \\t\\r\\n/]*\\/?"+"[\\\\ \\t\\r\\n/]*>","g"),s=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"[\\\\ \\t\\r\\n/]*["+l+"]+[-"+l+"]*"+"[\\\\ \\t\\r\\n/]*>","g"),a=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"\\s*\\w+\\s+\\w+(?:-\\w+)?\\s*=\\s*['\"\\w]","g"),m=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"\\s*\\w+\\s+["+l+"]+[-"+l+"]*(?:-\\w+)?\\s*=\\s*['\"\\w]"),u=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"\\s*\\/?\\s*\\w+\\s*\\/?\\s*>","g"),g=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"\\s*\\/?\\s*["+l+"]+[-"+l+"]*\\s*\\/?\\s*>","g"),p=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"[\\\\ \\t\\r\\n/]*\\w+(?:\\s*\\w+)?\\s*\\w+=['\"]","g"),d=new RegExp("^<"+(r.skipOpeningBracket?"?":"")+"[\\\\ \\t\\r\\n/]*["+l+"]+[-"+l+"]*\\s+(?:\\s*\\w+)?\\s*\\w+=['\"]","g"),f=new RegExp("^<"+(r.skipOpeningBracket?"?\\/?":"")+"("+"[\\\\ \\t\\r\\n/]*["+l+"]+)+"+"[\\\\ \\t\\r\\n/]*[\\\\/=>]",""),h=e?t.slice(e):t,b=!1,y=!1,S={cb:L,i:!0,trimCharsBeforeMatching:["/","\\","!"," ","\t","\n","\r"]};return r.allowCustomTagNames?((r.skipOpeningBracket&&("<"===t[e-1]||"/"===t[e-1]&&"<"===t[c(t,c(t,e))])||"<"===h[0]&&h[1]&&h[1].trim())&&(f.test(h)||/^<\w+$/.test(h))||s.test(h)&&R(t,e)||m.test(h)||g.test(h)&&R(t,e)||d.test(h))&&(y=!0):(((r.skipOpeningBracket&&("<"===t[e-1]||"/"===t[e-1]&&"<"===t[c(t,c(t,e))])||"<"===h[0]&&h[1]&&h[1].trim())&&f.test(h)||i.test(h)&&R(t,e)||a.test(h)||u.test(h)&&R(t,e)||p.test(h))&&(b=!0),b&&O(t,e,I,{cb:function(n){return void 0===n?(("<"===t[e]&&t[e+1]&&t[e+1].trim()||"<"===t[e-1])&&(y=!0),!0):n.toUpperCase()===n.toLowerCase()&&!/\d/.test(n)&&"="!==n},i:!0,trimCharsBeforeMatching:["<","/","\\","!"," ","\t","\n","\r"]})&&(y=!0)),!y&&"<"===t[e]&&t[e+1]&&t[e+1].trim()&&k(t,e,I,S)&&(y=!0),"string"==typeof t&&e<t.length&&y}var j=new Set(["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"]),F="{}%-$_()*|#",B="{}|#",W="%()$_*#",H=[")|(","|(",")(","()","}{","{}","%)","*)","||","--"];function D(t){return!(!t||!(t.charCodeAt(0)>64&&t.charCodeAt(0)<91||t.charCodeAt(0)>96&&t.charCodeAt(0)<123))}function q(t){for(var e="",n=0,o=t.length;n<o;n++)e="["===t[n]?"]"+e:"]"===t[n]?"["+e:"{"===t[n]?"}"+e:"}"===t[n]?"{"+e:"("===t[n]?")"+e:")"===t[n]?"("+e:"<"===t[n]?">"+e:">"===t[n]?"<"+e:"â€œ"===t[n]?"â€"+e:"â€"===t[n]?"â€œ"+e:""+t[n]+e;return e}function U(t){return j.has(t.toLowerCase())||["doctype","cdata","xml"].includes(t.toLowerCase())}function Q(t,e,n,o){for(var r=e,l=t.length;r<l;r++){if(t.startsWith(n,r))return!0;if(t.startsWith(o,r))return!1}return!1}function z(t){return t&&"object"==typeof t&&!Array.isArray(t)}var G=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],Y=new Set(["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"]),$=["{","}",","],K="'\"â€œâ€",Z=/[\w-]/;function X(t){if(t&&t.length)for(var e=t.length;e--;)if("esp"===t[e].type)return e}function tt(t,e,n){if(void 0===n&&(n=!1),e.length){var o=n?e[0]:e[e.length-1];if("esp"===o.type)return t.includes(o.guessedClosingLump)||Array.from(t).every((function(t){return o.guessedClosingLump.includes(t)}))||o.guessedClosingLump&&o.guessedClosingLump.length>2&&o.guessedClosingLump[o.guessedClosingLump.length-1]===t[t.length-1]&&o.guessedClosingLump[o.guessedClosingLump.length-2]===t[t.length-2]?(console.log("064 matchLayer(): [32mRETURN[39m "+t.length),t.length):void 0}}var et="\\";function nt(t,e,n,o,r){return console.log("020 â–ˆâ–ˆ startsTag() isOpening1: "+M(t,e,{allowCustomTagNames:!0})),console.log("025 â–ˆâ–ˆ startsTag() isOpening2: "+M(t,e,{allowCustomTagNames:!1,skipOpeningBracket:!0})),!(!t[e]||!t[e].trim().length||o.length&&"text"!==n.type||n.kind&&["doctype","xml"].includes(n.kind)||r&&"<"!==t[e]||!("<"===t[e]&&(M(t,e,{allowCustomTagNames:!0})||">"===t[u(t,e)]||k(t,e,["doctype","xml","cdata"],{i:!0,trimBeforeMatching:!0,trimCharsBeforeMatching:["?","!","["," ","-"]}))||D(t[e])&&(!t[e-1]||!D(t[e-1])&&!["<","/","!",et].includes(t[c(t,e)]))&&M(t,e,{allowCustomTagNames:!1,skipOpeningBracket:!0}))||!("esp"!==n.type||n.tail&&n.tail.includes(t[e])))}var ot=/^\s*!?\s*[a-zA-Z0-9]+(?:[\s;}<>'"]|$)/gm,rt={tagCb:null,tagCbLookahead:0,charCb:null,charCbLookahead:0,reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100};function lt(t,e){var n=Date.now();if("string"!=typeof t)throw void 0===t?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "'+typeof t+'", equal to:\n'+JSON.stringify(t,null,4));if(e&&!z(e))throw new Error("codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type "+typeof e+", equal to "+JSON.stringify(e,null,4));if(e&&z(e)&&e.tagCb&&"function"!=typeof e.tagCb)throw new Error("codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type "+typeof e.tagCb+", equal to "+JSON.stringify(e.tagCb,null,4));if(e&&z(e)&&e.charCb&&"function"!=typeof e.charCb)throw new Error("codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type "+typeof e.charCb+", equal to "+JSON.stringify(e.charCb,null,4));if(e&&z(e)&&e.reportProgressFunc&&"function"!=typeof e.reportProgressFunc)throw new Error("codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type "+typeof e.reportProgressFunc+", equal to "+JSON.stringify(e.reportProgressFunc,null,4));var r=o(o({},rt),e),l=0,i=0,s=t.length,m=Math.floor(s/2),g=0,p=!1,d=!1,f=[],h=[],b={};function y(){console.log("201 [36mâ–ˆâ–ˆ tokenReset():[39m tokenReset() called"),b={type:null,start:null,end:null,value:null},w()}var S={attribName:"",attribNameRecognised:!1,attribNameStartsAt:null,attribNameEndsAt:null,attribOpeningQuoteAt:null,attribClosingQuoteAt:null,attribValueRaw:null,attribValue:[],attribValueStartsAt:null,attribValueEndsAt:null,attribStarts:null,attribEnds:null,attribLeft:null},T=o({},S);function w(){T=a(S)}function C(e){console.log("236"),T.attribValue.length&&T.attribValue[~-T.attribValue.length].start&&!T.attribValue[~-T.attribValue.length].end&&(T.attribValue[~-T.attribValue.length].end=e.start,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,e.start),console.log("250 complete previous attr, [32mSET[39m [33mattrib[39m = "+JSON.stringify(T,null,4))),T.attribValue.push(e),console.log("260 [32mPUSH[39m to [33mattrib[39m now = "+JSON.stringify(T,null,4))}var V,x,_,P={start:null,end:null,property:null,propertyStarts:null,propertyEnds:null,value:null,valueStarts:null,valueEnds:null,important:null,importantStarts:null,importantEnds:null,colon:null,semi:null},I=o({},P);function L(){I=o({},P)}function R(t){T&&"style"===T.attribName?(console.log("295 push property"),console.log("297 FIY, [33mattrib[39m = "+JSON.stringify(T,null,4)),console.log("304 FIY, [33mattrib.attribValue[39m = "+JSON.stringify(T.attribValue,null,4)),T.attribValue.push(o({},t))):b&&Array.isArray(b.properties)&&(console.log("312 push property"),b.properties.push(o({},t)))}y();var M=null,j=[];function et(t){return!(!Array.isArray(j)||!j.length||j[~-j.length].type!==t)}function lt(e){console.log("429 closingComment(): [32mclosing comment[39m");var n=(u(t,e)||e)+1;C({type:"comment",start:e,end:n,value:t.slice(e,n),closing:!0,kind:"block",language:"css"}),g=n,console.log("445 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4)),et("block")&&(j.pop(),console.log("456 [31mPOP[39m layers, now = "+JSON.stringify(j,null,4)))}function it(t,e,n){console.time("reportFirstFromStash()"),console.log("472 [35mreportFirstFromStash()[39m: â–ˆâ–ˆ [33mSTART[39m");for(var o=t.shift(),r=[],l=0;l<n;l++){if(console.log("i = "+l),!t[l]){console.log("491 [35mreportFirstFromStash()[39m: [31mSTOP[39m - there are not enough elements in stash");break}r.push(a(t[l])),console.log("488")}console.log("499 [35mreportFirstFromStash()[39m: [32mPING CB[39m with "+JSON.stringify(o,null,4)),"function"==typeof e&&e(o,r),console.timeEnd("reportFirstFromStash()")}function st(t){console.time("pingTagCb()"),r.tagCb&&(f.push(t),console.log("560 "+(f.length>r.tagCbLookahead?"[36mpingTagCb()[39m: [32mENOUGH VALUES IN TAG STASH[39m":"[36mpingTagCb()[39m: [31mNOT ENOUGH VALUES IN TAG STASH, MOVE ON[39m")),f.length>r.tagCbLookahead&&(it(f,r.tagCb,r.tagCbLookahead),console.log("569 pingTagCb(): [90mâ–ˆâ–ˆ tagStash[39m = "+JSON.stringify(f,null,4)))),console.timeEnd("pingTagCb()")}function at(e,n){if(console.log("582 [35mdumpCurrentToken()[39m; incoming incomingToken="+JSON.stringify(e,null,0)+"; i = [33m"+n+"[39m"),!["text","esp"].includes(e.type)&&null!==e.start&&e.start<n&&(t[~-n]&&!t[~-n].trim()||"<"===t[n])){if(console.log("599"),null!==c(t,n)?(console.log("607"),e.end=c(t,n)+1):(console.log("610"),e.end=n),e.value=t.slice(e.start,e.end),console.log("615 [32mSET[39m [33mincomingToken.end[39m = "+e.end+" (last two characters ending at incomingToken.end: "+JSON.stringify(t[~-e.end],null,4)+" + "+JSON.stringify(t[e.end],null,4)+'); [33mincomingToken.value[39m = "'+e.value+'"'),"tag"!==e.type||"/>".includes(t[~-e.end]))console.log("764 [35mâ–ˆâ–ˆ HEALTHY TAG[39m"),console.log("765 [32mPING[39m"),st(e),console.log("767 [32mRESET[39m"),y(),t[~-n]&&!t[~-n].trim()&&(console.log("771 indeed there was whitespace after token's end"),ut("text",c(t,n)+1),console.log("774 [32mSET[39m [33mtoken.start[39m = "+b.start+"; [33mtoken.type[39m = "+b.type));else{console.log("634 [35mâ–ˆâ–ˆ UNCLOSED TAG CASES[39m");var o=e.tagNameEndsAt||n;if(Array.isArray(e.attribs)&&e.attribs.length){console.log("656 [32mâ–ˆâ–ˆ validate all attributes[39m"),console.log("659 SET cutOffIndex = "+o);for(var r=0,l=e.attribs.length;r<l;r++){if(console.log("667 [36mincomingToken.attribs["+r+"][39m = "+JSON.stringify(e.attribs[r],null,4)),!e.attribs[r].attribNameRecognised||!e.attribs[r].attribEnds){console.log("702 [31mBREAK[39m"),e.attribs=0===r?[]:e.attribs.splice(0,r),console.log("715 [32mCALCULATED[39m [33mincomingToken.attribs[39m = "+JSON.stringify(e.attribs,null,4));break}o=e.attribs[r].attribEnds,console.log("679 [32mSET[39m [33mcutOffIndex[39m = "+o),t[o+1]&&!t[o].trim()&&t[o+1].trim()&&(o+=1,console.log("698 [32mSET[39m [33mcutOffIndex[39m = "+o))}}e.end=o,e.value=t.slice(e.start,e.end),e.tagNameEndsAt||(e.tagNameEndsAt=o,console.log("733 [32mSET[39m [33mincomingToken.tagNameEndsAt[39m = "+e.tagNameEndsAt)),e.tagNameStartsAt&&e.tagNameEndsAt&&!e.tagName&&(e.tagName=t.slice(e.tagNameStartsAt,o),console.log("748 [32mSET[39m [33mincomingToken.tagName[39m = "+e.tagName),e.recognised=U(e.tagName)),console.log("755 [32mPING[39m"),st(e),ut("text",o),console.log("759 [32mSET[39m [33mtoken.start[39m = "+b.start+"; [33mtoken.type[39m = "+b.type)}console.log("782 FINALLY, [33mtoken[39m = "+JSON.stringify(b,null,4))}null!==b.start&&(console.log("792 *"),null===b.end&&b.start!==n&&(b.end=n,b.value=t.slice(b.start,b.end),console.log("798 [32mSET[39m [33mtoken.end[39m = "+b.end+"; [33mtoken.value[39m = "+JSON.stringify(b.value,null,4))),console.log("811 *"),null!==b.start&&b.end&&(et("at")?(j[~-j.length].token.rules.push(b),console.log("820 [32mPUSH[39m into layers AT rule")):(console.log("824 [32mPING[39m as standalone"),st(b))),console.log("829 [32mRESET[39m"),y()),console.log("833 end of dumpCurrentToken() reached"),console.timeEnd("dumpCurrentToken()")}function mt(t,e){return void 0===e&&(e=null),"tag"===t?{type:t,start:e,end:null,value:null,tagNameStartsAt:null,tagNameEndsAt:null,tagName:null,recognised:null,closing:!1,void:!1,pureHTML:!0,kind:null,attribs:[]}:"comment"===t?{type:t,start:e,end:null,value:null,closing:!1,kind:"simple",language:"html"}:"rule"===t?{type:t,start:e,end:null,value:null,left:null,nested:!1,openingCurlyAt:null,closingCurlyAt:null,selectorsStart:null,selectorsEnd:null,selectors:[],properties:[]}:"at"===t?{type:t,start:e,end:null,value:null,left:null,nested:!1,openingCurlyAt:null,closingCurlyAt:null,identifier:null,identifierStartsAt:null,identifierEndsAt:null,query:null,queryStartsAt:null,queryEndsAt:null,rules:[]}:"esp"===t?{type:t,start:e,end:null,value:null,head:null,headStartsAt:null,headEndsAt:null,tail:null,tailStartsAt:null,tailEndsAt:null}:{type:"text",start:e,end:null,value:null}}function ut(t,e){console.time("initToken()"),w(),b=mt(t,e),console.timeEnd("initToken()")}function ct(t){console.time("initProperty()"),L(),"number"==typeof t?(I.propertyStarts=t,I.start=t,console.timeEnd("initProperty()")):I=o(o({},P),t)}function gt(e){return!"'\"".includes(t[e])||!(T.attribOpeningQuoteAt||T.attribValueStartsAt)||J(t,T.attribOpeningQuoteAt||T.attribValueStartsAt,e)}for(var pt=function(e){console.time("[90mloop iteration[39m"),console.log("[36m===============================[39m [35mstr[ "+e+" ] = "+(t[e]&&t[e].trim()?t[e]:JSON.stringify(t[e],null,4))+"[39m [36m===============================[39m\n"),!g&&t[e]&&r.reportProgressFunc&&(s>1e3&&s<2e3?e===m&&r.reportProgressFunc(Math.floor((r.reportProgressFuncTo-r.reportProgressFuncFrom)/2)):s>=2e3&&(l=r.reportProgressFuncFrom+Math.floor(e/s*(r.reportProgressFuncTo-r.reportProgressFuncFrom)))!==i&&(i=l,r.reportProgressFunc(l),console.log("1047 DONE "+l+"%")));var n=c(t,e),f=u(t,e);if(p&&b.type&&!["rule","at","text","comment"].includes(b.type)&&(console.log("1067 FIY, [33mtoken[39m = "+JSON.stringify(b,null,4)),p=!1,console.log("1075 [31mRESET[39m [33mwithinStyle[39m = false")),g&&e>=g&&(g=0,console.log("1081 TURN OFF doNothing")),D(t[e])&&D(t[~-e])&&D(t[e+1]))return I&&I.valueStarts&&!I.valueEnds&&!I.importantStarts&&t.startsWith("important",e)&&(I.valueEnds=e,I.value=t.slice(I.valueStarts,e),I.importantStarts=e,console.log("1106 [32mSET[39m [33mproperty.valueEnds[39m = "+I.valueEnds+";  [33mproperty.value[39m = "+I.value+";  [33mproperty.importantStarts[39m = "+I.importantStarts)),console.log("1117 [32mSKIP[39m middle of the letters chunk"),console.timeEnd("[90mloop iteration[39m"),dt=e,"continue";if(" \t\r\n".includes(t[e])&&t[e]===t[~-e]&&t[e]===t[e+1])return console.log("1130 [32mSKIP[39m middle of the spaces chunk"),console.timeEnd("[90mloop iteration[39m"),dt=e,"continue";if(!g&&et("at")&&z(j[~-j.length].token)&&j[~-j.length].token.openingCurlyAt&&!j[~-j.length].token.closingCurlyAt)if(console.log("1140 inside catch the curly tails of at-rules' clauses"),"}"===t[e]){if(!b.type||"text"===b.type||"rule"===b.type&&null===b.openingCurlyAt){"rule"===b.type&&(console.log('1152 complete the "rule" token'),b.end=n+1,b.value=t.slice(b.start,b.end),console.log("1156 [33mtoken[39m = "+JSON.stringify(b,null,4)),st(b),et("at")&&(j[~-j.length].token.rules.push(b),console.log("1169 [32mPUSH[39m into layers AT rule")),console.log("1173 [32mRESET[39m"),y(),null!==n&&n<~-e&&(console.log("1179 initiate whitespace from ["+(n+1)+", "+e+"]"),ut("text",n+1),console.log("1183 [33mtoken[39m now = "+JSON.stringify(b,null,4)))),console.log("1192 call dumpCurrentToken()"),at(b,e),console.log("1196 [35mâ–ˆâ–ˆ[39m restore at rule from layers");var S=j.pop();b=S.token,console.log("1200 new token: "+JSON.stringify(b,null,4)),b.closingCurlyAt=e,b.end=e+1,b.value=t.slice(b.start,b.end),console.log("1208 [33mtoken[39m = "+JSON.stringify(b,null,4)+" before pinging"),st(b),et("at")&&(console.log("1220 [32mPUSH this rule into last AT layer[39m"),j[~-j.length].token.rules.push(b)),console.log("1227 [32mRESET[39m"),y(),console.log("1231 [31mskip the remaining of the program clauses for this index[39m"),g=e+1,console.log("1235 [32mSET[39m [31mdoNothing[39m = "+g)}}else"text"===b.type&&t[e]&&t[e].trim()&&(b.end=e,b.value=t.slice(b.start,b.end),console.log("1244 [33mtoken[39m = "+JSON.stringify(b,null,4)),et("at")?(j[~-j.length].token.rules.push(b),console.log("1256 [32mPUSH[39m into layers AT rule")):(console.log("1260 [32mPING[39m as standalone"),st(b)),console.log("1264 [32mRESET[39m"),y());if(b.end&&b.end===e&&(console.log("1270 token was captured in the past, so push it now"),"style"!==b.tagName||b.closing||(p=!0,console.log("1274 [32mSET[39m [33mwithinStyle[39m = true")),_?(console.log("1279 THIS TAG GOES INTO ATTRIBUTE'S attribValue"),T=_,console.log("1284 [35mRESTORE[39m attrib from stashed, now = "+JSON.stringify(T,null,4)),console.log("1293 PUSH token to be inside [33mattrib.attribValue[39m"),T.attribValue.push(b),b=a(x),_=void 0,x=void 0,console.log("1305 [33mFIY[39m, [33mtoken[39m = "+JSON.stringify(b,null,4))):(console.log("1312 call dumpCurrentToken()"),at(b,e),console.log("1315 [31mWIPE[39m layers"),j.length=0)),console.log("1321 [33mattrib.attribValue[39m = "+JSON.stringify(T.attribValue,null,4)),g||(["tag","at"].includes(b.type)&&"cdata"!==b.kind?(console.log('1347 [36mLAYERS CLAUSES[39m ("tag", "rule" or "at")'),!t[e]||!K.includes(t[e])&&!"()".includes(t[e])||K.includes(t[n])&&t[n]===t[f]||!gt(e)||(console.log("1372"),console.log("1374 last layer's value: "+(et("simple")&&j[~-j.length].value)),et("simple")&&j[~-j.length].value===q(t[e])?(j.pop(),console.log("1386 [32mPOP[39m layers")):(j.push({type:"simple",value:t[e],position:e}),console.log("1395 [32mPUSH[39m "+JSON.stringify({type:"simple",value:t[e],position:e},null,4))))):"comment"===b.type&&["only","not"].includes(b.kind)?(console.log('1411 inside "comments" layers clauses'),["[","]"].includes(t[e])&&(console.log("1413"),et("simple")&&j[~-j.length].value===q(t[e])?(j.pop(),console.log("1422 [32mPOP[39m layers")):(j.push({type:"simple",value:t[e],position:e}),console.log("1431 [32mPUSH[39m "+JSON.stringify({type:"simple",value:t[e]},null,4))))):"esp"!==b.type||!"'\"`()".includes(t[e])||['"',"'","`"].includes(t[n])&&t[n]===t[f]||(console.log("1455"),et("simple")&&j[~-j.length].value===q(t[e])?(j.pop(),console.log("1463 [32mPOP LAYERS[39m"),console.log("1466 [31mskip the remaining of the program clauses for this index[39m"),g=e+1,console.log("1470 [32mSET[39m [31mdoNothing[39m = "+g)):"]})>".includes(t[e])||(j.push({type:"simple",value:t[e],position:e}),console.log("1480 [32mPUSH LAYER[39m "+JSON.stringify({type:"simple",value:t[e]},null,4))))),!g&&"at"===b.type&&null!=b.start&&e>=b.start&&!b.identifierStartsAt&&t[e]&&t[e].trim()&&"@"!==t[e]&&(b.identifierStartsAt=e,console.log("1520 [32mSET[39m [33mtoken.identifierStartsAt[39m = "+b.identifierStartsAt)),!g&&"at"===b.type&&b.queryStartsAt&&!b.queryEndsAt&&"{;".includes(t[e])&&(console.log('1536 end of the "at" rule token clauses start'),"{"===t[e]?t[~-e]&&t[~-e].trim()?(b.queryEndsAt=e,console.log("1541 [32mSET[39m [33mtoken.queryEndsAt[39m = "+JSON.stringify(b.queryEndsAt,null,4))):(b.queryEndsAt=null!==n?n+1:e,console.log("1560 [32mSET[39m [33mtoken.queryEndsAt[39m = "+JSON.stringify(b.queryEndsAt,null,4))):(b.queryEndsAt=c(t,e+1)||0,console.log("1575 [32mSET[39m [33mtoken.queryEndsAt[39m = "+JSON.stringify(b.queryEndsAt,null,4))),b.queryStartsAt&&b.queryEndsAt&&(b.query=t.slice(b.queryStartsAt,b.queryEndsAt),console.log("1586 [33mtoken.query[39m = "+JSON.stringify(b.query,null,4))),b.end=";"===t[e]?e+1:e,b.value=t.slice(b.start,b.end),";"===t[e]?(console.log("1599 [32mPING[39m the token"),st(b)):(console.log("1603 [32mNEST[39m children"),console.log("1605 starting [33mlayers[39m = "+JSON.stringify(j,null,4)),b.openingCurlyAt=e,console.log("1614 [32mSET[39m [33mtoken.openingCurlyAt[39m = "+b.openingCurlyAt),j.push({type:"at",token:b}),console.log('1625 [32mPUSH[39m "at" token to layers')),console.log("1629 [31mREST[39m the token"),y(),g=e+1,console.log("1633 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))),!g&&"at"===b.type&&b.identifier&&t[e]&&t[e].trim()&&!b.queryStartsAt&&(b.queryStartsAt=e,console.log("1654 [32mSET[39m [33mtoken.queryStartsAt[39m = "+b.queryStartsAt)),!g&&b&&"at"===b.type&&b.identifierStartsAt&&e>=b.start&&t[e]&&(!t[e].trim()||"()".includes(t[e]))&&!b.identifierEndsAt&&(b.identifierEndsAt=e,b.identifier=t.slice(b.identifierStartsAt,e),console.log("1676 [32mSET[39m [33mtoken.identifierEndsAt[39m = "+b.identifierEndsAt+'; [33mtoken.identifier[39m = "'+b.identifier+'"')),"rule"===b.type)if(V&&($.includes(t[e])||t[e]&&f&&!t[e].trim()&&$.includes(t[f])))console.log("1698 FIY, [33mselectorChunkStartedAt[39m was "+V),console.log("1701 [32mPUSH[39m to selectors[]: "+JSON.stringify({value:t.slice(V,e),selectorStarts:V,selectorEnds:e},null,4)),b.selectors.push({value:t.slice(V,e),selectorStarts:V,selectorEnds:e}),V=void 0,console.log("1719 [32mRESET[39m [33mselectorChunkStartedAt[39m"),b.selectorsEnd=e,console.log("1724 [32mSET[39m [33mtoken.selectorsEnd[39m = "+b.selectorsEnd);else if("{"===t[e]&&b.openingCurlyAt&&!b.closingCurlyAt){console.log("1739 [31mopening curlies![39m"),console.log("1741 march backwards, find where selector chunk started");for(var P=e;P--;)if(console.log("1745 [36mstr["+P+"][39m = "+JSON.stringify(t[P],null,4)),!t[P].trim()||"{}\"';".includes(t[P])){console.log('1753 [34mBREAK[39m, slice: "[35m'+t.slice(P+1,e)+'[39m"'),I&&I.start&&!I.end&&(I.end=P+1,I.property=t.slice(I.start,I.end),console.log("1764 [32mSET[39m [33mproperty.end[39m = "+I.end+";  [33mproperty.property[39m = "+I.property),console.log("1771 PATCHED [33mproperty[39m = "+JSON.stringify(I,null,4)),R(I),L(),console.log("1780 push, then [31mWIPE[39m [33mproperty[39m"),b.end=P+1,b.value=t.slice(b.start,b.end),console.log("1786 [32mSET[39m [33mtoken.end[39m = "+b.end+"; [33mtoken.value[39m = "+b.value),console.log("1793 PATCHED [33mtoken[39m = "+JSON.stringify(b,null,4)),console.log("1800 [32mPING[39m"),st(b),ut("@"===t[P+1]?"at":"rule",P+1),b.left=c(t,P+1),b.selectorsStart=P+1,console.log("1806 NEW [33mtoken[39m = "+JSON.stringify(b,null,4)),e=P+1,console.log("1815 [31mREWIND[39m [33mi[39m = "+JSON.stringify(e,null,4)));break}}var rt=X(j);if(!g&&t[e]){if(console.log("1857 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ IS TAG STARTING? "+nt(t,e,b,j,p)),console.log("1886 main sorting checks start"),console.time("main-sorting-checks"),nt(t,e,b,j,p)){console.log("1897 (html) tag opening"),b.type&&null!==b.start&&("rule"===b.type&&(console.log("1901"),I&&I.start&&(I.importantStarts&&!I.importantEnds&&(I.importantEnds=e,I.important=t.slice(I.importantStarts,e),console.log("1908 [32mSET[39m [33mproperty.importantEnds[39m = "+I.importantEnds+';  [33mproperty.important[39m = "'+I.important+'"')),I.propertyStarts&&!I.propertyEnds&&(I.propertyEnds=e,console.log("1919 [32mSET[39m [33mproperty.propertyEnds[39m = "+I.propertyEnds),I.property||(I.property=t.slice(I.propertyStarts,e),console.log("1926 [32mSET[39m [33mproperty.property[39m = "+JSON.stringify(I.property,null,4)))),I.end||(I.end=e,console.log("1937 [32mSET[39m [33mproperty.end[39m = "+I.end)),I.valueStarts&&!I.valueEnds&&(I.valueEnds=e,console.log("1947 [32mSET[39m [33mproperty.valueEnds[39m = "+I.valueEnds),I.value||(I.value=t.slice(I.valueStarts,e),console.log("1954 [32mSET[39m [33mproperty.value[39m = "+JSON.stringify(I.value,null,4)))),R(I),L(),console.log("1966 push, then [31mWIPE[39m [33mproperty[39m"))),console.log("1971 call dumpCurrentToken()"),at(b,e),console.log("1974 [32mRESET[39m"),y()),ut("tag",e),console.log("1983 [32mSET[39m [33mtoken.start[39m = "+b.start+"; [33mtoken.type[39m = "+b.type),p&&(p=!1,console.log("1991 [32mSET[39m [33mwithinStyle[39m = false"));var pt="?![-/",ft="",ht=!1;if(console.log("."),console.log("2001 [36mextract the tag name[39m"),f)for(var bt=f;bt<s;bt++){if(console.log("[36mstr[y][39m = "+JSON.stringify(t[bt],null,4)),!ht&&t[bt]&&t[bt].trim()&&t[bt].toUpperCase()!==t[bt].toLowerCase()&&(ht=!0),ht&&t[bt]&&(!t[bt].trim()||!/\w/.test(t[bt])&&!pt.includes(t[bt])||"["===t[bt])){console.log("2039 SET [33mextractedTagName[39m = "+JSON.stringify(ft,null,4));break}pt.includes(t[bt])||(ft+=t[bt].trim().toLowerCase())}console.log("."),"doctype"===ft?(b.kind="doctype",console.log("2059 [32mSET[39m [33mtoken.kind[39m = "+b.kind)):"cdata"===ft?(b.kind="cdata",console.log("2066 [32mSET[39m [33mtoken.kind[39m = "+b.kind)):"xml"===ft?(b.kind="xml",console.log("2073 [32mSET[39m [33mtoken.kind[39m = "+b.kind)):Y.has(ft)&&(b.kind="inline",console.log("2080 [32mSET[39m [33mtoken.kind[39m = "+b.kind))}else if(function(t,e,n,o){return!(("<"!==t[e]||!k(t,e,["!--"],{maxMismatches:1,firstMustMatch:!0,trimBeforeMatching:!0})&&!O(t,e,["<![endif]"],{i:!0,maxMismatches:2,trimBeforeMatching:!0})||k(t,e,["![cdata","<"],{i:!0,maxMismatches:1,trimBeforeMatching:!0})||"comment"===n.type&&"not"===n.kind)&&("-"!==t[e]||!O(t,e,["--\x3e"],{trimBeforeMatching:!0})||"comment"===n.type&&(n.closing||"not"===n.kind)||E(t,e,"<",{trimBeforeMatching:!0,trimCharsBeforeMatching:["-","!"]})||Array.isArray(o)&&o.length&&"esp"===o[o.length-1].type&&"<"===o[o.length-1].openingLump[0]&&"-"===o[o.length-1].openingLump[2]&&"-"===o[o.length-1].openingLump[3]))}(t,e,b,j))console.log("2093 HTML comment opening"),null!=b.start&&(console.log("2096 call dumpCurrentToken()"),at(b,e)),ut("comment",e),console.log("2106 [32mSET[39m [33mtoken.start[39m = "+b.start+"; [33mtoken.type[39m = "+b.type),"-"===t[e]?(b.closing=!0,console.log("2115 [32mSET[39m [33mtoken.closing[39m = "+b.closing)):O(t,e,["<![endif]--\x3e"],{i:!0,trimBeforeMatching:!0,maxMismatches:2})&&(b.closing=!0,b.kind="only",console.log("2129 [32mSET[39m [33mtoken.closing[39m = "+b.closing+"; [33mtoken.kind[39m = "+b.kind)),p&&(p=!1,console.log("2140 [32mSET[39m [33mwithinStyle[39m = false"));else if(function(t,e,n,o,r){return r&&("/"===t[e]&&"*"===t[e+1]||"*"===t[e]&&"/"===t[e+1])}(t,e,0,0,p))console.log("2151 CSS block comment opening"),null!=b.start&&(console.log("2154 call dumpCurrentToken()"),at(b,e)),ut("comment",e),b.language="css",console.log("2164 [32mSET[39m [33mtoken.language[39m = "+b.language),b.kind="/"===t[e]&&"/"===t[e+1]?"line":"block",b.value=t.slice(e,e+2),b.end=e+2,b.closing="*"===t[e]&&"/"===t[e+1],d=!0,b.closing&&(d=!1),g=e+2,console.log("2182 [32mSET[39m [31mdoNothing[39m = "+g),console.log("2186 [32mSET[39m [33mtoken[39m = "+JSON.stringify(b,null,4)+"; [33mwithinStyleComment[39m = "+JSON.stringify(d,null,4));else if("number"==typeof rt&&j[rt]&&"esp"===j[rt].type&&j[rt].openingLump&&j[rt].guessedClosingLump&&j[rt].guessedClosingLump.length>1&&j[rt].guessedClosingLump.includes(t[e])&&j[rt].guessedClosingLump.includes(t[e+1])&&!(j[rt+1]&&"'\"".includes(j[rt+1].value)&&t.indexOf(j[rt+1].value,e)>0&&j[rt].guessedClosingLump.includes(t[u(t,t.indexOf(j[rt+1].value,e))]))||function(t,e,n,o,r){var l=F.includes(t[e])&&t[e+1]&&F.includes(t[e+1])&&!(W.includes(t[e])&&W.includes(t[e+1]))&&(t[e]!==t[e+1]||B.includes(t[e]))&&"rule"!==n.type&&"at"!==n.type&&!("-"===t[e]&&"-{(".includes(t[e+1]))&&!("})".includes(t[e])&&"-".includes(t[e+1]))&&!("%"===t[e]&&"%"===t[e+1]&&"0123456789".includes(t[e-1])&&(!t[e+2]||".,;!?".includes(t[e+2])||!t[e+2].trim().length))&&!(r&&("{}".includes(t[e])||"{}".includes(t[u(t,e)])))||"<"===t[e]&&("/"===t[e+1]&&F.includes(t[e+2])||F.includes(t[e+1])&&!["-"].includes(t[e+1]))||"<"===t[e]&&("%"===t[e+1]||t.startsWith("jsp:",e+1)||t.startsWith("cms:",e+1)||t.startsWith("c:",e+1))||t.startsWith("${jspProp",e)||">})".includes(t[e])&&Array.isArray(o)&&o.length&&"esp"===o[o.length-1].type&&o[o.length-1].openingLump.includes(q(t[e]))&&(">"!==t[e]||!Q(t,e+1,">","<"))||"-"===t[e]&&"-"===t[e+1]&&">"===t[e+2]&&Array.isArray(o)&&o.length&&"esp"===o[o.length-1].type&&"<"===o[o.length-1].openingLump[0]&&"-"===o[o.length-1].openingLump[2]&&"-"===o[o.length-1].openingLump[3];return console.log("123 startsEsp(): RETURNS "+!!l),!!l}(t,e,b,j,p)&&(!et("simple")||!["'",'"'].includes(j[~-j.length].value)||T&&T.attribStarts&&!T.attribEnds)){console.log("2282 ESP heads or tails start here");var yt=function(t,e,n){var o=t[e],r=t.length,l=n[X(n)];console.log("017 getWholeEspTagLumpOnTheRight(): [32mSTART[39m");for(var i=e+1;i<r;i++){if(console.log("022 getWholeEspTagLumpOnTheRight(): [36mstr["+i+"]="+t[i]+"[39m"),"({".includes(t[i])&&"})".includes(t[i-1])){console.log("039 getWholeEspTagLumpOnTheRight(): [31mBREAK[39m");break}if(o.length>1&&(o.includes("<")||o.includes("{")||o.includes("[")||o.includes("("))&&"("===t[i]){console.log("065 getWholeEspTagLumpOnTheRight(): [31mBREAK[39m");break}if(!(F.includes(t[i])||l&&l.guessedClosingLump.includes(t[i])||"<"===t[e]&&"/"===t[i]||">"===t[i]&&"--"===o&&Array.isArray(n)&&n.length&&"esp"===n[n.length-1].type&&"<"===n[n.length-1].openingLump[0]&&"-"===n[n.length-1].openingLump[2]&&"-"===n[n.length-1].openingLump[3]||!l&&i>e&&"!=@".includes(t[i]))){console.log("096 [31mBREAK[39m");break}o+=t[i]}if(o&&Array.isArray(n)&&n.length&&"esp"===n[n.length-1].type&&n[n.length-1].guessedClosingLump&&o.length>n[n.length-1].guessedClosingLump.length){if(o.endsWith(n[n.length-1].openingLump))return o.slice(0,o.length-n[n.length-1].openingLump.length);for(var s=new Set(n[n.length-1].guessedClosingLump),a=0,m=function(t,e){if(!s.has(o[e])&&a>1)return{v:o.slice(0,e)};s.has(o[e])&&(a+=1,s=new Set([].concat(s).filter((function(t){return t!==o[e]}))))},u=0,c=o.length;u<c;u++){var g=m(0,u);if("object"==typeof g)return g.v}}return console.log("177 getWholeEspTagLumpOnTheRight(): final return"),o}(t,e,j);if(console.log("2297 â–ˆâ–ˆ [32mSET[39m [33mwholeEspTagLumpOnTheRight[39m = "+yt),console.log("2300 FIY, [33mlayers[39m = "+JSON.stringify(j,null,4)),console.log("2307 FIY, [33mtoken[39m = "+JSON.stringify(b,null,4)),!H.includes(yt)){var St,vt;if(console.log("2318"),j.length&&(St=tt(yt,j))){if(console.log("2336 closing part of a set [32mMATCHED[39m against the last layer"),console.log("2339 [33mlengthOfClosingEspChunk[39m = "+JSON.stringify(St,null,4)),"esp"===b.type){if(b.end||(b.end=e+St,b.value=t.slice(b.start,b.end),b.tail=t.slice(e,e+St),b.tailStartsAt=e,b.tailEndsAt=b.end,">"===t[e]&&"/"===t[n]&&(b.tailStartsAt=n,console.log("2365 closing slash correction, [32mSET[39m token.tailStartsAt="+b.tailStartsAt),b.tail=t.slice(b.tailStartsAt,e+1)),console.log("2373 [32mSET[39m [32mtoken[39m = "+JSON.stringify(b,null,4))),g=b.tailEndsAt,console.log("2386 [32mSET[39m [31mdoNothing[39m = "+g),console.log("2390 [33mtoken[39m = "+JSON.stringify(b,null,4)+" before pinging"),x)return console.log("2400 [32mNEST INSIDE THE STASHED TAG[39m"),Array.isArray(x.attribs)||(x.attribs=[]),_?(T=_,console.log("2414 [35mRESTORE[39m attrib from stashed, now = "+JSON.stringify(T,null,4)),console.log("2423 PUSH token to be inside [33mattrib.attribValue[39m"),T.attribValue.push(o({},b))):(console.log("2428 PUSH token to be among attribs"),x.attribs.push(o({},b))),b=a(x),console.log("2435 [32mRESTORE[39m [33mtoken[39m = "+JSON.stringify(b,null,4)),x=void 0,_=void 0,console.log("2447 POP layers"),j.pop(),console.log("2452 [31mCONTINUE[39m"),console.timeEnd("[90mloop iteration[39m"),dt=e,"continue";console.log("2460 [32mPING AS STANDALONE[39m"),at(b,e),console.log("2465 [32mRESET[39m"),y()}j.pop(),console.log("2472 [32mPOP[39m layers")}else if(j.length&&(St=tt(yt,j,!0)))console.log("2483 closing part of a set [32mMATCHED[39m against first layer"),console.log("2486 wipe all layers, there were strange unclosed characters"),console.log("2489 [33mlengthOfClosingEspChunk[39m = "+JSON.stringify(St,null,4)),"esp"===b.type&&(b.end||(b.end=e+(St||0),b.value=t.slice(b.start,b.end),console.log("2506 [33mtoken[39m = "+JSON.stringify(b,null,4)+" before pinging")),b.tailStartsAt||(b.tailStartsAt=e),!b.tailEndsAt&&St&&(b.tailEndsAt=b.tailStartsAt+St,b.tail=t.slice(e,e+St)),at(b,e),console.log("2522 [32mRESET[39m"),y()),j.length=0,console.log("2529 [32mWIPE[39m layers");else if(T&&T.attribValue&&T.attribValue.length&&T.attribValue[~-T.attribValue.length].start&&Array.from(t.slice(T.attribValue[~-T.attribValue.length].start,e)).some((function(t,e){return yt.includes(q(t))&&(B.includes(t)||!e)&&(vt={char:t,idx:e})}))&&"tag"===b.type&&T&&T.attribValueStartsAt&&!T.attribValueEndsAt&&T.attribValue[~-T.attribValue.length]&&"text"===T.attribValue[~-T.attribValue.length].type){console.log("2595 [31mâ–ˆâ–ˆ[39m seems like a stray lump"),console.log("2598 FIY, [33mattrib[39m = "+JSON.stringify(T,null,4)),console.log("2605 FIY, [33mdisposableVar[39m = "+JSON.stringify(vt,null,4)),console.log("2613 let's convert last attrib.attribValue[] object into ESP-type"),b.pureHTML=!1;var Et=T.attribValue[~-T.attribValue.length],Ot=mt("esp",Et.start);vt&&vt.idx?console.log("2655 [33mwe need to extract frontal part of text token[39m"):(console.log("2639 [33mESP tag is this whole text token[39m"),Ot.head=vt.char,Ot.headStartsAt=Et.start,Ot.headEndsAt=Ot.headStartsAt+1,Ot.tailStartsAt=e,Ot.tailEndsAt=e+yt.length,Ot.tail=yt,T.attribValue[~-T.attribValue.length]=Ot)}else console.log("2660 closing part of a set [31mNOT MATCHED[39m - means it's a new opening"),et("esp")&&(j.pop(),console.log("2669 [31mPOP layers - it was heads without tails[39m")),_&&(Array.isArray(_.attribValue)||(_.attribValue=[]),console.log("2678 push token to attribValue"),_.attribValue.push(b)),console.log("2682 push new layer"),j.push({type:"esp",openingLump:yt,guessedClosingLump:q(yt),position:e}),console.log("2690 [32mPUSH[39m "+JSON.stringify({type:"esp",openingLump:yt,guessedClosingLump:q(yt),position:e},null,4)),console.log("2702 [33mlayers[39m = "+JSON.stringify(j,null,4)),null!==b.start&&("tag"===b.type?(console.log("2719 [36mâ–ˆâ–ˆ[39m ESP tag-inside-tag clauses"),!b.tagNameStartsAt||b.tagName&&b.tagNameEndsAt||(b.tagNameEndsAt=e,b.tagName=t.slice(b.tagNameStartsAt,e),b.recognised=U(b.tagName),console.log("2731 [32mSET[39m [33mtoken.tagNameEndsAt[39m = "+b.tagNameEndsAt+"; [33mtoken.tagName[39m = "+b.tagName)),x=a(b),console.log("2741 [32mSET[39m [33mparentTokenToBackup[39m = "+JSON.stringify(x,null,4)),T.attribStarts&&!T.attribEnds&&(_=a(T),console.log("2751 [32mSET[39m [33mattribToBackup[39m = "+JSON.stringify(_,null,4)))):_?_&&Array.isArray(_.attribValue)&&_.attribValue.length&&"esp"===_.attribValue[~-_.attribValue.length].type&&!_.attribValue[~-_.attribValue.length].end&&(console.log("2774 complete the unclosed token in attribToBackup"),_.attribValue[~-_.attribValue.length].end=e,_.attribValue[~-_.attribValue.length].value=t.slice(_.attribValue[~-_.attribValue.length].start,e),console.log("2788 â–ˆâ–ˆ patched [33mattribToBackup[39m = "+JSON.stringify(_,null,4))):(console.log("2760 [36mâ–ˆâ–ˆ[39m standalone ESP tag - call the dump"),at(b,e))),ut("esp",e),console.log("2802 [32mSET[39m [33mtoken.start[39m = "+b.start+"; [33mtoken.type[39m = "+b.type),b.head=yt,b.headStartsAt=e,b.headEndsAt=e+yt.length,x&&x.pureHTML&&(x.pureHTML=!1,console.log("2815 [32mSET[39m [33mparentTokenToBackup.pureHTML[39m = "+JSON.stringify(x.pureHTML,null,4))),_&&Array.isArray(_.attribValue)&&_.attribValue.length&&(console.log("2841 *"),_.attribValue[~-_.attribValue.length].start===b.start?(console.log("2847 [31mTEXT TOKEN INITIATED WHERE ESP WILL BE[39m"),_.attribValue.pop(),console.log("2852 [31mPOP[39m attribToBackup.attribValue, now attribToBackup.attribValue: "+JSON.stringify(_.attribValue,null,4))):"text"!==_.attribValue[~-_.attribValue.length].type||_.attribValue[~-_.attribValue.length].end||(console.log("2867"),_.attribValue[~-_.attribValue.length].end=e,_.attribValue[~-_.attribValue.length].value=t.slice(_.attribValue[~-_.attribValue.length].start,e),console.log("2881 [32mSET[39m [33mattribToBackup.attribValue[\n                    "+~-_.attribValue.length+"\n                  ][39m = "+JSON.stringify(_.attribValue[~-_.attribValue.length],null,4))));g=e+(St||yt.length),console.log("2899 [32mSET[39m [31mdoNothing[39m = "+g)}console.log("2903 end of ESP head/tail clauses reached")}else!p||d||!t[e]||!t[e].trim()||"{}".includes(t[e])||b.type&&!["text"].includes(b.type)?b.type||(console.log("2957 BLANK token, so initiate text token"),ut("text",e),console.log("2960 [32mSET[39m [33mtoken[39m = "+JSON.stringify(b,null,4))):(console.log("2931 â–ˆâ–ˆ [32mat/rule starts[39m"),b.type&&(console.log("2935 call dumpCurrentToken()"),at(b,e)),ut("@"===t[e]?"at":"rule",e),b.left=M,console.log("2942 [32mSET[39m [33mtoken.left[39m = "+JSON.stringify(b.left,null,4)),b.nested=j.some((function(t){return"at"===t.type})),console.log("2950 [32mSET[39m [33mtoken.nested[39m = "+JSON.stringify(b.nested,null,4)));console.timeEnd("main-sorting-checks")}var kt,At,Nt,Tt=";'\"{}<>".includes(t[u(t,e-1)]),wt=O(t,e,["!important"],{i:!0,trimBeforeMatching:!0,maxMismatches:2});if(console.log("2977 [32mSET[39m ["+(Tt?32:31)+"mR1[39m = "+Tt+"; ["+(wt?32:31)+"mR2[39m = "+wt),g||!I||!(I.semi&&I.semi<e&&I.semi<e)&&((!I.valueStarts||I.valueEnds||"!"===t[f]||f&&!Tt)&&(!I.importantStarts||I.importantEnds)||I.valueEnds&&";"===t[f]||t[e]&&t[e].trim()&&(I.valueEnds||";"!==t[e])&&((!";}/".includes(t[kt=e])||T&&T.attribName&&"style"===T.attribName)&&!("/;'\"><".includes(t[kt])&&T&&"style"===T.attribName&&gt(kt))))||(console.log("3009 [32mcss property ends[39m"),I.importantStarts&&!I.importantEnds&&(I.importantEnds=c(t,e)+1,I.important=t.slice(I.importantStarts,I.importantEnds),console.log("3019 [32mSET[39m [33mproperty.importantEnds[39m = "+JSON.stringify(I.importantEnds,null,4)+"; [33mproperty.important[39m = "+JSON.stringify(I.important,null,4))),I.valueStarts&&!I.valueEnds&&(I.valueEnds=e,I.value=t.slice(I.valueStarts,e),console.log("3036 [32mSET[39m [33mproperty.valueEnds[39m = "+JSON.stringify(I.valueEnds,null,4)+"; [33mproperty.value[39m = "+JSON.stringify(I.value,null,4))),";"===t[e]?(I.semi=e,console.log("3052 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4)),I.end=e+1,console.log("3060 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))):";"===t[f]&&(I.semi=f,I.end=I.semi+1,console.log("3070 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4)+"; [33mproperty.end[39m = "+JSON.stringify(I.end,null,4)),g=I.end,console.log("3083 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))),I.end||(I.end=e,console.log("3094 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))),R(I),console.log("3104 push "+JSON.stringify(I,null,4)+", then [31mWIPE[39m"),L(),g||t[e]&&!t[e].trim()||";"!==t[e]||(g=e,console.log("3115 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4)))),!g&&I&&I.valueStarts&&!I.valueEnds)if(console.log("3135 [90mcss property's value ending clauses[39m"),!t[e]||Tt||wt||"!"===t[u(t,e-1)]||";}".includes(t[e])&&(!T||!T.attribName||"style"!==T.attribName)||";'\"".includes(t[e])&&T&&"style"===T.attribName&&gt(e)||f&&!t[e].trim()&&(t.slice(e,f).includes("\n")||t.slice(e,f).includes("\r")))console.log("3161 FIY, [33mlastNonWhitespaceCharAt[39m = "+JSON.stringify(M,null,4)),!M||"'\"".includes(t[e])&&f&&"'\";".includes(t[f])||(I.valueEnds=M+1,I.value=t.slice(I.valueStarts,M+1),console.log("3182 SET [33mproperty.valueEnds[39m = "+I.valueEnds+"; [33mproperty.value[39m = "+I.value)),";"===t[e]?(I.semi=e,console.log("3192 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4))):t[e]&&!t[e].trim()&&";"===t[f]&&(I.semi=f,console.log("3207 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4))),I.semi&&(I.end=I.semi+1,console.log("3222 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))),I.semi||Tt||wt||"!"===t[u(t,e-1)]||I.end||(I.end=e,console.log("3244 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))),console.log("3253 [32mNOW[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),I.end&&(I.end>e&&(g=I.end,console.log("3266 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))),R(I),L(),console.log("3276 push, then [31mWIPE[39m [33mproperty[39m"));else if(":"===t[e]&&I&&I.colon&&I.colon<e&&M&&I.colon+1<M){console.log("3291 [31mMISSING SEMICOL[39m"),console.log("3293 FIY, [33mlastNonWhitespaceCharAt[39m = "+JSON.stringify(M,null,4)),console.log('3309 â–ˆâ–ˆ "'+t.slice(u(t,I.colon),M+1)+'"');var Ct=[];if(u(t,I.colon)&&(Ct=t.slice(u(t,I.colon),M+1).split(/\s+/),console.log("[33msplit[39m = "+JSON.stringify(Ct,null,4))),2===Ct.length){I.valueEnds=I.valueStarts+Ct[0].length,I.value=t.slice(I.valueStarts,I.valueEnds),I.end=I.valueEnds,console.log("3340 [32mSET[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),console.log("3349 [32mPUSH[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),R(I);var Vt=I.end,xt=M+1-Ct[1].length;L(),console.log("3362 push, then [31mRESET[39m [33mproperty[39m"),R({type:"text",start:Vt,end:xt,value:t.slice(Vt,xt)}),console.log("3372 PUSH to [33mtoken.properties[39m, now = "+JSON.stringify(b.properties,null,4)),I.start=xt,I.propertyStarts=xt,console.log("3382 [32mSET[39m [33mproperty[39m = "+JSON.stringify(I,null,4))}}else"/"===t[e]&&"*"===t[f]&&(I.valueStarts&&!I.valueEnds&&(I.valueEnds=e,I.value=t.slice(I.valueStarts,e)),I.end||(I.end=e),console.log("3407 [32mNOW[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),R(I),L(),console.log("3418 push, then [31mWIPE[39m [33mproperty[39m"));(!g&&I&&I.start&&!I.end&&";"===t[e]&&(I.semi=e,I.end=e+1,console.log("3435 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4)+"; [33mproperty.end[39m = "+JSON.stringify(I.end,null,4)),I.propertyEnds||(I.propertyEnds=e,console.log("3448 [32mSET[39m [33mproperty.propertyEnds[39m = "+JSON.stringify(I.propertyEnds,null,4))),I.propertyStarts&&I.propertyEnds&&!I.property&&(I.property=t.slice(I.propertyStarts,I.propertyEnds),console.log("3465 [32mSET[39m [33mproperty.property[39m = "+JSON.stringify(I.property,null,4))),R(I),console.log("3475 push "+JSON.stringify(I,null,4)+", then [31mWIPE[39m"),L(),g=e,console.log("3485 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))),I&&I.importantStarts&&!I.importantEnds&&t[e]&&!t[e].trim()&&(I.importantEnds=e,I.important=t.slice(I.importantStarts,e),console.log("3506 [32mSET[39m [33mproperty.importantEnds[39m = "+I.importantEnds+";  [33mproperty.important[39m = "+JSON.stringify(I.important,null,0))),!g&&I&&I.valueEnds&&!I.importantStarts&&("!"===t[e]||D(t[e])&&t.slice(e).match(ot))&&(console.log("3530 [32mcss property's !important starts[39m"),I.importantStarts=e,console.log("3534 [32mSET[39m [33mproperty.importantStarts[39m = "+JSON.stringify(I.importantStarts,null,4)),(t[e-1]&&t[e-1].trim()&&t[e-2]&&!t[e-2].trim()||"1"===t[e-1]&&t[e-2]&&!/\d/.test(t[e-2]))&&(I.valueEnds=c(t,e-1)+1,I.value=t.slice(I.valueStarts,I.valueEnds),console.log("3568 [32mSET[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),I.importantStarts--,I.important=t[e-1]+I.important)),!g&&I&&I.colon&&!I.valueStarts&&t[e]&&t[e].trim())&&(console.log("3590"),";}'\"".includes(t[e])&&gt(e)?(console.log("3598 [31mbroken code![39m"),";"===t[e]&&(I.semi=e,console.log("3603 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4))),I.end||(I.end=I.semi?I.semi+1:c(t,e)+1,console.log("3620 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4)),At=I.end),R(I),L(),console.log("3633 push, then [31mWIPE[39m [33mproperty[39m"),console.log("3637 FIY, [33mtemp[39m = "+JSON.stringify(At,null,4)),At&&At<e&&R({type:"text",start:At,end:e,value:t.slice(At,e)})):"!"===t[e]?(console.log("3656 [32mcss property's !important starts[39m"),I.importantStarts=e,console.log("3660 [32mSET[39m [33mproperty.importantStarts[39m = "+I.importantStarts)):(console.log("3666 [32mcss property's value starts[39m"),I.valueStarts=e,console.log("3670 [32mSET[39m [33mproperty.valueStarts[39m = "+I.valueStarts)));if(g||"rule"!==b.type||!t[e]||!t[e].trim()||"{}".includes(t[e])||V||b.openingCurlyAt||(",".includes(t[e])?(b.selectorsEnd=e+1,console.log("3707 [32mSET[39m [33mtoken.selectorsEnd[39m = "+b.selectorsEnd)):(V=e,console.log("3691 [32mSET[39m [33mselectorChunkStartedAt[39m = "+V),null===b.selectorsStart&&(b.selectorsStart=e,console.log("3697 [32mSET[39m [33mtoken.selectorsStart[39m = "+b.selectorsStart)))),!g&&I&&I.propertyStarts&&I.propertyStarts<e&&!I.propertyEnds&&(!t[e]||!t[e].trim()||!Z.test(t[e])&&(":"===t[e]||!f||!":/}".includes(t[f])||"}"===t[e]&&"}"===t[f])||"!"===t[e])&&("/"!==t[e]||"/"!==t[e-1])&&(console.log("3760 [32mcss property's name ends[39m"),I.propertyEnds=e,I.property=t.slice(I.propertyStarts,e),console.log("3766 [32mSET[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),I.valueStarts&&(I.end=e,console.log("3779 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))),("};".includes(t[e])||t[e]&&!t[e].trim()&&":"!==t[f])&&(";"===t[e]&&(I.semi=e,console.log("3798 [32mSET[39m [33mproperty.semi[39m = "+JSON.stringify(I.semi,null,4))),I.end||(I.end=I.semi?I.semi+1:e,console.log("3812 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4))),R(I),L(),console.log("3824 push, then [31mWIPE[39m [33mproperty[39m")),t[e]&&t[e].trim()&&Z.test(t[I.propertyStarts])&&!Z.test(t[e])&&!":'\"".includes(t[e]))){console.log("3843 [31mdodgy character?[39m");var _t=t.indexOf(";",e),Jt=t.indexOf(":",e);console.log("3849 [32mSET[39m [33mnextSemi[39m = "+_t+"; [33mnextColon[39m = "+Jt),(-1!==Jt||-1===_t)&&-1!==Jt&&-1!==_t&&Jt<_t||"{}".includes(t[e])||!f||"!".includes(t[e])&&!D(t[f])?-1!==Jt&&-1!==_t&&Jt<_t?(console.log("3898 [32mCORRECTION #2 - patch by extending the prop[39m"),I.propertyEnds=null,console.log("3902 [32mSET[39m [33mproperty.propertyEnds[39m = "+I.propertyEnds)):"!"===t[e]&&(I.importantStarts=e,console.log("3909 [32mSET[39m [33mproperty.importantStarts[39m = "+I.importantStarts)):(console.log("3877 [32mCORRECTION #1 - set this as colon[39m"),I.colon=e,I.valueStarts=f,console.log("3882 [32mSET[39m [33mproperty.colon[39m = "+I.colon+"; [33mproperty.valueStarts[39m = "+I.valueStarts))}if(!g&&I&&I.propertyEnds&&!I.valueStarts&&":"===t[e]&&(I.colon=e,console.log("3934 [32mSET[39m [33mproperty.colon[39m = "+JSON.stringify(I.colon,null,4)),f||(I.end=e+1,console.log("3945 [32mSET[39m [33mproperty.end[39m = "+JSON.stringify(I.end,null,4)),t[e+1]&&(R(I),L(),console.log("3957 push, then [31mWIPE[39m [33mproperty[39m"),b.properties&&(b.properties.push({type:"text",start:e+1,end:null,value:null}),console.log("3969 PUSH to [33mtoken.properties[39m, now = "+JSON.stringify(b.properties,null,4)),g=e+1,console.log("3978 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))))),console.log("3989 FIY, [33mlastNonWhitespaceCharAt[39m = "+JSON.stringify(M,null,4)),I.propertyEnds&&M&&I.propertyEnds!==M+1&&!Z.test(t[I.propertyEnds])&&(I.propertyEnds=M+1,I.property=t.slice(I.propertyStarts,I.propertyEnds),console.log("4014 [32mSET[39m [33mproperty.propertyEnds[39m = "+I.propertyEnds+"; [33mproperty.property[39m = "+I.property))),!g&&"rule"===b.type&&t[e]&&t[e].trim()&&!"{}".includes(t[e])&&b.selectorsEnd&&b.openingCurlyAt&&!I.propertyStarts&&!I.importantStarts&&(console.log("4041 [32mcss property's name starts[39m"),Array.isArray(b.properties)&&b.properties.length&&b.properties[~-b.properties.length].start&&!b.properties[~-b.properties.length].end&&(b.properties[~-b.properties.length].end=e,b.properties[~-b.properties.length].value=t.slice(b.properties[~-b.properties.length].start,e),console.log("4057 [32mSET[39m last elem of [33mtoken.properties[][39m to: "+JSON.stringify(b.properties[~-b.properties.length],null,4))),";"===t[e]?(console.log("4075"),ct({start:e,end:e+1,semi:e}),R(I),L(),console.log("4084 init, push, then [31mWIPE[39m [33mproperty[39m")):"!"===t[e]?(console.log("4087"),ct({start:e,importantStarts:e}),console.log("4093 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4))):(console.log("4100"),ct(e),console.log("4103 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4))),g=e,console.log("4113 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))),g||!T||"style"!==T.attribName||!T.attribOpeningQuoteAt||T.attribClosingQuoteAt||I.start||!t[e]||!t[e].trim()||"'\"".includes(t[e])||et("block")||(console.log("4157 inside start of css property/comment token"),"/"===t[e]&&"*"===t[f]?(console.log("4170 [32mBLOCK COMMENT OPENING[39m"),C({type:"comment",start:e,end:f+1,value:t.slice(e,f+1),closing:!1,kind:"block",language:"css"}),j.push({type:"block",value:t.slice(e,f+1),position:e}),console.log("4190 [32mPUSH[39m new layer, "+JSON.stringify({type:"block",value:t[e],position:e},null,4)),g=f+1,console.log("4204 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))):"*"===t[e]&&"/"===t[f]?(console.log("4213 call closingComment()"),lt(e)):(console.log("4216"),Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(T.attribValue[~-T.attribValue.length].end=e,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,e),console.log("4229 complete last attrib object: "+JSON.stringify(T.attribValue[~-T.attribValue.length],null,4))),";"===t[e]?(console.log("4243"),ct({start:e,end:e+1,semi:e}),console.log("4250 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),g=e,console.log("4258 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))):wt?(console.log("4265"),ct({start:e,importantStarts:e}),console.log("4271 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4))):(console.log("4282"),ct(e),console.log("4285 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4))))),"comment"===b.type&&["only","not"].includes(b.kind),!g)if("tag"!==b.type||j.length||">"!==t[e])if("comment"===b.type&&"html"===b.language&&!j.length&&"simple"===b.kind&&("<"===t[b.start]&&"-"===t[e]&&(E(t,e,"!-",{trimBeforeMatching:!0})||function(t,e,n,o){return v("matchLeftIncl",t,e,n,o)}(t,e,"!-",{trimBeforeMatching:!0})&&"-"!==t[e+1])||"-"===t[b.start]&&">"===t[e]&&E(t,e,"--",{trimBeforeMatching:!0,maxMismatches:1})))"-"===t[e]&&(k(t,e,["[if","(if","{if"],{i:!0,trimBeforeMatching:!0})||k(t,e,["if"],{i:!0,trimBeforeMatching:!0})&&(Q(t,e,"]",">")||t.includes("mso",e)&&!t.slice(e,t.indexOf("mso")).includes("<")&&!t.slice(e,t.indexOf("mso")).includes(">")))?(console.log('4364 [32mOUTLOOK CONDITIONAL "ONLY" DETECTED[39m'),b.kind="only",console.log("4368 [32mSET[39m [33mtoken.kind[39m = "+b.kind)):"-"!==t[b.start]&&O(t,e,["-<![endif"],{i:!0,trimBeforeMatching:!0,maxMismatches:2})?(console.log('4391 [32mOUTLOOK CONDITIONAL "NOT" DETECTED[39m'),b.kind="not",b.closing=!0,console.log("4396 [32mSET[39m [33mtoken.kind[39m = "+b.kind+"; [33mtoken.closing[39m = "+b.closing)):"simple"!==b.kind||"html"!==b.language||b.closing||">"!==t[f]?"html"===b.language&&(console.log("4432 [32m"+b.kind+" comment token's ending caught[39m"),b.end=e+1,"!"===t[n]&&"-"===t[f]&&(b.end=f+1,console.log("4444 [32mSET[39m [33mtoken.end[39m = "+b.end)),b.value=t.slice(b.start,b.end),console.log("4452 [32mSET[39m [33mtoken.end[39m = "+b.end)):(console.log("4409 [32msimplet-kind comment token's ending caught[39m"),b.end=f+1,b.kind="simplet",b.closing=null,console.log("4415 [32mSET[39m [33mtoken.end[39m = "+b.end),console.log("4420 [32mSET[39m [33mtoken.kind[39m = "+b.kind),console.log("4425 [32mSET[39m [33mtoken.closing[39m = "+b.closing));else if("comment"!==b.type||"html"!==b.language||">"!==t[e]||j.length&&"<"!==t[f]){if("comment"===b.type&&"css"===b.language&&"*"===t[e]&&"/"===t[e+1])b.end=e+1,b.value=t.slice(b.start,b.end),console.log("4518 [32mSET[39m [33mtoken.end[39m = "+b.end);else if("esp"===b.type&&null===b.end&&"string"==typeof b.head&&"string"==typeof b.tail&&b.tail.includes(t[e])){console.log("4529 POSSIBLE ESP TAILS");for(var Pt="",It=e;It<s&&F.includes(t[It]);It++)Pt+=t[It];if(console.log("4540 wholeEspTagClosing = "+Pt),Pt.length>b.head.length){console.log("4550 wholeEspTagClosing.length = [33m"+Pt.length+"[39m > token.head.length = [33m"+b.head.length+"[39m");var Lt=b.head[0];if(Pt.endsWith(b.head))console.log("4578 - chunk ends with the same heads"),b.end=e+Pt.length-b.head.length,b.value=t.slice(b.start,b.end),console.log("4601 [32mSET[39m [33mtoken.end[39m = "+b.end),g=b.end,console.log("4607 [32mSET[39m [31mdoNothing[39m = "+g);else if(Pt.startsWith(b.tail))b.end=e+b.tail.length,b.value=t.slice(b.start,b.end),console.log("4613 [32mSET[39m [33mtoken.end[39m = "+b.end),g=b.end,console.log("4619 [32mSET[39m [31mdoNothing[39m = "+g);else if(!b.tail.includes(Lt)&&Pt.includes(Lt)||Pt.endsWith(b.head)||Pt.startsWith(b.tail)){console.log("4627");var Rt=Pt.slice(0,Pt.indexOf(Lt)),Mt=Pt.slice(Pt.indexOf(Lt));console.log("[33mfirstPartOfWholeEspTagClosing[39m = "+JSON.stringify(Rt,null,4)),console.log("[33msecondPartOfWholeEspTagClosing[39m = "+JSON.stringify(Mt,null,4)),Rt.length&&Mt.length&&b.tail.split("").every((function(t){return Rt.includes(t)}))&&(console.log("4662 definitely tails + new heads"),b.end=e+Rt.length,b.value=t.slice(b.start,b.end),console.log("4666 [32mSET[39m [33mtoken.end[39m = "+b.end),g=b.end,console.log("4672 [32mSET[39m [31mdoNothing[39m = "+g))}else console.log("CASE #2."),b.end=e+Pt.length,b.value=t.slice(b.start,b.end),console.log("4688 [32mSET[39m [33mtoken.end[39m = "+b.end),g=b.end,console.log("4694 [32mSET[39m [31mdoNothing[39m = "+g);console.log("4697")}else b.end=e+Pt.length,b.value=t.slice(b.start,b.end),console.log("4703 [32mSET[39m [33mtoken.end[39m = "+b.end),et("esp")&&(console.log("4711 [32mPOP[39m layers, now [33mlayers[39m: "+JSON.stringify(j,null,4)),j.pop()),g=b.end,console.log("4722 [32mSET[39m [31mdoNothing[39m = "+g)}}else Array.isArray(j)&&j.length&&"["===j[~-j.length].value&&(j.pop(),console.log("4475 [31mPOP[39m layers")),!["simplet","not"].includes(b.kind)&&k(t,e,["\x3c!--\x3e","\x3c!----\x3e"],{trimBeforeMatching:!0,maxMismatches:1,lastMustMatch:!0})?(console.log('4489 that\'s kind="not" comment and it continues on the right'),b.kind="not",console.log("4493 [32mSET[39m [33mtoken.kind[39m = "+b.kind)):(console.log('4499 that\'s the end of opening type="comment" kind="only" comment'),b.end=e+1,b.value=t.slice(b.start,b.end),console.log("4504 [32mSET[39m [33mtoken.end[39m = "+b.end));else b.end=e+1,b.value=t.slice(b.start,b.end),console.log("4313 [32mSET[39m [33mtoken.end[39m = "+b.end);if(g||"tag"!==b.type||!b.tagNameStartsAt||b.tagNameEndsAt||(console.log("4738 catch the end of a tag name clauses"),t[e]&&/[.\-_a-z0-9\u00B7\u00C0-\uFFFD]/i.test(t[e])||(b.tagNameEndsAt=e,console.log("4744 [32mSET[39m [33mtoken.tagNameEndsAt[39m = "+b.tagNameEndsAt),b.tagName=t.slice(b.tagNameStartsAt,e).toLowerCase(),console.log("4751 [32mSET[39m [33mtoken.tagName[39m = "+b.tagName),"xml"===b.tagName&&b.closing&&!b.kind&&(b.kind="xml",console.log("4759 [32mSET[39m [33mtoken.kind[39m = "+b.kind)),G.includes(b.tagName)&&(b.void=!0,console.log("4771 [32mSET[39m [33mtoken.void[39m = "+b.void)),b.recognised=U(b.tagName),console.log("4780 [32mSET[39m [33mtoken.recognised[39m = "+b.recognised))),g||"tag"!==b.type||b.tagNameStartsAt||null==b.start||!(b.start<e||"<"!==t[b.start])||(console.log("4797 catch the start of a tag name clauses"),"/"===t[e]?(b.closing=!0,console.log("4804 [32mSET[39m [33mtoken.closing[39m = "+b.closing)):D(t[e])&&(b.tagNameStartsAt=e,console.log("4811 [32mSET[39m [33mtoken.tagNameStartsAt[39m = "+b.tagNameStartsAt),b.closing||(b.closing=!1,console.log("4820 [32mSET[39m [33mtoken.closing[39m = "+b.closing)))),!g&&"tag"===b.type&&"cdata"!==b.kind&&T.attribNameStartsAt&&e>T.attribNameStartsAt&&null===T.attribNameEndsAt&&!N(t[e])&&(console.log("4842 inside catch the tag attribute name end clauses"),T.attribNameEndsAt=e,T.attribName=t.slice(T.attribNameStartsAt,e),T.attribNameRecognised=A.has(T.attribName),T.attribName.startsWith("mc:")&&(b.pureHTML=!1),console.log("4853 [32mSET[39m [33mattrib.attribNameEndsAt[39m = "+T.attribNameEndsAt+"; [33mattrib.attribName[39m = "+JSON.stringify(T.attribName,null,0)),t[e]&&!t[e].trim()&&"="===t[f]?console.log("4864 equal on the right"):(t[e]&&!t[e].trim()||">"===t[e]||"/"===t[e]&&">"===t[f])&&("'\"".includes(t[f])?console.log("4872 [31mspace instead of equal[39m"):(console.log("4876 [31ma value-less attribute detected[39m"),T.attribEnds=e,console.log("4880 [32mSET[39m [33mattrib.attribEnds[39m = "+T.attribEnds),console.log("4887 [32mPUSH ATTR AND WIPE[39m"),b.attribs.push(a(T)),w()))),!g&&t[e]&&"tag"===b.type&&"cdata"!==b.kind&&b.tagNameEndsAt&&e>b.tagNameEndsAt&&null===T.attribStarts&&N(t[e])&&(console.log("4907 inside catch the tag attribute name start clauses"),T.attribStarts=e,T.attribLeft=M,T.attribNameStartsAt=e,console.log("4915 [32mSET[39m [33mattrib.attribStarts[39m = "+T.attribStarts+"; [33mattrib.attribLeft[39m = "+T.attribLeft+"; [33mattrib.attribNameStartsAt[39m = "+T.attribNameStartsAt),console.log("4925 [33mattrib.attribValue[39m = "+JSON.stringify(T.attribValue,null,4))),g||"rule"!==b.type||("{"!==t[e]||b.openingCurlyAt?"}"===t[e]&&b.openingCurlyAt&&!b.closingCurlyAt&&(b.closingCurlyAt=e,b.end=e+1,b.value=t.slice(b.start,b.end),console.log("4953 [32mSET[39m [33mtoken.closingCurlyAt[39m = "+b.closingCurlyAt+"; [33mtoken.end[39m = "+b.end),Array.isArray(b.properties)&&b.properties.length&&b.properties[~-b.properties.length].start&&!b.properties[~-b.properties.length].end&&(b.properties[~-b.properties.length].end=e,b.properties[~-b.properties.length].value=t.slice(b.properties[~-b.properties.length].start,e),console.log("4971 [32mCOMPLETE[39m [33mtoken.properties[][39m last elem, now = "+JSON.stringify(b.properties[~-b.properties.length],null,4))),I.start&&(console.log("4982 [32mPUSH[39m the pending property"),b.properties.push(I),L()),console.log("4988 [32mPING[39m"),st(b),et("at")&&(console.log("4995 [32mPUSH this rule into last AT layer[39m"),j[~-j.length].token.rules.push(b)),console.log("5000 [32mRESET[39m"),y()):(b.openingCurlyAt=e,console.log("4940 [32mSET[39m [33mtoken.openingCurlyAt[39m = "+b.openingCurlyAt))),!g&&T.attribName&&Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(console.log("5017 [35mâ–ˆâ–ˆ[39m inside attribute sub-token end clauses"),"*"===t[e]&&"/"===t[f]&&lt(e)),(!g&&T&&T.attribValueStartsAt&&!T.attribValueEndsAt&&!I.propertyStarts&&e>=T.attribValueStartsAt&&Array.isArray(T.attribValue)&&(!T.attribValue.length||T.attribValue[~-T.attribValue.length].end&&T.attribValue[~-T.attribValue.length].end<=e)||!g&&"rule"===b.type&&b.openingCurlyAt&&!b.closingCurlyAt&&!I.propertyStarts)&&(console.log("5061 [36mâ–ˆâ–ˆ[39m inside attribute sub-token start clauses"),";"===t[e]&&(T&&Array.isArray(T.attribValue)&&T.attribValue.length&&T.attribValue[~-T.attribValue.length].semi&&T.attribValue[~-T.attribValue.length].semi<e||b&&"rule"===b.type&&Array.isArray(b.properties)&&b.properties.length&&b.properties[~-b.properties.length].semi&&b.properties[~-b.properties.length].semi<e)?(ct({start:e,semi:e}),console.log("5109 [32mINIT[39m [33mproperty[39m = "+JSON.stringify(I,null,4)),g=e+1,console.log("5117 [32mSET[39m [31mdoNothing[39m = "+JSON.stringify(g,null,4))):(t[e]&&!t[e].trim()||et("block"))&&(console.log("5139"),T.attribName?(T.attribValue.push({type:"text",start:e,end:null,value:null}),console.log("5149 PUSH to [33mattrib.attribValue[39m, now = "+JSON.stringify(T.attribValue,null,4))):"rule"!==b.type||Array.isArray(b.properties)&&b.properties.length&&!b.properties[~-b.properties.length].end||(b.properties.push({type:"text",start:e,end:null,value:null}),console.log("5170 PUSH to [33mtoken.properties[39m, now = "+JSON.stringify(b.properties,null,4))))),!g&&"tag"===b.type&&T.attribValueStartsAt&&e>=T.attribValueStartsAt&&null===T.attribValueEndsAt)if(console.log("5190 inside a catching end of a tag attr clauses"),K.includes(t[e]))console.log("5192 currently on a quote"),console.log("5195 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ isAttrClosing(str, "+(T.attribOpeningQuoteAt||T.attribValueStartsAt)+", "+e+") = "+J(t,T.attribOpeningQuoteAt||T.attribValueStartsAt,e)),j.some((function(t){return"esp"===t.type}))||t[e]&&t.includes(">",e)&&!J(t,T.attribOpeningQuoteAt||T.attribValueStartsAt,e)?Array.isArray(T.attribValue)&&T.attribValue.length&&"text"===T.attribValue[~-T.attribValue.length].type||I.propertyStarts||(T.attribValue.push({type:"text",start:e,end:null,value:null}),console.log("5358 [32mPUSH[39m new to attrib.attribValue, now [33mattrib.attribValue[39m: "+JSON.stringify(T.attribValue,null,4))):(console.log("5233 [32mopening and closing quotes matched![39m"),console.log("5236 [32mFIY[39m, [33mattrib[39m = "+JSON.stringify(T,null,4)),T.attribClosingQuoteAt=e,T.attribValueEndsAt=e,T.attribValueStartsAt&&(T.attribValueRaw=t.slice(T.attribValueStartsAt,e)),T.attribEnds=e+1,I.propertyStarts&&(T.attribValue.push(a(I)),console.log("5253 [32mPUSH[39m property into [33mattrib.attribValue[39m"),L(),console.log("5257 [31mWIPE[39m property")),Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(console.log('5267 set the ending on the last object within "attribValue"'),T.attribValue[~-T.attribValue.length].property||(T.attribValue[~-T.attribValue.length].end=e,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,e),console.log("5279 [32mSET[39m [33mattrib.attribValue["+~-T.attribValue.length+"].end[39m = "+T.attribValue[~-T.attribValue.length].end+"; [33mattrib.attribValue["+~-T.attribValue.length+"].value[39m = "+T.attribValue[~-T.attribValue.length].value))),console.log("5290 [32mNOW[39m [33mattrib[39m = "+JSON.stringify(T,null,4)),t[T.attribOpeningQuoteAt]!==t[e]&&(j.pop(),j.pop(),console.log("5302 POP x 2, now layers = "+JSON.stringify(j,null,4))),T.attribValue[~-T.attribValue.length]&&!T.attribValue[~-T.attribValue.length].end&&(T.attribValue[~-T.attribValue.length].end=e,console.log("5317 [32mSET[39m .end on the last attribValue, now = "+JSON.stringify(T.attribValue[~-T.attribValue.length],null,4))),console.log("5327 [32mPUSH[39m [33mattrib[39m = "+JSON.stringify(T,null,4)),b.attribs.push(a(T)),w()),console.log("5366");else if(null===T.attribOpeningQuoteAt&&(t[e]&&!t[e].trim()||["/",">"].includes(t[e])||F.includes(t[e])&&F.includes(t[e+1])))console.log("5375 opening quote was missing, terminate attr val here"),T.attribValueEndsAt=e,T.attribValueRaw=t.slice(T.attribValueStartsAt,e),Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(T.attribValue[~-T.attribValue.length].end=e,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,T.attribValue[~-T.attribValue.length].end)),T.attribEnds=e,console.log("5392 [32mSET[39m [33mattrib.attribValueEndsAt[39m = "+T.attribValueEndsAt+"; [33mattrib.attribValueRaw[39m = "+T.attribValueRaw+"; [33mattrib.attribValue[39m = "+JSON.stringify(T.attribValue,null,4)+"; [33mattrib.attribEnds[39m = "+T.attribEnds),b.attribs.push(a(T)),w(),j.pop(),console.log("5412 [31mPOP[39m [33mlayers[39m, now:\n"+JSON.stringify(j,null,4)),">"===t[e]&&(b.end=e+1,b.value=t.slice(b.start,b.end),console.log("5424 [32mSET[39m [33mtoken.end[39m = "+b.end));else if("="!==t[e]||null===n||!f||!("'\"".includes(t[f])||t[~-e]&&D(t[~-e]))||T&&T.attribOpeningQuoteAt&&(/\//.test(t.slice(T.attribOpeningQuoteAt+1,e))||/mailto:/.test(t.slice(T.attribOpeningQuoteAt+1,e))||/\w\?\w/.test(t.slice(T.attribOpeningQuoteAt+1,e))))!T||"style"===T.attribName||!T.attribStarts||T.attribEnds||I.propertyStarts||Array.isArray(T.attribValue)&&T.attribValue.length&&!(T.attribValue[~-T.attribValue.length].end&&T.attribValue[~-T.attribValue.length].end<=e)||(console.log("5656 [33mATTR. DOESN'T END, STRING VALUE TOKEN STARTS UNDER attribValue[39m"),T.attribValue.push({type:"text",start:e,end:null,value:null}),console.log("5667 [32mPUSH[39m new to attrib.attribValue, now [33mattrib.attribValue[39m: "+JSON.stringify(T.attribValue,null,4)));else{var jt,Ft;console.log("5455 [31mMISSING CLOSING QUOTE ON PREVIOUS ATTR.[39m"),console.log("5466 [36mâ–ˆâ–ˆ traverse backwards, try to salvage something[39m");for(var Bt=n;Bt>=T.attribValueStartsAt;Bt--){if(console.log("5473 [36m------- str["+Bt+"] = "+t[Bt]+" -------[39m"),!jt&&t[Bt]&&!t[Bt].trim()&&(jt=!0,Ft)){var Wt=t.slice(Bt,Ft);console.log("5484 [33mextractedChunksVal[39m = "+JSON.stringify(Wt,null,4))}jt&&t[Bt]&&t[Bt].trim()&&(jt=!1,Ft?console.log("5509 X"):(Ft=Bt+1,console.log("5506 SET attribClosingQuoteAt = "+Ft)))}if(console.log("5515 FIY, [33mattribClosingQuoteAt[39m = "+JSON.stringify(Ft,null,4)),Ft)return T.attribValueEndsAt=Ft,T.attribValueStartsAt&&(T.attribValueRaw=t.slice(T.attribValueStartsAt,Ft),console.log("5531 FIY, [33mattrib[39m = "+JSON.stringify(T,null,4)),Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(T.attribValue[~-T.attribValue.length].end=T.attribValueEndsAt,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,T.attribValueEndsAt),console.log("5550 [32mSET[39m attrib.attribValue's last object's end and value: "+JSON.stringify(T.attribValue,null,4)))),T.attribEnds=Ft,console.log("5560 [32mSET[39m [33mattrib.attribClosingQuoteAt[39m = "+T.attribClosingQuoteAt+"; [33mattrib.attribValueEndsAt[39m = "+T.attribValueEndsAt+"; [33mattrib.attribValueRaw[39m = "+T.attribValueRaw+"; [33mattrib.attribValue[39m = "+JSON.stringify(T.attribValue,null,4)+"; [33mattrib.attribEnds[39m = "+T.attribEnds),t[T.attribOpeningQuoteAt]!==t[e]&&(j.pop(),console.log("5579 POP x 1, now layers = "+JSON.stringify(j,null,4))),b.attribs.push(a(T)),w(),console.log("5588 â–ˆâ–ˆ [33mattrib[39m = "+JSON.stringify(T,null,4)),e=~-Ft,console.timeEnd("[90mloop iteration[39m"),dt=e,"continue";if(T.attribOpeningQuoteAt&&("'\"".includes(t[f])||A.has(t.slice(T.attribOpeningQuoteAt+1,e).trim())))return e=T.attribOpeningQuoteAt,T.attribEnds=T.attribOpeningQuoteAt+1,console.log("5619 SET [32mSET[39m [33mattrib.attribEnds[39m = "+T.attribEnds),T.attribValueStartsAt=null,j.pop(),b.attribs.push(a(T)),w(),console.timeEnd("[90mloop iteration[39m"),dt=e,"continue"}else"esp"===b.type&&_&&x&&_.attribOpeningQuoteAt&&_.attribValueStartsAt&&"'\"".includes(t[e])&&t[_.attribOpeningQuoteAt]===t[e]&&J(t,_.attribOpeningQuoteAt,e)&&(console.log("5685 [31mâ–ˆâ–ˆ[39m emergency catching tag attr closing quotes inside attribute, with ESP tag unclosed"),console.log("5697 [32mopening and closing quotes matched![39m"),console.log("5700 [32mFIY[39m, [33mattribToBackup[39m = "+JSON.stringify(_,null,4)),b.end=e,b.value=t.slice(b.start,e),_&&!Array.isArray(_.attribValue)&&(_.attribValue=[]),console.log("5715 push token to attribValue"),_.attribValue.push(b),_.attribValueEndsAt=e,_.attribValueRaw=t.slice(_.attribValueStartsAt,e),_.attribClosingQuoteAt=e,_.attribEnds=e+1,(b=a(x)).attribs.push(_),_=void 0,x=void 0,console.log("5737 FIY, now [33mtoken[39m = "+JSON.stringify(b,null,4)),j.pop(),j.pop(),j.pop());if(!g&&"tag"===b.type&&!T.attribValueStartsAt&&T.attribNameEndsAt&&T.attribNameEndsAt<=e&&t[e]&&t[e].trim())if(console.log("5781 inside catching attr value start clauses"),"="!==t[e]||K.includes(t[f])||"=".includes(t[f])||F.includes(t[f])){if(K.includes(t[e])){var Ht=f;!(Ht&&K.includes(t[Ht])&&t[e]!==t[Ht]&&t.length>Ht+2&&t.slice(Ht+1).includes(t[Ht]))||t.indexOf(t[Ht],Ht+1)&&u(t,t.indexOf(t[Ht],Ht+1))&&t[e]===t[u(t,t.indexOf(t[Ht],Ht+1))]||Array.from(t.slice(Ht+1,t.indexOf(t[Ht]))).some((function(n){return("<>="+t[e]).includes(n)}))?T.attribOpeningQuoteAt?(J(t,T.attribOpeningQuoteAt,e)&&(console.log("5959"),T.attribClosingQuoteAt=e,console.log("5962 [32mSET[39m [33mattrib.attribClosingQuoteAt[39m = "+JSON.stringify(T.attribClosingQuoteAt,null,4))),T.attribOpeningQuoteAt&&T.attribClosingQuoteAt&&(T.attribOpeningQuoteAt<~-T.attribClosingQuoteAt?(T.attribValueRaw=t.slice(T.attribOpeningQuoteAt+1,T.attribClosingQuoteAt),console.log("5978 [32mSET[39m [33mattrib.attribValueRaw[39m = "+JSON.stringify(T.attribValueRaw,null,4))):(T.attribValueRaw="",console.log("5987 [32mSET[39m [33mattrib.attribValueRaw[39m = "+JSON.stringify(T.attribValueRaw,null,4))),T.attribEnds=e+1,console.log("5997 [32mSET[39m  [33mattrib.attribEnds[39m = "+T.attribEnds),console.log("6003 [32mattrib wipe, push and reset[39m"),b.attribs.push(a(T)),w()),console.log("6009 now [33mattrib[39m = "+JSON.stringify(T,null,4))):(console.log("5929 all fine, mark the quote as starting"),T.attribOpeningQuoteAt=e,console.log("5932 [32mSET[39m [33mattrib.attribOpeningQuoteAt[39m = "+T.attribOpeningQuoteAt),!t[e+1]||t[e+1]===t[e]&&gt(e+1)||(T.attribValueStartsAt=e+1,console.log("5947 [32mSET[39m [33mattrib.attribValueStartsAt[39m = "+T.attribValueStartsAt))):(console.log("5919 [31mrogue quote![39m"),j.pop())}}else{var Dt=K.split("").map((function(e){return t.indexOf(e,f)})).filter((function(t){return t>0})).length?Math.min.apply(Math,K.split("").map((function(e){return t.indexOf(e,f)})).filter((function(t){return t>0}))):void 0;console.log("5800 [33mfirstQuoteOnTheRightIdx[39m = "+JSON.stringify(Dt,null,4)),f&&t.slice(f).includes("=")&&A.has(t.slice(f,f+t.slice(f).indexOf("=")).trim().toLowerCase())?(console.log("5822 attribute ends"),T.attribEnds=e+1,console.log("5831 [32mattrib wipe, push and reset[39m"),b.attribs.push(o({},T)),w()):Dt&&!t.slice(f,Dt).includes("=")&&t.includes(t[Dt],Dt+1)&&!Array.from(t.slice(Dt+1,t.indexOf(t[Dt],Dt+1))).some((function(t){return"<>=".includes(t)}))||(console.log("5861 case of missing opening quotes - attribute continues"),T.attribValueStartsAt=f,console.log("5866 [32mSET[39m [33mattrib.attribValueStartsAt[39m = "+T.attribValueStartsAt),j.push({type:"simple",value:null,position:T.attribValueStartsAt}),console.log("5878 [32mPUSH[39m "+JSON.stringify({type:"simple",value:null,position:T.attribValueStartsAt},null,4)))}if(!g&&">"===t[e]&&"%"!==t[e-1]&&"tag"===b.type&&T.attribStarts&&!T.attribEnds){console.log("6047 [31mâ–ˆâ–ˆ[39m bracket within attribute's value");var qt=!1;if(t[e+1])for(var Ut=e+1;Ut<s;Ut++){if(console.log("6066 [36mstr["+Ut+"] = "+JSON.stringify(t[Ut],null,0)+"[39m"),T.attribOpeningQuoteAt&&t[Ut]===t[T.attribOpeningQuoteAt]){console.log("6079 closing quote ("+t[T.attribOpeningQuoteAt]+") found, [31mBREAK[39m"),Ut!==e+1&&"="!==t[~-Ut]&&(qt=!0,console.log("6086 [32mSET[39m [33mthisIsRealEnding[39m = "+qt));break}if(">"===t[Ut])break;if("<"===t[Ut]){qt=!0,console.log("6097 [32mSET[39m [33mthisIsRealEnding[39m = "+qt),j.pop(),console.log("6104 [31mPOP[39m [33mlayers[39m, now:\n"+JSON.stringify(j,null,4)),console.log("6111 break");break}if(!t[Ut+1]){qt=!0,console.log("6117 [32mSET[39m [33mthisIsRealEnding[39m = "+qt),console.log("6120 break");break}}else console.log("6125 string ends so this was the bracket"),qt=!0;qt&&(b.end=e+1,b.value=t.slice(b.start,b.end),console.log("6142 [32mSET[39m [33mtoken.end[39m = "+b.end),T.attribValueStartsAt&&e&&T.attribValueStartsAt<e&&t.slice(T.attribValueStartsAt,e).trim()?(T.attribValueEndsAt=e,T.attribValueRaw=t.slice(T.attribValueStartsAt,e),Array.isArray(T.attribValue)&&T.attribValue.length&&!T.attribValue[~-T.attribValue.length].end&&(console.log("6164"),T.attribValue[~-T.attribValue.length].end=e,T.attribValue[~-T.attribValue.length].value=t.slice(T.attribValue[~-T.attribValue.length].start,e))):T.attribValueStartsAt=null,null===T.attribEnds&&(T.attribEnds=e,console.log("6179 [32mSET[39m  [33mattrib.attribEnds[39m = "+T.attribEnds)),T&&(console.log("6188 [32mattrib wipe, push and reset[39m"),b.attribs.push(a(T)),w()))}t[e]&&r.charCb&&(console.log("6218 [32mPING[39m "+JSON.stringify({type:b.type,chr:t[e],i:e},null,4)),Nt={type:b.type,chr:t[e],i:e},console.time("pingCharCb()"),r.charCb&&(h.push(Nt),console.log("523 "+(h.length>r.charCbLookahead?"[36mpingCharCb()[39m: [32mENOUGH VALUES IN CHAR STASH[39m":"[36mpingCharCb()[39m: [31mNOT ENOUGH VALUES IN CHAR STASH, MOVE ON[39m")),h.length>r.charCbLookahead&&(it(h,r.charCb,r.charCbLookahead),console.log("532 [90mâ–ˆâ–ˆ charStash[39m = "+JSON.stringify(h,null,4)))),console.timeEnd("pingCharCb()")),t[e]||null===b.start||(b.end=e,b.value=t.slice(b.start,b.end),T&&T.attribName&&(console.log("6253 [33mattrib[39m = "+JSON.stringify(T,null,4)),console.log("6262 [32mPUSH ATTR AND WIPE[39m"),T.attribEnds||(T.attribEnds=e),b.attribs.push(o({},T)),w()),b&&Array.isArray(b.properties)&&b.properties.length&&!b.properties[~-b.properties.length].end&&(b.properties[~-b.properties.length].end=e,b.properties[~-b.properties.length].start&&!b.properties[~-b.properties.length].value&&(b.properties[~-b.properties.length].value=t.slice(b.properties[~-b.properties.length].start,e))),I&&I.propertyStarts&&(I.end||(I.end=e),R(I),L(),console.log("6314 push, then [31mWIPE[39m [33mproperty[39m")),console.log("6318 [32mPING[39m"),st(b)),t[e]&&t[e].trim()&&(M=e),console.log("[90m==========================================\nâ–ˆâ–ˆ token: "+JSON.stringify(b,null,4)+(I.propertyStarts||I.importantStarts?"\nâ–ˆâ–ˆ property: "+JSON.stringify(I,null,4):"")+(T.attribStarts?"\nâ–ˆâ–ˆ attrib: "+JSON.stringify(T,null,4):"")+(_?"\nâ–ˆâ–ˆ attribToBackup: "+JSON.stringify(_,null,4):"")+(x?"\nâ–ˆâ–ˆ parentTokenToBackup: "+JSON.stringify(x,null,4):"")+(j.length?"\nâ–ˆâ–ˆ layers: "+JSON.stringify(j,null,4):"")+"[39m"+(g?"\n[31mDO NOTHING UNTIL "+g+"[39m":"")),console.log("[90mwithinStyle = "+p+"[39m  [90mwithinStyleComment = "+d+"[39m"),console.log("[90mselectorChunkStartedAt = "+V+"[39m"),console.log("[90mrightVal = "+f+"[39m"),console.log("[90mlastNonWhitespaceCharAt = "+M+"[39m"),console.log(x?"[90mparentTokenToBackup = "+JSON.stringify(x,null,4)+"[39m":""),console.timeEnd("[90mloop iteration[39m"),dt=e},dt=0;dt<=s;dt++)pt(dt);if(h.length){console.log("6409 FINALLY, clear [33mcharStash[39m");for(var ft=0,ht=h.length;ft<ht;ft++)it(h,r.charCb,r.charCbLookahead),console.log("6414 [90mâ–ˆâ–ˆ charStash[39m = "+JSON.stringify(h,null,4))}if(f.length){console.log("6425 FINALLY, clear [33mtagStash[39m");for(var bt=0,yt=f.length;bt<yt;bt++)it(f,r.tagCb,r.tagCbLookahead),console.log("6430 [90mâ–ˆâ–ˆ tagStash[39m = "+JSON.stringify(f,null,4))}var St=Date.now()-n;return console.log(" "),console.log("6443 [35mâ–ˆâ–ˆ[39m [33mtimeTakenInMilliseconds[39m = "+JSON.stringify(St,null,4)),console.log(" "),{timeTakenInMilliseconds:St}}var it=s((function(t){t.exports=function(){var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function n(t){if(!t)return!0;if(l(t)&&0===t.length)return!0;if("string"!=typeof t){for(var n in t)if(e(t,n))return!1;return!0}return!1}function o(e){return t.call(e)}function r(t){return"object"==typeof t&&"[object Object]"===o(t)}var l=Array.isArray||function(e){return"[object Array]"===t.call(e)};function i(t){return"boolean"==typeof t||"[object Boolean]"===o(t)}function s(t){var e=parseInt(t);return e.toString()===t?e:t}function a(t){var o,a=function t(e){return Object.keys(t).reduce((function(n,o){return"create"===o||"function"==typeof t[o]&&(n[o]=t[o].bind(t,e)),n}),{})};function m(t,e){if(o(t,e))return t[e]}function u(e,n,o,r){if("number"==typeof n&&(n=[n]),!n||0===n.length)return e;if("string"==typeof n)return u(e,n.split(".").map(s),o,r);var l=n[0],i=m(e,l);if(t.includeInheritedProps&&("__proto__"===l||"constructor"===l&&"function"==typeof i))throw new Error("For security reasons, object's magic properties cannot be set");return 1===n.length?(void 0!==i&&r||(e[l]=o),i):(void 0===i&&(e[l]="number"==typeof n[1]?[]:{}),u(e[l],n.slice(1),o,r))}return o=(t=t||{}).includeInheritedProps?function(){return!0}:function(t,n){return"number"==typeof n&&Array.isArray(t)||e(t,n)},a.has=function(n,o){if("number"==typeof o?o=[o]:"string"==typeof o&&(o=o.split(".")),!o||0===o.length)return!!n;for(var r=0;r<o.length;r++){var i=s(o[r]);if(!("number"==typeof i&&l(n)&&i<n.length||(t.includeInheritedProps?i in Object(n):e(n,i))))return!1;n=n[i]}return!0},a.ensureExists=function(t,e,n){return u(t,e,n,!0)},a.set=function(t,e,n,o){return u(t,e,n,o)},a.insert=function(t,e,n,o){var r=a.get(t,e);o=~~o,l(r)||a.set(t,e,r=[]),r.splice(o,0,n)},a.empty=function(t,e){var s,m;if(!n(e)&&null!=t&&(s=a.get(t,e))){if("string"==typeof s)return a.set(t,e,"");if(i(s))return a.set(t,e,!1);if("number"==typeof s)return a.set(t,e,0);if(l(s))s.length=0;else{if(!r(s))return a.set(t,e,null);for(m in s)o(s,m)&&delete s[m]}}},a.push=function(t,e){var n=a.get(t,e);l(n)||a.set(t,e,n=[]),n.push.apply(n,Array.prototype.slice.call(arguments,2))},a.coalesce=function(t,e,n){for(var o,r=0,l=e.length;r<l;r++)if(void 0!==(o=a.get(t,e[r])))return o;return n},a.get=function(t,e,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return n;if("string"==typeof e)return a.get(t,e.split("."),n);var o=s(e[0]),r=m(t,o);return void 0===r?n:1===e.length?r:a.get(t[o],e.slice(1),n)},a.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(n(e))return t;if("string"==typeof e)return a.del(t,e.split("."));var r=s(e[0]);return o(t,r)?1!==e.length?a.del(t[r],e.slice(1)):(l(t)?t.splice(r,1):delete t[r],t):t},a}var m=a();return m.create=a,m.withInheritedProps=a({includeInheritedProps:!0}),m}()})),st={reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,tagCb:null,charCb:null,errCb:null};function at(t){return t&&"object"==typeof t&&!Array.isArray(t)}function mt(t,e){return e.closing&&t.length&&(t[t.length-1].type===e.type&&Object.prototype.hasOwnProperty.call(t[t.length-1],"tagName")&&Object.prototype.hasOwnProperty.call(e,"tagName")&&t[t.length-1].tagName===e.tagName&&!1===t[t.length-1].closing||"comment"===e.type&&t.some((function(t){return Object.prototype.hasOwnProperty.call(t,"closing")&&!t.closing})))}t.cparser=function(t,e){if("string"!=typeof t)throw void 0===t?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "'+typeof t+'", equal to:\n'+JSON.stringify(t,null,4));if(e&&!at(e))throw new Error("codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type "+typeof e+", equal to "+JSON.stringify(e,null,4));if(e&&at(e)&&e.tagCb&&"function"!=typeof e.tagCb)throw new Error("codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type "+typeof e.tagCb+", equal to "+JSON.stringify(e.tagCb,null,4));if(e&&at(e)&&e.charCb&&"function"!=typeof e.charCb)throw new Error("codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type "+typeof e.charCb+", equal to "+JSON.stringify(e.charCb,null,4));if(e&&at(e)&&e.reportProgressFunc&&"function"!=typeof e.reportProgressFunc)throw new Error("codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type "+typeof e.reportProgressFunc+", equal to "+JSON.stringify(e.reportProgressFunc,null,4));if(e&&at(e)&&e.errCb&&"function"!=typeof e.errCb)throw new Error("codsen-tokenizer: [THROW_ID_07] the opts.errCb, callback function, should be a function but it was given as type "+typeof e.errCb+", equal to "+JSON.stringify(e.errCb,null,4));var n=o(o({},st),e),i=[],s=[],a="",m=!1,g={},p=["tag","comment"],f=["doctype"];return lt(t,{reportProgressFunc:n.reportProgressFunc,reportProgressFuncFrom:n.reportProgressFuncFrom,reportProgressFuncTo:n.reportProgressFuncTo,tagCbLookahead:2,tagCb:function(t,e){if("function"==typeof n.tagCb&&n.tagCb(t),!t.nested){var h=it.get(s,a);if(at(h)||(h=null),!m||t.closing||g.closing&&("comment"!==g.type||"html"!==g.language)||"text"===g.type||h&&h.tagName===t.tagName&&!h.closing&&t.closing||mt(i,t))if(t.closing&&"string"==typeof a&&a.includes(".")&&(!t.tagName||g.tagName!==t.tagName||g.closing)){if("comment"===t.type&&t.closing&&Array.isArray(i)&&i.length&&i.some((function(e){return"comment"===e.type&&e.kind===t.kind})))for(var b=i.length;b--&&(a=r(l(a)),"comment"!==i[b].type||i[b].kind!==t.kind););else a=r(l(a));if(mt(i,t)){for(;i.length&&i[i.length-1].type!==t.type&&i[i.length-1].kind!==t.kind;)i.pop();i.pop(),m=!1}else if(i.length&&t.tagName&&i.some((function(e){return"tag"===e.type&&e.tagName===t.tagName})))for(var y=i.pop(),S=y.tagName;S!==t.tagName;)y&&"function"==typeof n.errCb&&n.errCb({ruleId:y.type+("comment"===y.type?"-"+y.kind:"")+"-missing-closing",idxFrom:y.start,idxTo:y.end,tokenObj:y}),S=(y=i.pop()).tagName,a=r(l(a));else if(i.length>1&&i[i.length-2].type===t.type&&i[i.length-2].type===t.type&&i[i.length-2].tagName===t.tagName){if("function"==typeof n.errCb){var v=i[i.length-1];n.errCb({ruleId:"tag-rogue",idxFrom:v.start,idxTo:v.end,tokenObj:v})}i.pop(),i.pop()}}else a?(a=r(a),mt(i,t)&&i.pop()):a="0";else m=!1,a+=".children.0";p.includes(t.type)&&!t.void&&Object.prototype.hasOwnProperty.call(t,"closing")&&!t.closing&&(m=!0,t.kind&&f.includes(t.kind)||i.push(o({},t)));var E,O,k=function(t){if(!t)return null;var e=t.slice(t.lastIndexOf(".")+1);return"0"===e?null:t.includes(".")&&/^\d*$/.test(e)?""+t.slice(0,t.lastIndexOf(".")+1)+(+t.slice(t.lastIndexOf(".")+1)-1):/^\d*$/.test(t)?""+(+t-1):null}(a)||"",A=l(a);A&&a.includes(".")&&(E=it.get(s,A)),k&&(O=it.get(s,k));var N,T,w=/(-+|-+[^>])>/;at(O)&&Array.isArray(O.children)&&O.children.length&&O.children[O.children.length-1]&&(N=O.children[O.children.length-1],T=k+".children."+(it.get(s,k).children.length-1));var C=!1;if("text"===t.type&&at(E)&&"comment"===E.type&&"simple"===E.kind&&!E.closing&&w.test(t.value)){var V=(w.exec(t.value)||{}).index,x=(V||0)+t.value.slice(V).indexOf(">")+1;V&&V>0&&(it.set(s,a,o(o({},t),{},{end:t.start+V,value:t.value.slice(0,V)})),p.includes(t.type)&&(t.children=[])),a=r(l(a)),it.set(s,a,{type:"comment",kind:"simple",closing:!0,start:t.start+(V||0),end:t.start+x,value:t.value.slice(V,x),children:[]}),x<t.value.length&&(a=r(a),it.set(s,a,{type:"text",start:t.start+x,end:t.end,value:t.value.slice(x)})),C=!0}else if("comment"===t.type&&"only"===t.kind&&at(O))if("text"===O.type&&O.value.trim()&&"<!-".includes(O.value[c(O.value,O.value.length)])){var _=[];if(d(O.value,"\x3c!--",(function(t){_.push(t)}),{maxDistance:2}),_.length&&!u(O.value,_[_.length-1].idxTo-1)){var J=_.pop();!c(O.value,J.idxFrom)&&k&&at(O)?(p.includes(t.type)&&(t.children=[]),it.set(s,a=k,o(o({},t),{},{start:J.idxFrom+O.start,kind:"not",value:""+O.value+t.value})),C=!0):k&&at(O)&&(it.set(s,k,o(o({},O),{},{end:J.idxFrom+O.start,value:O.value.slice(0,J.idxFrom)})),p.includes(t.type)&&(t.children=[]),it.set(s,a,o(o({},t),{},{start:J.idxFrom+O.start,kind:"not",value:""+O.value.slice(J.idxFrom)+t.value})),C=!0)}}else if(at(N)&&"text"===N.type&&N.value.trim()&&"<!-".includes(N.value[c(N.value,N.value.length)])){var P=[];if(d(N.value,"\x3c!--",(function(t){P.push(t)}),{maxDistance:2}),P.length&&!u(N.value,P[P.length-1].idxTo-1)){var I=P.pop();!c(N.value,I.idxFrom)&&k&&at(N)?(p.includes(t.type)&&(t.children=[]),it.set(s,a,o(o({},t),{},{start:I.idxFrom+N.start,kind:"not",value:""+N.value+t.value})),it.del(s,k+".children."+(it.get(s,k).children.length-1)),C=!0):k&&at(N)&&T&&(it.set(s,T,o(o({},N),{},{end:I.idxFrom+N.start,value:N.value.slice(0,I.idxFrom)})),p.includes(t.type)&&(t.children=[]),it.set(s,a,o(o({},t),{},{start:I.idxFrom+N.start,kind:"not",value:""+N.value.slice(I.idxFrom)+t.value})),C=!0)}}C||(p.includes(t.type)&&(t.children=[]),it.set(s,a,t)),!p.includes(t.type)||!t.closing||k&&at(O)&&!O.closing&&O.type===t.type&&O.tagName===t.tagName||(t.void?"function"==typeof n.errCb&&n.errCb({ruleId:"tag-void-frontal-slash",idxFrom:t.start,idxTo:t.end,fix:{ranges:[[t.start+1,t.tagNameStartsAt]]},tokenObj:t}):"function"==typeof n.errCb&&n.errCb({ruleId:t.type+("comment"===t.type?"-"+t.kind:"")+"-missing-opening",idxFrom:t.start,idxTo:t.end,tokenObj:t})),g=o({},t)}},charCb:n.charCb}),i.length&&i.forEach((function(t){"function"==typeof n.errCb&&n.errCb({ruleId:t.type+("comment"===t.type?"-"+t.kind:"")+"-missing-closing",idxFrom:t.start,idxTo:t.end,tokenObj:t})})),s},t.defaults=st,t.version="0.10.3",Object.defineProperty(t,"__esModule",{value:!0})}));
